(window.webpackJsonp_spotim_4006192861=window.webpackJsonp_spotim_4006192861||[]).push([[49],{112:function(e,t,n){"use strict";var a=n(21),r=n.n(a),o=n(22),s=n.n(o),i=n(23),c=n(69),l=function(){var e=s()(r.a.mark((function e(t,n,a,o){var s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.id.split("_c_")[0],e.next=3,Object(c.a)("moderation/conversation/".concat(s,"/message/").concat(t.id,"/feature"),{method:"POST"});case 3:i=e.sent,!(l=i.body).success&&l.result&&l.result.indexOf("should_top_feature")>-1?n():a&&a(),localStorage.setItem("__SPOTIM_HIDE_FEATURED_COMMENT_NEW_BADGE__","true");case 7:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),u=function(){var e=s()(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id.split("_c_")[0],e.next=3,Object(c.a)("moderation/conversation/".concat(n,"/message/").concat(t.id,"/feature"),{data:{should_top_feature:!0},method:"POST"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=s()(r.a.mark((function e(t,n){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id.split("_c_")[0],e.next=3,Object(c.a)("moderation/conversation/".concat(a,"/message/").concat(t.id,"/feature"),{data:{only_remove_top_featured:!("top"!==t.featuredComment)},method:"DELETE"});case 3:"function"==typeof n&&n();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();n.d(t,"d",(function(){return p})),n.d(t,"c",(function(){return m})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return h}));var p=function(e){return{type:i.Db,payload:e}};function m(e){return function(){var t=s()(r.a.mark((function t(n,a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:i.bb,payload:e}),t.prev=1,t.next=4,d(e,(function(){p(!0)}));case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(e,n){return t.apply(this,arguments)}}()}function f(e){return function(){var t=s()(r.a.mark((function t(n,a){var o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a(),o.conversation.postId,n({type:i.Q,payload:e}),t.prev=2,t.next=5,u(e);case 5:t.next=9;break;case 7:t.prev=7,t.t0=t.catch(2);case 9:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e,n){return t.apply(this,arguments)}}()}function h(e,t){return function(){var n=s()(r.a.mark((function n(a,o){var s,c;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=o(),c=s.conversation.postId,a({type:i.a,payload:e}),n.prev=2,n.next=5,l(e,t,(function(){f(e)}),c);case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(2);case 9:case"end":return n.stop()}}),n,null,[[2,7]])})));return function(e,t){return n.apply(this,arguments)}}()}},266:function(e,t,n){"use strict";var a=n(24),r=n.n(a),o=n(25),s=n.n(o);function i(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}var c=function(){function e(){r()(this,e),this.events=void 0,this.events={}}return s()(e,[{key:"on",value:function(e,t){var n=this;return t&&"function"==typeof t?(this.events[e]=this.events[e]||[],this.events[e].push(t),function(){n.off(e,t)}):function(){}}},{key:"once",value:function(e,t){if(t&&"function"==typeof t)var n=this.on(e,(function(){t.apply(void 0,arguments),n()}))}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=[];this.events&&this.events[e]&&this.events[e].length>0&&(r=this.events[e]),r.forEach((function(e){return e.apply(void 0,n)}))}},{key:"off",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.events[e]&&this.events[e].length>0&&(t?i(this.events[e],t):this.events[e]=[])}}]),e}();t.a=new c},267:function(e,t,n){"use strict";var a=n(21),r=n.n(a),o=n(22),s=n.n(o),i=n(23),c=n(65),l=function(e,t){return Object(c.h)("user-status/".concat(e),{method:"GET",postId:t,data:{}})};n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d}));var u=function(e,t,n){return{type:i.J,payload:{message:{id:e.id},isUserAllowed:n,isUserBlocked:t}}},d=function(e){return function(){var t=s()(r.a.mark((function t(n,a){var o,s,i,c,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=a(),s=o.conversation.postId,!1,t.next=4,l(e.user.id,s);case 4:i=t.sent,c=i.blocked,d=i.allowed,n(u(e,c,d));case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},415:function(e,t,n){"use strict";var a=n(35),r=n.n(a),o=n(9),s=n.n(o),i=n(10),c=n.n(i),l=n(30),u=n(162),d=n(34),p=n(45),m=n(72),f=n(13),h=n(37),g=n(745),v=n.n(g),y=n(2),b=n(66),E=n(32),M=n(447),R=n(1),S=n(42);t.a=function(e){var t=e.show,n=e.onClose,a=e.message,i=e.spotName,g=e.currentUser,C=e.postId,w=Object(o.useState)(""),k=r()(w,2),O=k[0],I=k[1],x=Object(o.useState)(!1),T=r()(x,2),N=T[0],D=T[1],L=Object(o.useState)(""),j=r()(L,2),U=j[0],P=j[1],B=Object(u.a)().t,A=Object(d.useTracking)();function _(e,t){return'"'.concat(e,'" â€” ').concat(t)}function F(e,t){if(t.preventDefault(),"link"!==e){var n=function(e,t,n){var r=encodeURIComponent(t);switch(e){case"facebook":return"https://www.facebook.com/sharer/sharer.php?u=".concat(r);case"email":return"mailto:?subject=".concat(n,"&body=").concat(r);case"twitter":var o=Object(h.getCleanText)(a),s="@".concat(a.user.username),i=_("",s),c=_(o.substring(0,113-i.length)+"...",s),l=encodeURIComponent(c);return"https://twitter.com/intent/tweet?text=".concat(l,"&url=").concat(r)}}(e,O,U),r=["width=500","height=400","left="+(window.innerWidth-500)/2,"top="+(window.innerHeight-400)/2.5].join(",");"email"===e?Object(R.navigate)(n||""):window.open(n,void 0,r)}else D(!0);A.trackEvent({type:"share-message-clicked",item_type:"main",target_type:e,user_id:g.id,is_registered:g.isRegistered}),Object(R.dispatchSpotimEvent)(S.s,{type:e})}return Object(o.useEffect)((function(){if(t&&!O){var e,n=Object(f.getDisplayName)(g);Object(M.a)({messageDepth:a.depth,messageId:a.id,postId:C}).then((function(e){I(e)})),e=B("share.emailSubject",{username:n,spotName:i}),P(e),y.a.send("share_modal_shown")}}),[t]),s.a.createElement(l.Modal,{disableCustomBodyScroll:E.j,shadowRootCssModules:b.c?["conversation"]:void 0,isLtr:E.w,closeButton:!0,className:v.a.shareModal,showModal:t,onClose:n,modalTitle:B("shareModal.title","Share Post"),size:"sm",fullScreenMobile:!1},!O&&s.a.createElement("div",{className:v.a.spinnerWrapper},s.a.createElement(m.a,null)),s.a.createElement("div",{className:c()(v.a.shareButtons,O&&v.a.show)},s.a.createElement("a",{href:"#",onClick:F.bind(null,"facebook"),className:v.a.shareButton,"data-testid":"share-icon-facebook"},s.a.createElement(p.a,{className:c()(v.a.icon,v.a.facebookIcon),selector:"facebookIcon"})),s.a.createElement("a",{href:"#",onClick:F.bind(null,"twitter"),className:v.a.shareButton,"data-testid":"share-icon-twitter"},s.a.createElement(p.a,{className:c()(v.a.icon,v.a.twitterIcon),selector:"twitterIcon"})),s.a.createElement("a",{href:"#",onClick:F.bind(null,"email"),className:v.a.shareButton,"data-testid":"share-icon-email"},s.a.createElement(p.a,{className:c()(v.a.icon,v.a.emailIcon),selector:"emailIcon"})),s.a.createElement("a",{href:"#",onClick:F.bind(null,"link"),className:v.a.shareButton,"data-testid":"share-icon-link"},s.a.createElement(p.a,{className:c()(v.a.icon,v.a.linkIcon),selector:"linkIcon"}))),N&&s.a.createElement("div",{className:v.a.linkWrapper},s.a.createElement("input",{readOnly:!0,className:v.a.linkInput,value:O}),s.a.createElement("button",{className:v.a.copyLinkButton,onClick:function(){Object(R.copyToClipboard)(O)}},B("share.copy","Copy"))))}},417:function(e,t,n){"use strict";n.r(t);var a=n(24),r=n.n(a),o=n(25),s=n.n(o),i=n(26),c=n.n(i),l=n(27),u=n.n(l),d=n(28),p=n.n(d),m=n(9),f=n.n(m),h=n(31),g=n.n(h),v=n(10),y=n.n(v),b=n(45),E=n(418),M=n(419),R=n(754),S=n.n(R),C=n(33);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var k=function(e){c()(n,e);var t=w(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).getMessagesCount=function(e){var t=e.numCollapsedChildren,n=e.forceMessagesCollapsed,a=e.allCount,r=e.numNewComments,o=e.moreCount;return t||(n?a-r:o)},e.handleShowMoreReplies=function(){e.props.showMoreReplies()},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.moreCount,a=e.allCount,r=e.enableShowMore,o=e.numNewComments,s=e.forceMessagesCollapsed,i=e.numCollapsedChildren,c=e.messageStack,l=e.depth,u=e.isLastMessageInThread,d=c.hasNext&&0===c.childrenStackIds.length,p=y()(S.a.showMoreReplies,S.a["depth-".concat(l)],{[S.a.showMore]:d||i,[S.a.loading]:t,[S.a.lastMessage]:u||i||r&&d}),m=this.getMessagesCount({numCollapsedChildren:i,forceMessagesCollapsed:s,allCount:a,numNewComments:o,moreCount:n});return f.a.createElement("div",{className:p},t?f.a.createElement(M.a,null):(i||r&&d)&&f.a.createElement(E.a,{className:S.a.showMoreRepliesButton,onClick:this.handleShowMoreReplies},f.a.createElement("span",null,f.a.createElement("span",{className:S.a.showText},f.a.createElement(C.a,{i18nKey:"inpage.conversation.showMoreMessages",values:{messagesCount:m},count:m}),f.a.createElement(b.a,{selector:"chevronDownIcon",className:S.a.chevron})))))}}]),n}(m.Component);k.propTypes={showMoreReplies:g.a.func.isRequired,isLoading:g.a.bool,moreCount:g.a.number,enableShowMore:g.a.bool,forceMessagesCollapsed:g.a.bool,onDoneLoading:g.a.func,numNewComments:g.a.number,numCollapsedChildren:g.a.number,depth:g.a.number,isLastMessageInThread:g.a.bool},k.defaultProps={showMoreReplies:function(){},enableShowMore:!0},t.default=k},418:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(54),r=n.n(a),o=n(52),s=n.n(o),i=n(9),c=n.n(i),l=n(752),u=n.n(l),d=n(10),p=n.n(d),m=function(e){var t=e.children,n=e.className,a=s()(e,["children","className"]);return c.a.createElement("button",r()({},a,{type:"button",className:p()(n,u.a.emptyButton)}),t)}},419:function(e,t,n){"use strict";var a=n(9),r=n.n(a),o=n(10),s=n.n(o),i=n(171),c=n(0),l=n.n(c),u=n(753),d=n.n(u);t.a=function(e){var t=e.className,n=void 0===t?"":t;return r.a.createElement("div",{className:s()(d.a.messageContentLoader,n)},r.a.createElement(i.a,{rtl:!l.a.get("init_data.config.ltr"),height:313,width:646,speed:2,backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loader-primary-color"),foregroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loaders-secondary-color")},r.a.createElement("circle",{cx:"62",cy:"69",r:"24"}),r.a.createElement("rect",{x:"104",y:"51",rx:"5",ry:"5",width:"174",height:"13"}),r.a.createElement("rect",{x:"104",y:"73",rx:"5",ry:"5",width:"139",height:"13"}),r.a.createElement("rect",{x:"39",y:"110",rx:"5",ry:"5",width:"499",height:"15"}),r.a.createElement("rect",{x:"39",y:"141",rx:"5",ry:"5",width:"431",height:"15"}),r.a.createElement("circle",{cx:"62",cy:"226",r:"24"}),r.a.createElement("rect",{x:"104",y:"208",rx:"5",ry:"5",width:"174",height:"13"}),r.a.createElement("rect",{x:"104",y:"230",rx:"5",ry:"5",width:"139",height:"13"}),r.a.createElement("rect",{x:"39",y:"267",rx:"5",ry:"5",width:"499",height:"15"}),r.a.createElement("rect",{x:"39",y:"298",rx:"5",ry:"5",width:"431",height:"15"})))}},428:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(21),r=n.n(a),o=n(22),s=n.n(o),i=n(2),c=n(23),l=n(112),u=n(65),d=n(68);function p(e){var t=e.message;return function(){var e=s()(r.a.mark((function e(n,a){var o,s,p,m,f,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="delete_".concat(0===t.depth?"comment":"reply"),i.a.apm.start(o),n({type:c.t,payload:{message:t}}),s=a(),p=s.conversation.messagesCount,m=s.moduleOptions.postId,e.next=7,u.f(t.id,m);case 7:f=e.sent,r=f.body,g=void 0,g=d.a.map(r,{etag:"conversation.etag",messages_count:"conversation.messagesCount",comments_count:"conversation.commentsCount",soft_deleted:"rootMessage.isDeleted","comment.id":"rootMessage.id","comment.replies_count":"rootMessage.repliesCount"}),(h=g.conversation).messagesCount=p,n({type:c.s,payload:{conversation:h,starsRating:t.starsRating||0}}),"top"===t.featuredComment&&n(Object(l.d)(!0)),i.a.apm.end(o),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),n({type:c.s,payload:{error:e.t0},error:!0}),i.a.error("delete",e.t0);case 19:case"end":return e.stop()}var r,g}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}()}},429:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(23);function r(e){var t=e.messageId,n=e.starsRating;return{type:a.N,payload:{messageId:t,starsRating:n}}}},430:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(21),r=n.n(a),o=n(22),s=n.n(o),i=n(65),c=n(267);function l(e,t){return function(){var n=s()(r.a.mark((function n(a,o){var s,l,u;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=o(),l=s.conversation.postId,"add"!==e){n.next=8;break}return n.next=4,i.a(t.user.id,l);case 4:(u=n.sent).isWhiteListed=!0,n.next=12;break;case 8:return n.next=10,i.j(t.user.id,l);case 10:(u=n.sent).isWhiteListed=!1;case 12:(u.isSuccess||u)&&a(Object(c.b)(t,t.user.isBlockListed,u.isWhiteListed));case 13:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}},432:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(21),r=n.n(a),o=n(22),s=n.n(o),i=n(266),c=n(23);function l(e,t){return function(){var n=s()(r.a.mark((function n(a){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:setTimeout((function(){i.a.trigger("focusSayControl")}),0),a({type:c.T,payload:{starsRating:e,stackId:t}});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}},445:function(e,t,n){"use strict";var a=n(35),r=n.n(a),o=n(9),s=n.n(o),i=n(10),c=n.n(i),l=n(0),u=n.n(l),d=n(30),p=n(795),m=n.n(p),f=n(796),h=n.n(f),g=function(){return s.a.createElement("div",{className:h.a.loaderContainer},s.a.createElement("div",{className:h.a.loaderContent},s.a.createElement("div",{className:h.a.loaderHeader},"Sponsored"),s.a.createElement("div",{className:h.a.loaderSpinner})))},v=function(e){var t=e.ref,n=e.rootMargin,a=void 0===n?"0px":n,s=e.useOnce,i=Object(o.useState)(!1),c=r()(i,2),l=c[0],u=c[1],d=Object(o.useState)(!1),p=r()(d,2),m=p[0],f=p[1];return Object(o.useEffect)((function(){var e=new IntersectionObserver((function(e){var t=r()(e,1)[0];u(t.isIntersecting)}),{rootMargin:a,threshold:[.01]});return t&&e.observe(t),function(){t&&e.unobserve(t)}}),[t]),Object(o.useEffect)((function(){s?!m&&f(l):f(l)}),[l]),m};n.d(t,"b",(function(){return E})),n.d(t,"a",(function(){return C}));var y=Object(o.lazy)((function(){return Promise.all([n.e(0),n.e(83),n.e(85)]).then(n.bind(null,901))})),b=u.a.get("tenant_config.conversation.adsLazyLoadMargin","600px"),E=2===u.a.get("tenant_config.conversation.ads_style_version",1),M=E?10:25,R=E?10:25;function S(e,t){return e?0:E?t:t+M+R}var C=function(e){var t=e.index,n=e.onHideAd,a=Object(o.useState)(!1),i=r()(a,2),l=i[0],u=i[1],p=Object(o.useState)(!1),f=r()(p,2),h=f[0],C=f[1],w=Object(o.useState)(E?0:160),k=r()(w,2),O=k[0],I=k[1],x=Object(o.useState)(null),T=r()(x,2),N=T[0],D=T[1],L=Object(o.useCallback)((function(e){D(e)}),[]),j=v({ref:N,rootMargin:b,useOnce:!0});Object(o.useEffect)((function(){h&&setTimeout((function(){u(!0)}),2500)}),[h]);var U=Object(o.useCallback)((function(){l&&n()}),[l]);return s.a.createElement("li",{className:c()(m.a.conversationAdsUnit),"data-spotim-class":"conversation-ads-unit",onTransitionEnd:U,key:"ads-unit-".concat(t),style:{height:S(l,O),paddingTop:"".concat(M,"px"),paddingBottom:"".concat(R,"px")}},h?!l&&s.a.createElement("div",{id:"spotim-specific",className:m.a.hiddenAdPlacement},s.a.createElement("span",{className:m.a.checkboxIcon},s.a.createElement(d.Icon,{type:"fa-solid",name:"check-circle"})),s.a.createElement(d.Typography,{type:"modalBody"},"Ads will no longer be shown on this conversation."),s.a.createElement(d.Typography,{type:"infoMd"},"Thank you for your feedback!")):s.a.createElement(s.a.Fragment,null,s.a.createElement(o.Suspense,{fallback:E?null:s.a.createElement(g,null)},s.a.createElement("div",{ref:L,className:m.a.nativeAdWrapper},j&&s.a.createElement(y,{moduleName:"conversation",reportingModuleName:"conversation",onNoAdAvailable:function(){u(!0),C(!0)},onHideAd:function(){return C(!0)},onDimensionsChange:function(e){var t=e.height;I(t)},enableContextMenu:!E})))))}},58:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(9),r=n.n(a),o=n(162),s=n(368),i=["textKey","pluralValue","default","override","params","key","ref"],c=function(e){Object(o.a)();var t=Object.keys(e).filter((function(e){return-1===i.indexOf(e)})).reduce((function(t,n){return t[n]=e[n],t}),{});return e.override?r.a.createElement("span",t,e.override):r.a.createElement("span",t,r.a.createElement(s.a,{i18nKey:e.textKey,values:e.params||(null==e?void 0:e.values),count:e.pluralValue},e.children))}},897:function(e,t,n){"use strict";n.r(t);var a=n(24),r=n.n(a),o=n(25),s=n.n(o),i=n(26),c=n.n(i),l=n(27),u=n.n(l),d=n(28),p=n.n(d),m=n(41),f=n.n(m),h=n(9),g=n.n(h),v=n(31),y=n.n(v),b=n(10),E=n.n(b),M=n(11),R=n(15),S=n(34),C=n.n(S),w=n(30),k=n(1),O=n(81),I=n(45),x=n(620),T=n.n(x),N=n(58);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var L=function(e){c()(n,e);var t=D(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).handleSendVerifyEmailKeyUp=function(t){13===t.keyCode&&e.sendVerifyEmail()},e}return s()(n,[{key:"sendVerifyEmail",value:function(){var e=this.props,t=e.currentUser,n=e.spotId,a=e.hostUrl,r=t.email,o=a;this.props.onVerifyEmailSend({email:r,spotId:n,url:o})}},{key:"getVerifyEmailComponent",value:function(){return g.a.createElement("div",{onKeyUp:this.handleSendVerifyEmailKeyUp,"data-spmark":"verify-email",className:E()(T.a.verifyEmailBar)},g.a.createElement(I.a,{selector:"exclamationCircleSolidIcon",className:T.a.icon}),g.a.createElement(w.Typography,{className:T.a.textWrapper},g.a.createElement(N.a,{textKey:"inpage.conversation.completeEmailRegistration.text"}),g.a.createElement(N.a,{className:T.a.link,onClick:this.sendVerifyEmail.bind(this),textKey:"inpage.conversation.completeEmailRegistration.button"})))}},{key:"getEmailSentComponent",value:function(e){return g.a.createElement("div",{className:T.a.emailSentBar},g.a.createElement(I.a,{selector:"faCircleCheck",className:T.a.icon}),g.a.createElement(N.a,{textKey:"inpage.conversation.completeEmailRegistration.succesMessage.first"}),g.a.createElement("span",null," ".concat(e,". ")),g.a.createElement(N.a,{textKey:"inpage.conversation.completeEmailRegistration.succesMessage.second"}))}},{key:"render",value:function(){var e=this.props,t=e.email,n=e.isEmailVerified,a=e.isVerificationEmailSent,r=null;return t&&!n&&(r=a?this.getEmailSentComponent(t):this.getVerifyEmailComponent()),r}}]),n}(h.Component);L.displayName="CompleteEmailRegistration",L.propTypes={email:y.a.string,isEmailVerified:y.a.bool.isRequired,isVerificationEmailSent:y.a.bool,spotId:y.a.string,onVerifyEmailSend:y.a.func.isRequired,hostUrl:y.a.string},L.defaultProps={isVerificationEmailSent:!1};var j=n(72),U=n(128),P=n(36),B=n(627),A=n.n(B);function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var F=function(e){c()(n,e);var t=_(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).onLoadMore=function(){var t=e.props,n=t.onLoadMore,a=t.isLoading,r=t.tracking;a||(n(),r.trackEvent({type:"load-more-comments-clicked"}),Object(k.dispatchSpotimEvent)(U.a))},e.handleLoadMoreKeyUp=function(t){13===t.keyCode&&e.onLoadMore()},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.hasNext,a=e.loadMoreMessagesText,r=e.textKey,o=e.isLiveBlog;return n?g.a.createElement("div",{className:A.a.loadMoreCommentsContainer},g.a.createElement(w.Button,{mode:"primary","data-spmark":"show-more",className:E()(A.a.loadMoreMessages,{[A.a.loading]:t}),onClick:this.onLoadMore,onKeyUp:this.handleLoadMoreKeyUp,"data-spot-im-class":"load-more-messages"},t&&g.a.createElement("div",{className:A.a.spinnerWrapper},g.a.createElement(j.a,{size:"small"})),a?g.a.createElement("span",null,a):o?g.a.createElement(N.a,{textKey:"liveBlog.loadMore"},"Load more updates..."):g.a.createElement(N.a,{textKey:r},"Show More Comments"))):null}}]),n}(g.a.Component),V=f()(Object(M.connect)((function(e){return{isLiveBlog:P.j(e)}})),C()({}))(F),K=n(671),q=n.n(K),H=function(e){var t=e.onClick;return g.a.createElement("span",{className:q.a.Disqus},g.a.createElement("span",{className:q.a.mobileText,onClick:t,onTouchStart:t},"Forum?"),g.a.createElement("span",{className:q.a.desktopText,onClick:t,onTouchStart:t},"Have a Forum Account?"))},W=n(396),z=n(21),G=n.n(z),Q=n(22),J=n.n(Q),Y=n(37),X=n(674),Z=n.n(X),$=n(33);function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var te=function(e){c()(n,e);var t=ee(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.messagesCount,n=e.onClick,a=e.isLiveBlog,r=E()(Z.a.showNewButton,"brand-bg-color","brand-bg-color-hover");return g.a.createElement("div",{className:Z.a.showNewButtonWrapper},g.a.createElement("div",{className:Z.a.leftSeparator}),g.a.createElement(w.Button,{mode:"primary",className:r,onClick:n},g.a.createElement("span",null,t>1&&(a?g.a.createElement($.a,{i18nKey:"liveBlog.showNewUpdates",values:{messagesCount:t}}):g.a.createElement($.a,{i18nKey:"inpage.conversation.showNewMessages",values:{messagesCount:t}})),1===t&&(a?g.a.createElement($.a,{i18nKey:"liveBlog.showNewUpdate",values:{messagesCount:t}},"Show 1 New Update"):g.a.createElement($.a,{i18nKey:"inpage.conversation.showNewMessage",values:{messagesCount:t}},"Show 1 New Comment")))),g.a.createElement("div",{className:Z.a.rightSeparator}))}}]),n}(h.Component);te.propTypes={messagesCount:y.a.number,onClick:y.a.func,isLiveBlog:y.a.bool},te.defaultProps={messagesCount:"",onClick:function(){}};var ne=te,ae=n(159),re=n(98),oe=n(675),se=n.n(oe),ie=n(676),ce=n.n(ie);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ue=function(e){c()(n,e);var t=le(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=E()(ce.a.typingAnimation,{[ce.a.small]:this.props.isSmall,[ce.a.transparent]:this.props.transparent});return g.a.createElement("span",{className:e},g.a.createElement("span",null),g.a.createElement("span",null),g.a.createElement("span",null))}}]),n}(h.Component);ue.displayName="TypingAnimation",ue.propTypes={isSmall:y.a.bool},ue.defaultProps={isSmall:!1};var de=n(111),pe=n(32);function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var fe=function(e){c()(n,e);var t=me(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.users,n=e.className,a=e.size,r=e.typingUsersCount;if(r>0&&t.length>0){var o=t[t.length-1],s="large"===a?"medium":"normal",i=E()(n,se.a.conversationTyping,{[se.a.small]:"small"===a}),c=E()({[se.a.userImageWrapper]:!pe.n||r>1,[se.a.counter]:r>1},se.a[s]),l={height:"".concat(de.a.NORMAL,"px"),width:"".concat(de.a.NORMAL,"px")};return g.a.createElement("div",{className:i},g.a.createElement("div",{className:c,style:pe.n&&r>1?l:{},"data-typing-users-count":r},g.a.createElement(de.b,{isOnline:!1,size:de.a.NORMAL,disableUserImageUpload:!0,disableTooltip:!0,user:o})),g.a.createElement("div",{className:se.a.details,"data-spot-im-class":"typing-animation-box"},g.a.createElement(ue,{transparent:!0})))}return null}}]),n}(h.Component);fe.defaultProps={size:"large",users:[]};var he=n(686),ge=n.n(he);function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ye=function(e){c()(n,e);var t=ve(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.typingUsers,n=e.messagesCount,a=e.onShowMore,r=e.typingUsersCount,o=e.spotId,s=e.isLiveBlog,i=e.rootMessagesCount,c=e.hasNext,l=E()(ge.a.topActivityBar,{[ge.a.hasTyping]:r>0,[ge.a.hasShowNew]:n>0}),u=n>0&&(i>0||0===i&&!c);return g.a.createElement("li",{className:ge.a.blitzItem},r>0||n>0?g.a.createElement("div",{className:l},g.a.createElement("div",{className:ge.a.messageSection},g.a.createElement(fe,{users:t,typingUsersCount:r,size:39,spotId:o})),u&&g.a.createElement(ne,{messagesCount:n,onClick:a,isLiveBlog:s})):g.a.createElement("div",null))}}]),n}(h.Component);ye.propTypes={currentUserId:y.a.string.isRequired,typingUsers:y.a.array.isRequired,messagesCount:y.a.number,onShowMore:y.a.func,spotId:y.a.string,isLiveBlog:y.a.bool,rootMessagesCount:y.a.number.isRequired,hasNext:y.a.bool.isRequired},ye.defaultProps={messagesCount:0,onShowMore:function(){},isLiveBlog:!1};var be=Object(M.connect)((function(e){return{spotId:e.moduleOptions.spotId,currentUserId:e.currentUser.id,typingUsers:Object(re.c)(e),typingUsersCount:Object(re.d)(e),isLiveBlog:e.moduleOptions.isConversationLiveBlog,rootMessagesCount:e.comments.list.rootOrder.length,hasNext:e.comments.pagination.hasNext}}),{onShowMore:ae.b})(ye),Ee=n(74),Me=n(0),Re=n.n(Me),Se=n(29),Ce=n.n(Se),we=n(54),ke=n.n(we),Oe=n(90),Ie=n(40),xe=n(687),Te=n.n(xe);function Ne(e,t,a){var r=a.duration,o=void 0===r?1e3:r,s=a.easing,i=void 0===s?"linear":s,c=a.delay,l=void 0===c?0:c,u=n(400)(e);return new Promise((function(e){window.requestAnimationFrame((function(){for(var n in t)t.hasOwnProperty(n)&&(u="scale"===n?u.scale(t[n]):u.set(n,t[n]));u=u.duration(o).ease(i).delay(l).end(e)}))}))}function De(e){var t=e.offsetHeight,n=getComputedStyle(e);return t+=parseInt(n.marginTop)+parseInt(n.marginBottom)}function Le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var je=function(e){e&&"function"==typeof e&&e()},Ue=function(e){c()(o,e);var t,n,a=Le(o);function o(){return r()(this,o),a.apply(this,arguments)}return s()(o,[{key:"enter",value:(n=J()(G.a.mark((function e(t){var n,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ie.b&&!this.props.mobileEnabled||this.props.enterAnimationDisabled)){e.next=3;break}return je(t),e.abrupt("return");case 3:return n=Object(R.findDOMNode)(this),a="".concat(De(n),"px"),n.style.opacity=0,n.style.height=0,e.next=9,Ne(n,{opacity:1,height:a},{duration:432,easing:"cubic-bezier(0.86,0,0.07,1)"});case 9:n.style.opacity="",n.style.height="",je(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"leave",value:(t=J()(G.a.mark((function e(t){var n,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ie.b||this.props.mobileEnabled){e.next=3;break}return je(t),e.abrupt("return");case 3:return n=Object(R.findDOMNode)(this),a=De(n),n.style.opacity=1,n.style.height=a,e.next=9,Ne(n,{opacity:0,height:"0px"},{duration:432,easing:"cubic-bezier(0.86, 0, 0.07, 1)"});case 9:n.style.opacity="",n.style.height="",je(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this.props,t=e.className,n=e.children,a=e.depth,r=e.user,o=E()(Te.a.appearanceComponent,{[Te.a.isReply]:a>0,[Te.a.isHighlighted]:r.isJournalist||r.isAdmin||r.isModerator},t);return g.a.createElement("div",{className:o},n)}}]),o}(h.Component);Ue.propTypes={children:y.a.any,className:y.a.string,mobileEnabled:y.a.bool,enterAnimationDisabled:y.a.bool,user:y.a.object,depth:y.a.number},Ue.defaultProps={mobileEnabled:!0,enterAnimationDisabled:!1,className:void 0};var Pe=n(138),Be=n(66);function Ae(e){var t,n;return 0===e.message.depth?(t=Pe.default.t("message.contextMenu.delete.confirmation.titleComment"),n=e.currentUser.isModerator&&e.message.repliesCount>0?Pe.default.t("message.contextMenu.delete.confirmation.relatedReplies",{params:{repliesCount:"props.message.repliesCount"}}):Pe.default.t("message.contextMenu.delete.confirmation.comment")):(t=Pe.default.t("message.contextMenu.delete.confirmation.titleReply"),n=Pe.default.t("message.contextMenu.delete.confirmation.reply")),g.a.createElement(w.Modal,{disableCustomBodyScroll:pe.j,shadowRootCssModules:Be.c?["conversation"]:void 0,isLtr:pe.w,fullScreenMobile:!1,showModal:e.showModal,onClose:function(){return e.onClose()},size:"md",bottomActions:g.a.createElement(w.Gutter,null,g.a.createElement(w.Button,{mode:"secondary",onClick:function(){return e.onClose()},id:"spotim-delete-message-cancel"},Pe.default.t("message.contextMenu.delete.confirmation.cancelButton")),g.a.createElement(w.Button,{mode:"primary",onClick:function(){e.onClose(!0)},id:"spotim-delete-message-ok"},Pe.default.t("message.contextMenu.delete.confirmation.okButton"))),modalTitle:t},n)}var _e=n(35),Fe=n.n(_e),Ve=n(736),Ke=n.n(Ve),qe=n(69);function He(e){var t=Object(h.useState)(!1),n=Fe()(t,2),a=n[0],r=n[1],o=e.message,s=o.id,i=o.conversationId,c=function(){var t=J()(G.a.mark((function t(n){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r(!0),t.next=3,Object(qe.a)("moderation/conversation/".concat(i,"/message/").concat(s,"/feature"),{data:{should_top_feature:n},method:"POST"});case 3:r(!1),n?e.onClose("top-featured"):e.onClose("leave-tagged");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return g.a.createElement(w.Modal,{disableCustomBodyScroll:pe.j,shadowRootCssModules:Be.c?["conversation"]:void 0,isLtr:pe.w,closeButton:!0,showModal:e.showFeaturedCommentModal,onClose:function(){return e.onClose("closed")},modalTitle:"Pin Featured Comment",className:Ke.a.featureCommentModal,size:"md",bottomActions:g.a.createElement(w.Gutter,null,g.a.createElement(w.Button,{mode:"secondary",disabled:a,onClick:function(){return c(!1)}},"No"),g.a.createElement(w.Button,{mode:"primary",disabled:a,onClick:function(){return c(!0)}},"Yes"))},g.a.createElement("div",{className:Ke.a.text},"Would you like to pin this featured comment at the top of the conversation?"),g.a.createElement("div",{className:Ke.a.imageWrapper},g.a.createElement("img",{className:Ke.a.image,src:"http://publisher-assets.spot.im/featured-comment/set-post-as-featured.svg"})))}He.propTypes={message:y.a.object,showFeaturedCommentModal:y.a.bool,onClose:y.a.func};var We=He,ze=n(162),Ge=n(737),Qe=n.n(Ge);function Je(e){var t=e.label,n=e.showSpinner;return g.a.createElement("div",{className:E()(Qe.a.wrapper,n&&Qe.a.showSpinner)},g.a.createElement("div",{className:Qe.a.label},t),g.a.createElement("div",{className:Qe.a.spinnerWrapper},g.a.createElement(j.a,null)))}function Ye(e){var t=Object(ze.a)().t,n=Object(h.useState)(!1),a=Fe()(n,2),r=a[0],o=a[1];return g.a.createElement(w.Modal,{disableCustomBodyScroll:pe.j,shadowRootCssModules:Be.c?["conversation"]:void 0,isLtr:pe.w,fullScreenMobile:!1,showModal:e.showModal,onClose:function(){return e.onClose()},size:"md",bottomActions:g.a.createElement(w.Gutter,null,g.a.createElement(w.Button,{mode:"secondary",onClick:function(){e.onClose("cancel")}},t("message.contextMenu.delete.confirmation.cancelButton","No")),g.a.createElement(w.Button,{mode:"primary",onClick:function(){o(!0),e.onClose("ok")}},g.a.createElement(Je,{label:t("message.contextMenu.delete.confirmation.okButton","Yes"),showSpinner:r}))),modalTitle:t("reportMessageModal.title","Report Message")},g.a.createElement($.a,{i18nKey:"reportMessageModal.body"},"Would you like to report this comment as inappropriate? The reported comment will not be displayed in your view."))}var Xe=n(174),Ze=n(70),$e=n(738),et=n.n($e);function tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var nt=function(e){c()(n,e);var t=tt(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).wrapperRef=g.a.createRef(),e.state={startAnimation:!1,expanderStyle:{height:"0px"},demarginStyle:{marginTop:"-60px"}},e.maxHeight=void 0,e.startAnimation=function(){setTimeout((function(){e.setState({startAnimation:!0})}),1e3),setTimeout((function(){e.setState({animationDone:!0})}),3e3),e.setState({expanderStyle:{height:"0px"}}),e.interval=setInterval((function(){if(e.wrapperRef.current){var t=e.wrapperRef.current.getBoundingClientRect().height;if(t<e.maxHeight)return;e.maxHeight=t;var n=t+"px";n!==e.state.expanderStyle.height&&e.setState({expanderStyle:{height:n}}),"0px"!==e.state.demarginStyle.marginTop?e.setState({demarginStyle:{marginTop:"0px"}}):e.state.expanderStyle.height&&e.setState({expanderStyle:{}})}}),100)},e}return s()(n,[{key:"componentDidMount",value:function(){this.props.animate&&this.startAnimation()}},{key:"componentDidUpdate",value:function(e){this.props.animate&&this.props.animate!==e.animate&&this.startAnimation()}},{key:"render",value:function(){return this.props.animate?g.a.createElement("div",{className:E()(et.a.animateInWrapper,this.state.startAnimation&&et.a.startAnimation,this.state.animationDone&&et.a.animationDone)},g.a.createElement("div",{className:et.a.demargin,style:this.state.demarginStyle},g.a.createElement("div",{className:et.a.expander,style:this.state.expanderStyle},g.a.createElement("div",{ref:this.wrapperRef,className:et.a.animateIn},this.props.children)))):this.props.children}}]),n}(g.a.Component),at=n(739),rt=n.n(at);function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var st=function(e){c()(n,e);var t=ot(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"renderTranslatedText",value:function(){var e=this.props,t=e.message,n=e.currentUser,a=t.isReported,r=t.isDeleted,o=t.status,s=g.a.createElement(N.a,{textKey:"message.muted"});if(a)s=g.a.createElement(N.a,{textKey:"message.reported"});else if(o===Y.statuses.BLOCKED){var i=n.id===t.user.id?"rejected":"defaultRejected";s=g.a.createElement(N.a,{textKey:"message.".concat(i)})}else r&&(s=g.a.createElement(N.a,{textKey:"message.deleted"}));return s}},{key:"render",value:function(){var e=this.props.innerRef;return g.a.createElement("div",{ref:e,className:E()(rt.a.messageDetails,rt.a.deletedMessage)},g.a.createElement(w.Typography,{type:"infoMd",className:rt.a.isDeleted},this.renderTranslatedText()))}}]),n}(h.Component),it=f()(Object(M.connect)((function(e){return{currentUser:e.currentUser}})))(st),ct=n(23);function lt(e){var t=e.messageId;return function(){var e=J()(G.a.mark((function e(n,a){var r,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a(),o=P.j(r),n({type:ct.P,payload:{messageId:t,isLiveBlog:o}});case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}var ut=n(740),dt=n.n(ut),pt=n(78);function mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ft=function(e){c()(n,e);var t=mt(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){return g.a.createElement(w.Button,{onClick:this.props.onReply},g.a.createElement(pt.a,{className:dt.a.messageReply},g.a.createElement(N.a,{"data-spot-im-class":"message-reply",role:"button",textKey:"message.reply"},"Reply")))}}]),n}(h.Component);ft.defaultProps={onReply:function(){},messageReplyGotFocus:function(){}};var ht,gt=Object(M.connect)((function(e){return{spotId:e.moduleOptions.spotId}}))(ft),vt=n(397);!function(e){e.Like="like",e.UpDown="updown",e.Recommend="recommend"}(ht||(ht={}));var yt=Re.a.get("tenant_config.shared.votes_type",ht.Like),bt=n(741),Et=n.n(bt);function Mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Rt=function(e){c()(n,e);var t=Mt(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={activeNoAnimation:e.props.active},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.active,n=e.type,a=e.isReply;return g.a.createElement("div",{"data-spot-im-class":"animated-vote-".concat(n),id:"spotim-animated-vote-".concat(n,"-").concat(a?"reply":"comment"),className:E()(Et.a.voteIconWrapper,{[Et.a.active]:t})},g.a.createElement(I.a,{className:Et.a.voteIcon,selector:this.icon}))}},{key:"icon",get:function(){var e=this.props,t=e.active,n=e.type;switch(yt){case ht.UpDown:return"up"===n?t?"upVoteFull":"upVote":t?"downVoteFull":"downVote";case ht.Recommend:return t?"recommended":"recommend";case ht.Like:default:return"up"===n?t?"voteUpIconFull":"voteUpIcon":t?"voteDownIconFull":"voteDownIcon"}}}]),n}(h.Component);Rt.contextTypes={toastMessage:y.a.object.isRequired};var St=Object(vt.a)()(Rt),Ct=n(742),wt=n.n(Ct),kt=n(2),Ot=n(44);function It(e){return xt.apply(this,arguments)}function xt(){return(xt=J()(G.a.mark((function e(t){var n,a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messageId,a=t.operation,r=a,e.next=4,Object(qe.a)("rank/reply/".concat(n),{method:"POST",data:r});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e){return Nt.apply(this,arguments)}function Nt(){return(Nt=J()(G.a.mark((function e(t){var n,a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,a=t.postId,r=t.isReply,pe.l){e.next=7;break}return e.next=4,Object(Ot.a)("v1.0.0/rank/rank/message",{method:"POST",data:n,postId:a});case 4:return e.abrupt("return",e.sent);case 7:if(!r){e.next=13;break}return e.next=10,It({messageId:n.message_id,operation:{operation:n.operation}});case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,Object(qe.a)("rank/comment/".concat(n.message_id),{method:"POST",data:{operation:n.operation}});case 15:e.t0=e.sent;case 16:return e.abrupt("return",e.t0);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Dt=n(42);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ut(e,t){var n=t.operation,a=t.message,r=t.conversationId,o=void 0===r?null:r,s=t.userId,i={userId:void 0===s?null:s,conversationId:o,messageId:a.id};a.featuredComment&&(i.target_type="featured-comment",i.segment="top"===a.featuredComment?"top-featured-comment":"in-conversation-featured"),"up"===n?a.isVotedUp?i.type="liked-cancelled":i.type="liked":a.isVotedDown?i.type="disliked-cancelled":i.type="disliked",kt.a.send(i.type)}function Pt(e,t,n){var a;switch(!0){case"up"===n&&!e&&!t:a="like";break;case"up"===n&&e&&!t:a="toggle-like";break;case"up"===n&&!e&&t:a="swap-to-like";break;case"down"===n&&!e&&!t:a="dislike";break;case"down"===n&&!e&&t:a="toggle-dislike";break;case"down"===n&&e&&!t:a="swap-to-dislike"}return{operation:a}}var Bt=n(13),At=n(64),_t=n(891),Ft=n(92),Vt=n(171),Kt=n(414),qt=n.n(Kt),Ht=function(){return g.a.createElement("div",{className:qt.a.activityIndicator},g.a.createElement(Vt.a,{baseUrl:Object(k.getLocation)().href,rtl:!Re.a.get("init_data.config.ltr"),height:98,width:224,speed:2,backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loader-primary-color"),foregroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loaders-secondary-color")},g.a.createElement("rect",{x:"52",y:"11",rx:"8",ry:"8",width:"153",height:"13"}),g.a.createElement("circle",{cx:"27",cy:"17",r:"12"}),g.a.createElement("rect",{x:"52",y:"44",rx:"8",ry:"8",width:"153",height:"13"}),g.a.createElement("circle",{cx:"27",cy:"50",r:"12"}),g.a.createElement("rect",{x:"52",y:"77",rx:"8",ry:"8",width:"153",height:"13"}),g.a.createElement("circle",{cx:"27",cy:"83",r:"12"})))},Wt={[ht.Like]:"likersList",[ht.UpDown]:"upDownList",[ht.Recommend]:"recommendList"},zt=Object(M.connect)((function(e){return{direction:e.moduleOptions.direction,disableUserProfileModal:e.moduleOptions.disableUserProfileModal}}),(function(e){return{dispatch:e}}))((function(e){var t=e.users,n=void 0===t?[]:t,a=e.dispatch,r=e.scheduleUpdate,o=e.upVotesCount,s=e.onLoadMore,i=e.disableUserProfileModal,c=Object(ze.a)().t,l=Object(_t.a)(),u=Fe()(l,2),d=u[0],p=u[1];function m(e,t){t.preventDefault(),pe.o||a(Object(Ft.a)({user:e}))}Object(h.useEffect)((function(){r&&r()}),[n]),Object(h.useEffect)((function(){d.isIntersecting&&s()}),[d]);var f=0===n.length,v=E()(qt.a.user,{[qt.a.notClickable]:i||pe.o}),y=c("".concat(Wt[yt],".header"),{numUsers:o,count:o});return g.a.createElement("div",{className:E()(qt.a.usersList,f&&qt.a.isLoading)},g.a.createElement("div",{className:qt.a.header},y),g.a.createElement("div",{className:qt.a.list},f&&g.a.createElement(Ht,null),!f&&n.map((function(e){return g.a.createElement("a",{href:"spotim-user",className:v,key:e.id,onClick:m.bind(null,e)},g.a.createElement("div",{className:E()(!pe.n&&qt.a.userImage)},g.a.createElement(de.b,{user:e,isOnline:e.isOnline,size:33,disableUserImageUpload:!0})),g.a.createElement("div",{className:qt.a.userDetails},g.a.createElement("div",{className:E()(qt.a.displayName,{[qt.a.notClickable]:pe.o})},Object(Bt.getDisplayName)(e)),g.a.createElement("div",{className:E()(qt.a.username,{[qt.a.notClickable]:pe.o})},"@",e.username)))})),g.a.createElement("div",{ref:p})))})),Gt=n(79),Qt=n.n(Gt),Jt=n(744),Yt=n.n(Jt);function Xt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s={message_type:0===e?"comment":"reply",message_id:t,spot_id:n,offset:a,count:r};return Object(Ot.a)("v1.0.0/conversation/rank/message/users",{postId:o,method:"POST",data:s})}var Zt=n(139),$t=n(68);function en(e){var t=e.messageDepth,n=e.messageId,a=e.conversationId,r=e.offset,o=e.count;return function(){var e=J()(G.a.mark((function e(s,i){var c,l,u,d,p,m,f;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=i().conversation.postId,s({type:ct.db,payload:{messageDepth:t,messageId:n,conversationId:a,spotId:pe.A,offset:r,count:o}}),e.next=5,Xt(t,n,pe.A,r,o,c);case 5:l=e.sent,u=i(),d=u.comments.list.messages,p=u.currentUser,m=d[n],f=$t.a.map(l.Users,Object(Zt.a)("",l.Users)),m.message.isVotedUp&&(f=Yt()([].concat(Qt()(f),[p]),"id")),s({type:ct.gb,payload:{users:f,messageDepth:t,conversationId:a,messageId:n,spotId:pe.A,offset:r,count:o}}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),s({type:ct.gb,payload:{error:e.t0},error:!0}),kt.a.error("getUpvotes",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()}function tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var nn=Re.a.get("tenant_config.conversation.disable_vote_up"),an=Re.a.get("tenant_config.conversation.disable_vote_down"),rn=function(e){c()(n,e);var t=tn(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={offset:0,isVotedUp:e.props.message.isVotedUp,isVotedDown:e.props.message.isVotedDown,showVotersList:!1},e.toggleVoteUp=function(){var t=e.props,n=t.allowGuestVoting,a=t.showLoginSelectorModal;if(n){var r=e.state.isVotedUp,o=e.state.isVotedDown;o&&(o=!o),e.setState({isVotedUp:!r,isVotedDown:o}),e.props.onToggleVote({operation:"up"}),Object(k.dispatchSpotimEvent)(Dt.c)}else a()},e.toggleVoteDown=function(){var t=e.props,n=t.allowGuestVoting,a=t.showLoginSelectorModal;if(n){var r=e.state.isVotedUp,o=e.state.isVotedDown;r&&(r=!r),e.setState({isVotedUp:r,isVotedDown:!o}),e.props.onToggleVote({operation:"down"}),Object(k.dispatchSpotimEvent)(Dt.b)}else a()},e.loadVotedUsers=function(){var t=e.state.offset,n=e.props,a=n.message;(0,n.loadVotedUsers)({messageDepth:a.depth,messageId:a.id,offset:t})},e.handleLoadMore=function(){e.setState((function(e){return{offset:e.offset+10}}),(function(){e.loadVotedUsers()}))},e.handleShowMenuChange=function(t){e.setState({showVotersList:t})},e.getUpVoteButton=function(){var t=e.props,n=t.message,a=t.message.upVotesCount,r=e.state.isVotedUp,o=n.depth>0,s=yt===ht.Recommend;return g.a.createElement(pt.a,{disableHover:!a&&!s,isIcon:!a&&!s,onClick:e.toggleVoteUp,className:E()(wt.a.votesWrapper,{[wt.a.voteSelected]:r})},g.a.createElement(St,{type:"up",isReply:o,active:r}),(!!a||s)&&g.a.createElement("span",{className:wt.a.votesCounter},s?r?g.a.createElement($.a,{className:wt.a.recommendedText,i18nKey:"message.recommended",values:{count:a}},"Recommended (",a,")"):g.a.createElement($.a,{className:wt.a.recommendedText,i18nKey:"message.".concat(a?"recommend":"recommend_0"),values:{count:a}},"Recommend (",a,")"):a))},e}return s()(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({isVotedUp:e.message.isVotedUp,isVotedDown:e.message.isVotedDown})}},{key:"componentDidUpdate",value:function(e,t){var n=this,a=this.state.showVotersList;a&&t.showVotersList!==a&&this.setState({offset:0},(function(){n.loadVotedUsers()}))}},{key:"render",value:function(){var e=this.props,t=e.votedUsers,n=e.message,a=e.message,r=a.upVotesCount,o=a.downVotesCount,s=this.state.isVotedDown,i=n.depth>0;return g.a.createElement("div",{className:wt.a.votesContainer,"data-spot-im-class":"vote-links"},!nn&&g.a.createElement(w.Menu,{isLtr:pe.w,isMobile:Ie.a,placement:"bottom",onShowChange:this.handleShowMenuChange,trigger:0===r||Ie.a?"none":"hover",mobileCancelButtonContent:g.a.createElement($.a,{i18nKey:"menu.closeButton"},"Done"),delayShow:300,menuButton:this.getUpVoteButton(),disabled:!r},g.a.createElement(zt,{users:t,scheduleUpdate:function(){},upVotesCount:r,onLoadMore:this.handleLoadMore})),!an&&yt!==ht.Recommend&&g.a.createElement(pt.a,{disableHover:!o,isIcon:!o,onClick:this.toggleVoteDown,className:E()(wt.a.votesWrapper,{[wt.a.voteSelected]:s})},g.a.createElement(St,{type:"down",isReply:i,active:s}),!!o&&g.a.createElement("span",{className:wt.a.votesCounter},o)))}}]),n}(h.Component);rn.defaultProps={allowGuestVoting:!0};var on=Object(M.connect)((function(e){var t=e.currentUser,n=e.moduleOptions.enableGuestVoting,a=e.upVotesList.users;return{allowGuestVoting:Object(Bt.isLoggedIn)(t)||n,votedUsers:a}}),(function(e,t){return{onToggleVote(n){var a=n.operation;e(function(e){var t=e.operation,n=e.message;return function(){var e=J()(G.a.mark((function e(a,r){var o,s,i,c,l,u,d,p,m,f,h;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=r(),s=o.moduleOptions.postId,i=o.conversation,c=i.id,l=i.contentType,u=o.currentUser.id,d=n.id,p=n.isVotedUp,m=n.isVotedDown,"up"!==t||p?"down"!==t||m||Object(k.dispatchSpotimEvent)(Dt.x):Object(k.dispatchSpotimEvent)(Dt.z),a({type:ct.Gb,payload:{operation:t,message:n}}),f=n.depth>0,h=Pt(p,m,t),e.next=9,Tt({postId:s,isReply:f,data:jt(jt({},h),{},{message_id:d,source:l})});case 9:Ut(r,{operation:t,message:n,conversationId:c,userId:u}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),a({type:ct.Fb,payload:{error:e.t0,operation:t,rootMessageId:rootMessageId,id:id},error:!0}),kt.a.error("toggleVoteMessage",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}()}({operation:a,message:t.message}))},showLoginSelectorModal(){e(Object(At.a)())},loadVotedUsers(t){var n=t.messageDepth,a=t.messageId,r=t.offset,o=void 0===r?0:r,s=t.count;e(en({messageDepth:n,messageId:a,offset:o,count:void 0===s?10:s}))}}}))(rn),sn=n(415),cn=n(746),ln=n.n(cn);function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var dn=function(e){c()(n,e);var t=un(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).handleMessageReplyGotFocus=function(){a.props.messageReplyGotFocus()},a.onReply=function(){var e=a.props.conversationId;Object(k.dispatchSpotimEvent)(Dt.w),a.props.onReply(a.props.message,event),a.props.tracking.trackEvent({type:"editor-reply-focus",ugc_post_id:e})},a.handleCloseShareModal=function(){a.setState({showShareModal:!1})},a.state={showShareModal:!1},a}return s()(n,[{key:"componentWillUnmount",value:function(){clearTimeout(this.isEditableTimeout)}},{key:"share",value:function(){var e=this;Ie.a&&"function"==typeof navigator.share?navigator.share({title:document.title,url:Object(k.getLocation)().href}).catch((function(){e.setState({showShareModal:!0})})):this.setState({showShareModal:!0}),this.hideDroplist()}},{key:"render",value:function(){var e=this.props,t=e.message,n=e.currentUser,a=e.depth,r=e.enableVotes,o=e.isDisabled,s=e.enableReply,i=e.isLiveBlog,c=e.spotName,l=e.spotId,u=e.postId,d=this.state.showShareModal,p=E()(ln.a.messageActions,ln.a["depth-".concat(a)],{[ln.a.isDisabled]:o,[ln.a.isLiveBlog]:i,[ln.a.isFullyVoted]:t.upVotesCount&&t.downVotesCount});return g.a.createElement("div",{className:p},i&&g.a.createElement(g.a.Fragment,null,g.a.createElement(N.a,{onClick:this.share.bind(this),className:ln.a.shareMessageText,textKey:"message.share"}),g.a.createElement(sn.a,{currentUser:n,spotId:l,spotName:c,message:t,show:d,onClose:this.handleCloseShareModal,postId:u})),s&&g.a.createElement(gt,{messageReplyGotFocus:this.handleMessageReplyGotFocus,onReply:this.onReply}),r&&g.a.createElement(on,{message:t}))}}]),n}(h.Component);dn.displayName="MessageActions",dn.propTypes={message:y.a.object.isRequired,spotName:y.a.string.isRequired,currentUser:y.a.object.isRequired,depth:y.a.number,onReply:y.a.func,enableReply:y.a.bool,enableVotes:y.a.bool,messageReplyGotFocus:y.a.func,isDisabled:y.a.bool,spotId:y.a.string.isRequired,postId:y.a.string.isRequired,conversationId:y.a.string.isRequired},dn.defaultProps={depth:3,enableReply:!0,enableVotes:!0,onReply:function(){},messageReplyGotFocus:function(){}};var pn=f()(Object(M.connect)((function(e){var t=P.j(e),n=e.isReadOnly;return{isLiveBlog:e.moduleOptions.isConversationLiveBlog,spotName:e.moduleOptions.spotName,spotId:e.moduleOptions.spotId,postId:e.moduleOptions.postId,conversationId:e.moduleOptions.conversationId,currentUser:e.currentUser,enableReply:!t&&!n,isMobileDevice:P.l(e)||e.moduleOptions.isMobile}}),(function(e){return{onReply:function(t){e(lt({messageId:t.id}))}}})),Object(S.track)({}))(dn),mn=n(747),fn=n.n(mn);function hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var gn=function(e){c()(n,e);var t=hn(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.url,a=e.onClick;return t=E()(fn.a.messageUrl,t),g.a.createElement("span",{className:t},g.a.createElement("a",{href:n,className:fn.a.link,onClick:function(e){return a(e,n)}},g.a.createElement(N.a,{textKey:"message.conversationLinkText"})))}}]),n}(h.Component);gn.displayName="MessageUrl",gn.propTypes={className:y.a.string,url:y.a.string,onClick:y.a.func},gn.defaultProps={className:void 0,url:"",onClick:function(){}};var vn=n(67),yn=n(748),bn=n.n(yn);function En(e){var t=e.message,n=Object(Bt.getDisplayName)({id:t.replyToUserId||"",username:t.replyToUsername||"",displayName:t.replyToDisplayName||"",isRegistered:!1});return n?g.a.createElement(g.a.Fragment,null,g.a.createElement(I.a,{className:bn.a.replyToIcon,selector:"chevronRightIcon"}),g.a.createElement(w.Typography,{type:"infoSm",className:bn.a.replyUsername},n)):null}var Mn=n(416),Rn=n.n(Mn),Sn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{onlyBadge:!1,isMobile:!1},n=t.onlyBadge,a=t.isMobile;if(!e)return null;function r(){return n?null:g.a.createElement(I.a,{className:Rn.a.FeaturedIcon,selector:"thumbtackIcon"})}function o(){return n&&!a?null:g.a.createElement("span",{className:Rn.a.Space},"Â·")}function s(){return g.a.createElement(w.Badge,null,g.a.createElement(N.a,{textKey:"featuredComment.".concat(a?"featured":"featuredBy"),params:{spotName:e.toUpperCase()}}))}return a?g.a.createElement(Oe.Row,{className:Rn.a.featuredBadgeRow},o(),r(),s()):g.a.createElement(Oe.Row,null,o(),r(),s())},Cn=n(52),wn=n.n(Cn);var kn=function(e){return e===(new Date).getFullYear()},On=n(749),In=n.n(On);var xn=function(e){var t=Object(ze.a)().t;function n(){var n=e.date;return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"short",a=e.getMonth()+1;return"".concat(e.getDate()," ").concat(t("".concat("prettyDate.","months.").concat(a,".").concat(n)),", ").concat(e.getUTCFullYear()," ").concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}("number"==typeof n?new Date(1e3*n):n,t)}e.longDate;var a=wn()(e,["longDate"]);return g.a.createElement(w.Typography,{className:In.a.dateFormat,type:"infoSm"},g.a.createElement("time",ke()({},a,{"aria-label":n(),title:n()}),function(){var n=e.date,a=e.longDate;return function(e,t,n){var a=e.getTime(),r=(Date.now()-a)/1e3,o=null,s=t?"long":"short",i=kn(e.getUTCFullYear());if(!a||isNaN(r))o="";else if(r<14)o=n("".concat("prettyDate.","now"));else if(r<60){var c=Math.floor(r);o=n("".concat("prettyDate.").concat(s,"Second"),{count:c,seconds:c})}else if(r<3600){var l=Math.floor(r/60);o=n("".concat("prettyDate.").concat(s,"Minute"),{count:l,minutes:l})}else if(r<86400){var u=Math.floor(r/3600);o=n("".concat("prettyDate.").concat(s,"Hour"),{count:u,hours:u})}else{var d=e.getUTCMonth()+1,p=Math.floor(r/86400);if(p<3)o=n("".concat("prettyDate.").concat(s,"Day"),{count:p,days:p});else if(pe.p){o=new Intl.DateTimeFormat(pe.g,{year:"numeric",month:"long",day:"numeric"}).format(e)}else o="".concat(e.getDate()," ").concat(n("".concat("prettyDate.","months.").concat(d,".").concat(s))).concat(t||!i?", ".concat(e.getUTCFullYear()):"")}return o}("number"==typeof n?new Date(1e3*n):n,a,t)}()))};function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Nn=function(e){c()(n,e);var t=Tn(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={isVisible:!1},e.handleUsernameMouseOver=function(){e.props.tracking.trackEvent({type:"user-profile-hovered",item_type:"main",message_id:e.props.message.id,target_id:e.props.user.id})},e.handleOpenUserProfile=function(t){var n=e.props,a=n.message,r=n.user,o=n.currentUser,s=n.tracking,i=Object(Bt.isSameUser)(o,r);s.trackEvent({type:"user-profile-clicked",item_type:"main",target_type:"tooltip"===t?"profile-preview":"message",native:0===a.depth?"comment":"reply",segment:"name",target_id:i?"my-profile":r.id,message_id:a.id,related_message_id:a.rootMessageId,ugc_post_id:e.props.conversationId})},e.renderFeaturedComment=function(){var t=e.props,n=t.message,a=t.spotName,r=t.isMobileDevice,o=void 0!==r&&r;return"top"===n.featuredComment?Sn(a,{onlyBadge:!1,isMobile:o}):n.featured?Sn(a,{onlyBadge:!0,isMobile:o}):null},e}return s()(n,[{key:"componentDidMount",value:function(){this.setState({isVisible:!0})}},{key:"render",value:function(){var e=this.props,t=e.message,n=e.user,a=e.messageUrl,r=e.reporters,o=e.currentUser,s=e.onMessageUrlClick,i=e.enableHideMessage,c=e.messageContextMenu,l=e.isMobileDevice,u=e.innerRef,d=e.t,p=e.isDisabled,m=e.children,f=this.state.isVisible,h=Array.isArray(r)&&(r.indexOf(n.username)>-1||r.indexOf(n.id)>-1),v=null;a&&(v=g.a.createElement(gn,{url:a,onClick:s}));var y=E()(Rn.a.username,{[Rn.a.brandFill]:h,[Rn.a.isUserProfileDisabled]:pe.o,[Rn.a.isDisabled]:p}),b=[];(o.id===t.user.id||o.isModerator)&&(b.push(d("delete")),i&&b.push(d("hide")));var M=t.depth>0,R=n.isRegistered&&pe.t&&!Object(vn.d)(n);return g.a.createElement(Oe.Column,{ref:u,className:E()(Rn.a.messageDetails,{[Rn.a.depth0]:0===t.depth})},g.a.createElement(Oe.Row,{className:Rn.a.messageDetailsRow},g.a.createElement(Oe.Username,{"data-spot-im-class":"message-username",className:y,user:this.props.user,onMouseOver:this.handleUsernameMouseOver,onOpenUserProfile:this.handleOpenUserProfile,truncated:!0}),R&&g.a.createElement(Oe.Reputation,{user:n}),g.a.createElement(Oe.Badge,{user:n,forceReporter:h}),g.a.createElement(En,{message:t,isMobile:l}),!l&&this.renderFeaturedComment()),g.a.createElement(Oe.Row,null,g.a.createElement("div",{className:Rn.a.stats},m,l&&this.renderFeaturedComment(),f&&g.a.createElement(xn,{"data-spot-im-class":"message-timestamp",id:"spotim-message-timestamp-".concat(M?"reply":"comment"),date:t.postedAt||t.publishedAt,longDate:!l}),null,v)),c)}}]),n}(h.Component);Nn.defaultProps={reporters:[],enableProfileHover:!0,spotName:"",showReplyTo:!1,messageUrl:null,onMessageUrlClick:function(){},onLogin:function(){},messageContextMenu:null,enableGamificationBadges:!0,featuredComment:null,journalistBadgeText:null,convId:""};var Dn=f()(Object(M.connect)((function(e){var t=e.moduleOptions,n=t.conversationId,a=t.enableGamificationBadges,r=t.enableSSO,o=t.spotName,s=t.textsOverrides,i=s.moderatorBadgeText,c=s.communityModeratorBadgeText,l=s.reporterBadgeText,u=t.isConnectEnabled,d=t.isMobile,p=e.conversation,m=p.contentType,f=p.id;return{conversationId:n,enableGamificationBadges:a,token:e.authentication.token,enableSSO:r,spotName:o,moderatorBadgeText:i,communityModeratorBadgeText:c,reporterBadgeText:l,reporters:P.h(e),currentUser:e.currentUser,showUserImageButton:u&&!r,isMobileDevice:P.l(e)||d,contentType:m,convId:f}}),{onLogin:At.a}),C()({}),Object(vt.a)())(Nn);function Ln(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var jn=function(e){c()(n,e);var t=Ln(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).onLoadFrameButtonClick=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];k.dispatchSpotimEvent.apply(void 0,[Dt.n].concat(t))},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.maxChars,a=e.maxLines,r=e.depth,o=e.shortenText,s=e.showFullText,i=e.innerRef,c=e.isDisabled,l=e.isLiveBlog,u=(e.showLoadFrameEntityButton,e.allowFrameEntityLoad),d=e.direction,p=e.forceEntityShow,m=e.t;return g.a.createElement(Y.MessageEntities,{message:t,isLtr:"ltr"===d,depth:r,innerRef:i,isDisabled:c,isLiveBlog:l,seeMoreTranslatedText:m("general.seeMore.long"),showPostText:m("general.showPost"),editedTranslatedText:m("message.edited"),showLoadFrameEntityButton:!1,onLoadFrameButtonClick:this.onLoadFrameButtonClick,allowFrameEntityLoad:u,direction:d,forceEntityShow:p,maxChars:n,maxLines:a,shortenText:o,showFullText:s,shadowRootCssModules:Be.c?["conversation"]:void 0})}}]),n}(h.Component);jn.displayName="MessageEntities",jn.propTypes={message:y.a.object.isRequired,direction:y.a.oneOf(["rtl","ltr"]).isRequired,flexDirection:y.a.oneOf(["column","row"]),showAttachment:y.a.bool,showSeeMoreButton:y.a.bool,noImageAnchors:y.a.bool,maxChars:y.a.number,maxLines:y.a.number,allowFrameEntityLoad:y.a.bool,depth:y.a.number,noAnchors:y.a.bool,shortenText:y.a.bool,richText:y.a.bool,preserveLinebreaks:y.a.bool,showLoadFrameEntityButton:y.a.bool,isMobileDevice:y.a.bool,showFullText:y.a.bool,forceEntityShow:y.a.bool,size:y.a.string,padMessage:y.a.bool,isModal:y.a.object,innerRef:y.a.object.isRequired,isDisabled:y.a.bool,isLiveBlog:y.a.bool},jn.defaultProps={showSeeMoreButton:!0,showAttachment:!1,maxChars:0,noAnchors:!1,noImageAnchors:!1,seeMoreTranslate:"long",shortenText:!1,depth:3,richText:!0,preserveLinebreaks:!0,showLoadFrameEntityButton:!0,forceEntityShow:!1,isMobileDevice:!1,size:"normal",padMessage:!0,flexDirection:"row"};var Un=f()(Object(M.connect)((function(e){return{noImageAnchors:e.moduleOptions.conversationImageAnchorsDisabled,allowFrameEntityLoad:e.moduleOptions.allowFrameEntityLoad,direction:e.moduleOptions.direction,isMobileDevice:P.l(e)||e.moduleOptions.isMobile,isLiveBlog:P.j(e)}})),Object(vt.a)())(jn),Pn=n(750),Bn=n.n(Pn);function An(e){var t=g.a.createElement($.a,{i18nKey:"message.contextMenu.muteUser.confirmation.mute.title"}),n=g.a.createElement($.a,{i18nKey:"message.contextMenu.muteUser.confirmation.mute.message"}),a=g.a.createElement($.a,{i18nKey:"message.contextMenu.muteUser.confirmation.mute.modalConfirm"}),r=g.a.createElement($.a,{i18nKey:"message.contextMenu.muteUser.confirmation.mute.cancelButton"});return g.a.createElement(w.Modal,{disableCustomBodyScroll:pe.j,shadowRootCssModules:Be.c?["conversation"]:void 0,isLtr:pe.w,closeButton:!0,showModal:e.showMuteUserModal,className:Bn.a.userMutingModal,onClose:function(){return e.onClose()},modalTitle:t,size:"md",bottomActions:g.a.createElement(w.Gutter,null,g.a.createElement(w.Button,{mode:"secondary",onClick:function(){return e.onClose()}},r),g.a.createElement(w.Button,{mode:"primary",onMouseEnter:e.muteUserHovered,onClick:function(){var t=e.message;(0,e.muteUser)(t.user.id),e.onClose(!0)}},a))},g.a.createElement("div",{className:Bn.a.text,style:{fontFamily:"Open Sans, Open Sans Hebrew, Arial",fontSize:"15px",lineHeight:"1.4",marginBottom:"24px"}},n))}var _n=n(751),Fn=n.n(_n),Vn=n(100),Kn=n(173),qn=n(417);function Hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Wn=function(e){c()(a,e);var t=Hn(a);function a(e){var o;return r()(this,a),(o=t.call(this,e)).getShowMoreRepliesComponent=function(){return n(417).default},o.showMoreReplies=function(){var e=o.props,t=e.tracking,n=e.messageStack,a=e.postId,r=e.onShowMoreReplies,s=n.message.id,i={message_id:s,type:"load-more-replies-clicked",post_id:a};t.trackEvent(i),r(s),Object(k.dispatchSpotimEvent)(U.b,s)},o.ShowMoreReplies=o.getShowMoreRepliesComponent(),o}return s()(a,[{key:"componentDidUpdate",value:function(e){e.isLoading&&!this.props.isLoading&&this.props.onDoneLoading()}},{key:"render",value:function(){return g.a.createElement(qn.default,ke()({showMoreReplies:this.showMoreReplies},this.props))}}]),a}(h.Component);Wn.propTypes={messageStack:y.a.object.isRequired,onShowMoreReplies:y.a.func,isLoading:y.a.bool,moreCount:y.a.number,isLastMessageInThread:y.a.bool,enableShowMore:y.a.bool,allCount:y.a.number,forceMessagesCollapsed:y.a.bool,onDoneLoading:y.a.func,numNewComments:y.a.number,numCollapsedChildren:y.a.number,onClick:y.a.func,depth:y.a.number},Wn.defaultProps={onShowMoreReplies:function(){},onDoneLoading:function(){},enableShowMore:!0};var zn=f()(Object(M.connect)((function(e,t){var n=t.messageStack,a=t.isLastMessageInThread,r=t.numCollapsedChildren,o=Ee.d(n),s=e.loadingReplies,i=!P.j(e),c=e.moduleOptions,l=c.spotId,u=c.postId;return{isLoading:!r&&s.isLoading&&s.rootMessageId===o.id,isLastMessageInThread:a,enableShowMore:i,moreCount:Object(Kn.d)(e.comments,n),allCount:Object(Kn.b)(e.comments,n),spotId:l,postId:u}}),{onShowMoreReplies:Vn.d}),C()({}))(Wn),Gn=n(160),Qn=n(418),Jn=n(419),Yn=n(755),Xn=n.n(Yn);function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var $n=function(e){c()(n,e);var t=Zn(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={isLoading:!1},e.showPreviousReplies=function(){var t=e.props,n=t.messageStack,a=t.onShowPreviousReplies;e.setState({isLoading:!0}),a(n)},e}return s()(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(){this.state.isLoading&&this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.props,t=e.messageStack,n=e.moreCount,a=e.repliesMaxDepth,r=this.state.isLoading;return n>0&&t.hasNext&&t.childrenStackIds.length>0?g.a.createElement("div",{className:E()(Xn.a.showPreviousReplies,Xn.a["depth-".concat(Math.min(t.message.depth,a))],{[Xn.a.loading]:r})},g.a.createElement(Qn.a,{className:Xn.a.link,onClick:this.showPreviousReplies},g.a.createElement("span",{className:Xn.a.showMoreRepliesText},g.a.createElement($.a,{i18nKey:"inpage.conversation.showPreviousMessages",count:n,values:{messagesCount:n}})),g.a.createElement(I.a,{selector:"chevronDownIcon",className:Xn.a.chevron})),r&&g.a.createElement(Jn.a,null)):null}}]),n}(h.Component);$n.defaultProps={moreCount:0,onShowPreviousReplies:function(){}};var ea=Object(M.connect)((function(e,t){var n=t.messageStack,a=e.comments,r=e.moduleOptions.repliesMaxDepth;return{moreCount:Object(Kn.d)(a,n),repliesMaxDepth:r}}),{onShowPreviousReplies:Gn.b})($n),ta=n(756),na=n.n(ta);function aa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ra=function(e){c()(n,e);var t=aa(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"shouldComponentUpdate",value:function(e){return e.typingUsers.length!==this.props.typingUsers.length}},{key:"render",value:function(){var e=this.props,t=e.messageStack,n=e.typingUsers,a=e.repliesMaxDepth,r=e.typingUsersCount,o=e.spotId,s=Math.min(t.message.depth,a),i=E()(na.a.typingUsers,na.a["depth-".concat(s)]);return g.a.createElement(fe,{className:i,users:n,typingUsersCount:r,size:"small",spotId:o})}}]),n}(h.Component);ra.propTypes={messageStack:y.a.object.isRequired,typingUsers:y.a.arrayOf(y.a.object).isRequired,repliesMaxDepth:y.a.number,spotId:y.a.string};var oa=Object(M.connect)((function(e,t){var n=t.messageStack,a=Ee.d(n).id,r=e.moduleOptions.spotId;return{repliesMaxDepth:e.moduleOptions.repliesMaxDepth,typingUsers:Object(re.c)(e,a),typingUsersCount:Object(re.d)(e,a),spotId:r}}))(ra),sa=n(172);var ia=n(49),ca=n(76),la=n(176);function ua(){return function(){var e=J()(G.a.mark((function e(t,n){var a,r,o,s,i,c,l;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=n(),r=a.moduleOptions.postId,o=a.userSuspension.isFetched,s=Object(ca.f)(),!o&&s){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Object(la.c)(r);case 7:i=e.sent,c=i.suspended,l=i.suspension_expiration,t({type:ct.z,payload:{isUserSuspended:c,expirationTime:l}}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),t({type:ct.z,payload:{isUserSuspended:!1}}),kt.a.error("fetchUserSuspensionStatus",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()}var da={LINEAR:function(e){return e},IN_OUT_QUART:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}};var pa=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:da.LINEAR;return new Promise((function(r){var o=window===e;if(n<=0)r();else{var s=o?e.pageYOffset:e.scrollTop,i=t-s,c=Date.now()+n;requestAnimationFrame((function e(){var o=1-(c-Date.now())/n;if(o>=0&&o<=1){var u=a(o)*i;l(Math.floor(s+u)),requestAnimationFrame(e)}else l(t),r()}))}function l(t){o?e.scroll(0,t):e.scrollTop=t}}))};function ma(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.element,n=e.stackId,a=void 0===n?null:n,r=e.depth;return function(e,n){if(Object(k.dispatchSpotimEvent)(Dt.m),Ie.a){var o=document.body.getBoundingClientRect(),s=t.getBoundingClientRect().top-o.top;pa(window,s-20,200)}var i=n(),c=i.currentUser,l=i.moduleOptions.loginUponSayControlFocus,u=Object(ia.d)(c);l&&!u&&e(Object(At.a)()),e(ua()),e({type:ct.A,payload:{stackId:a,depth:r}})}}var fa=n(104);function ha(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.stackId,n=void 0===t?null:t;return function(){var e=J()(G.a.mark((function e(t,a){var r,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a(),(null==(o=r.communityView)?void 0:o.focusSayControlOnSwitchTab)&&t(Object(fa.b)(!1)),Object(k.dispatchSpotimEvent)(Dt.l),t({type:ct.i,payload:{stackId:n}});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}var ga=n(257),va=n.n(ga),ya=n(219);var ba=n(82),Ea={};function Ma(e){return function(t,n){try{var a=n().conversation.id;Ea[e]?Ea[e]():Ea[e]=va()((function(){var t,n;t=a,n=e,Object(Ot.a)("v1.0.0/conversation/typing/create",{method:"POST",postId:Object(ya.a)(t),data:{conversation_id:t,message_id:n}})}),ba.g,null,{trailing:!1})}catch(e){kt.a.error("notifyTyping",e)}}}var Ra=n(65),Sa=n(120),Ca=n(307),wa=n(177);function ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ka(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ka(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ia(e){var t=$t.a.map(e,Object(wa.a)("message"),{conversation_id:"conversation.id",etag:"conversation.etag"}),n=t.message,a=t.conversation,r=t.users;return r&&Object(Ca.a)(n,r),{message:n,conversation:a,users:r}}function xa(e,t){return function(){var n=J()(G.a.mark((function n(a){var r;return G.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{r=e,a(t?{type:ct.U,payload:{starsRating:r,messageId:t}}:{type:ct.T,payload:{starsRating:r}})}catch(e){a({type:ct.T,payload:{error:error},error:!0}),kt.a.error("updateStarsRating",e)}case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}function Ta(e){return{type:ct.o,payload:{parentMessageId:e}}}var Na=n(441),Da=n(151);function La(e){var t=e.entities,n=void 0===t?[]:t,a=e.starsRating,r=void 0===a?0:a,o=e.parentMessageId;return function(){var e=J()(G.a.mark((function e(t,a){var s,i,c,l,u,d;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=a(),i=s.moduleOptions.postId,!(0===n.length||1===n.length&&n.find((function(e){return"text"===e.type&&""===e.text})))){e.next=6;break}return t({type:ct.X,payload:{verdict:Da.a.APPROVE_ALL,tags:[],parentMessageId:o}}),e.abrupt("return");case 6:return c=Object(Na.a)(n),e.next=9,Object(la.b)(i,{content:c,stars:r,metadata:{}});case 9:l=e.sent,u=l.verdict,d=l.tags,t({type:ct.X,payload:{verdict:u,tags:d,parentMessageId:o}}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),t({type:ct.X,payload:{error:e.t0,parentMessageId:o}}),kt.a.error("realtimeModerate",e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}()}var ja=n(757),Ua=n.n(ja),Pa=n(758),Ba=n.n(Pa),Aa=function(e){var t,n,a=e.total,r=void 0===a?1:a,o=e.isLtr,s=void 0===o||o;return g.a.createElement("div",{className:Ba.a.pointsWrapper},g.a.createElement("span",{className:Ba.a.dotSeparator}),g.a.createElement(w.Tooltip,{isLtr:s,placement:"bottom",trigger:Object(Ie.b)()?"click":"hover",onShowChange:function(e){return e&&void 0},tooltipContent:g.a.createElement("div",{className:Ba.a.tooltipWrapper},g.a.createElement(w.Typography,{type:"infoXs",color:"#fff"},g.a.createElement($.a,{i18nKey:"user.reputation.description"},"Reputation points are measured by how other community members respond to your contributions. The more positive impact you make, the more points you gain.")),g.a.createElement(w.Button,{className:Ba.a.learnMoreBtn,onClick:function(){var e,t,n;null===(e=window)||void 0===e||null===(t=e.__OPEN_WEB__)||void 0===t||null===(n=t.renderReputationDescriptionModal)||void 0===n||n.call(t)}},g.a.createElement(w.Typography,{type:"infoXs",weight:"bold",color:"#fff"},g.a.createElement($.a,{i18nKey:"realtimeModeration.learnMore"},"Learn More"))))},g.a.createElement(w.Typography,{type:"infoSm"},(t=Object(k.parseNumber)(r),n=r,g.a.createElement($.a,{i18nKey:"user.reputation.point",count:n,values:{points:t}},t," Points")))))},_a=n(50),Fa=Object(M.connect)((function(e){var t=e.moduleOptions.spotName,n=e.liveBlogConfig.reporters,a=e.conversation;return{contentType:a.contentType,convId:a.id,spotName:t,reporters:n}}))((function(e){var t,n=e.currentUser,a=e.handleUploadProfileImage,r=e.handleUserProfileClick,o=e.contentType,s=e.convId,i=e.reporters,c=n.isRegistered&&pe.t&&!Object(vn.d)(n),l=Object(S.useTracking)();function u(){o===_a.b.Post&&l.trackEvent({type:"my-profile-clicked",item_type:"post-card",ugc_post_id:s})}var d=Object(Bt.getDisplayName)(n),p=d&&!pe.o?Ua.a.username:Ua.a.emptyUsername,m=Array.isArray(i)&&(i.some((function(e){return e===n.username}))||i.some((function(e){return e===n.id})));return g.a.createElement(Oe.Row,{className:E()({[Ua.a.usernameWrapper]:!pe.n})},g.a.createElement(de.b,{className:Ua.a.richEditorUserAvatar,isOnline:n.isOnline,size:de.a.NORMAL,onImageUpload:a,user:n,onClick:function(){u()}}),g.a.createElement(w.Button,{onClick:function(){pe.o||(u(),r())},className:E()({[Ua.a.emptyUsername]:!d||pe.o})},g.a.createElement(w.Typography,{type:"username",className:p,"data-open-web-class":"user-name"},d||g.a.createElement($.a,{i18nKey:"richEditor.placeholder.displayName"},"Your Username"))),g.a.createElement(Oe.Badge,{user:n,forceReporter:m}),!n.isRegistered&&(Object(vn.e)(n.id)?g.a.createElement("div",{className:Ua.a.guestBadge},g.a.createElement("span",{className:Ua.a.dotSeparator}),g.a.createElement(w.Typography,{type:"infoMd"},g.a.createElement($.a,{i18nKey:"general.guest"},"Guest"))):null),c&&g.a.createElement(Aa,{total:(null===(t=n.reputation)||void 0===t?void 0:t.total)||1,isLtr:pe.w}))})),Va=n(402),Ka=n.n(Va),qa=n(401),Ha=n.n(qa),Wa=n(759),za=n.n(Wa),Ga=n(760),Qa=n.n(Ga),Ja=function(e){var t=e.onCancel;return g.a.createElement(w.Button,{className:Qa.a.cancelButton,onClick:t,"data-spot-im-class":"rich-editor-cancel-button"},g.a.createElement($.a,{i18nKey:"richEditor.cancel"},"Cancel"))},Ya=n(761),Xa=n.n(Ya),Za=function(e){var t=e.isLoading,n=void 0!==t&&t,a=e.hasText,r=e.hasMediaEntity,o=e.onEdit,s=Object(h.useRef)(null),i=Object(h.useState)(0),c=Fe()(i,2),l=c[0],u=c[1];return Object(h.useEffect)((function(){if(s.current){var e=s.current.getBoundingClientRect();u(e.width)}}),[]),g.a.createElement(w.Button,{mode:"primary",className:Xa.a.updateButton,disabled:!(a||r),onClick:o,"data-spot-im-class":"rich-editor-update-button",ref:s,style:n?{width:"".concat(l,"px")}:void 0},n?g.a.createElement(j.a,null):g.a.createElement($.a,{i18nKey:"richEditor.update"},"Update"))},$a=n(103),er=n(762),tr=n.n(er);function nr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ar=function(e){c()(n,e);var t=nr(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={sendMessageAfterConnect:0,buttonWidth:0,isPostPage:e.props.contentType===_a.b.Post},e.buttonRef=g.a.createRef(),e.enableLoginButton=function(){var t=e.props,n=t.hasText,a=t.hasMediaEntity,r=t.isLoggedIn,o=t.isMustRegisterToComment;return!(n||a)&&o&&!r},e.handleSendButtonKeyUp=function(t){13===t.keyCode&&e.handleClick()},e}return s()(n,[{key:"componentDidMount",value:function(){if(this.buttonRef.current){var e=this.buttonRef.current.getBoundingClientRect();this.setState({buttonWidth:e.width})}}},{key:"componentDidUpdate",value:function(){var e=this,t=this.state,n=t.buttonWidth;if(2===t.sendMessageAfterConnect&&(this.setState({sendMessageAfterConnect:0}),setTimeout((function(){e.handleClick()}),1)),this.buttonRef.current){var a=this.buttonRef.current.getBoundingClientRect();n!==a.width&&this.setState({buttonWidth:a.width})}}},{key:"handleClick",value:function(){var e=this.props,t=e.isLoading,n=e.isLoggedIn,a=e.onCreate,r=e.isMustRegisterToComment,o=e.convId;t||(r&&!n||this.enableLoginButton()?Object($a.d)():this.isDisabled()||(this.state.isPostPage&&this.props.tracking.trackEvent({type:"posted",ugc_post_id:o}),a()))}},{key:"isDisabled",value:function(){var e=this.props,t=e.hasText,n=e.hasMediaEntity,a=e.isUserDisplayNameEmpty,r=e.isLoggedIn,o=e.withTransition,s=e.isPostAnyway,i=e.isUserSuspended,c=e.isDisplayNameRequired,l=e.hasStarsRating;return e.disableButtonWithEmptyText&&(!(t||n||l)||i||o&&!s&&!l||a&&c&&!1===r)&&!this.enableLoginButton()}},{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.sendButtonText,a=e.signupButtonText,r=e.isMustRegisterToComment,o=e.isLoggedIn,s=(e.disableButtonWithEmptyText,e.isPostAnyway),i=e.withTransition,c=e.isUserSuspended,l=null;l=t?g.a.createElement(j.a,null):!o&&r?g.a.createElement($.a,{i18nKey:"richEditor.mustRegisterToComment",textOverride:a},"Sign up to post"):s&&!c?g.a.createElement($.a,{i18nKey:"richEditor.postAnyway"},"Post Anyway"):g.a.createElement($.a,{i18nKey:"richEditor.post",textOverride:n},"Send");var u=E()(tr.a.sendButton,{[tr.a.disabled]:this.isDisabled(),[tr.a.slideDown]:i,[tr.a.postAnyway]:s});return g.a.createElement(w.Button,{className:u,mode:"primary",disabled:this.isDisabled(),onClick:this.handleClick.bind(this),"data-spot-im-class":"rich-editor-send-button",ref:this.buttonRef,style:t?{width:"".concat(this.state.buttonWidth,"px")}:void 0},l)}}]),n}(h.Component);ar.propTypes={},ar.defaultProps={isUserDisplayNameEmpty:!0,isLoading:!1,hasText:!1,disableButtonWithEmptyText:!0,sendButtonText:void 0,signupButtonText:void 0,isPostAnyway:!1,withTransition:!1,isDisplayNameRequired:!1,hasStarsRating:!1};var rr=f()(Object(M.connect)((function(e){var t;return{isUserSuspended:null===(t=e.userSuspension)||void 0===t?void 0:t.isUserSuspended,spotId:e.moduleOptions.spotId,contentType:e.conversation.contentType,convId:e.conversation.id}})),C()({}))(ar),or=function(e){var t,n,a=e.hasText,r=e.isLoading,o=e.isEdit,s=e.showCancelButton,i=e.disableSendButtonWithEmptyText,c=e.displayName,l=e.isMustRegisterToComment,u=e.isLoggedIn,d=e.sendButtonText,p=e.signupButtonText,m=e.hasMediaEntity,f=e.isPostAnyway,v=e.moderationAlert,y=e.starsRatingAlert,b=e.isDisplayNameRequired,M=e.showErrorBorder,R=e.onCancel,S=void 0===R?function(){}:R,C=e.onEdit,w=void 0===C?function(){}:C,k=e.onCreate,O=e.onLogin,I=e.hasStarsRating,x=E()(za.a.mainButtonsWrapper,{[za.a.edit]:o}),T=Object(h.useMemo)((function(){return b&&function(e){return!e||0===e.trim().length}(c)}),[b,c]);if(o)t=g.a.createElement(Ja,{onCancel:S}),n=g.a.createElement(Za,{isLoading:r,onEdit:w,hasMediaEntity:m,hasText:a});else{n=g.a.createElement(rr,{disableButtonWithEmptyText:i,displayName:c,onCreate:k,onLogin:O,isMustRegisterToComment:l,isLoading:r,isLoggedIn:u,hasText:a,hasStarsRating:I,isUserDisplayNameEmpty:T,sendButtonText:d,signupButtonText:p,hasMediaEntity:m,withTransition:M,isPostAnyway:v&&f,isDisplayNameRequired:b});s&&(t=g.a.createElement(Ja,{onCancel:S}))}return g.a.createElement("div",{className:x},y,v,t,n)},sr=n(264),ir=va()((function(e,t,n){localStorage.setItem("SPOTIM_GUEST_DISPLAY_NAME",JSON.stringify({[t.id]:n})),e({type:ct.k,payload:{displayName:n}})}),500);var cr,lr=n(763),ur=n.n(lr);function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var pr=Re.a.get("init_data.config.emoji_keyboard_enabled",!1),mr=function(e){c()(n,e);var t=dr(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).input=g.a.createRef(),a.inputRef=g.a.createRef(),a.state={value:e.textEntity.text},a.simpleRef=g.a.createRef(),a}return s()(n,[{key:"componentDidMount",value:function(){var e=this;(cr=new IntersectionObserver((function(t){t[0].isIntersecting&&(e.props.onViewed(),cr.disconnect())}))).observe(this.simpleRef.current);var t=this.props,n=t.text,a=t.editorEventHandlers,r=this.input.current;n&&(r.value=n),Object.keys(a).forEach((function(e){"text-change"===e&&r.addEventListener("keyup",a["text-change"],!1)}))}},{key:"getMentionEntities",value:function(){return[]}},{key:"getTextEntity",value:function(){var e=this.input.current.value;return Object(Y.createTextEntityObject)({text:e})}},{key:"focus",value:function(){}},{key:"blur",value:function(){this.input.current.blur()}},{key:"setText",value:function(e){this.input.current.value=e,this.setState({value:e})}},{key:"handleFocus",value:function(){this.props.onFocus(),this.input.current.removeAttribute("rows"),this.setState({isFocused:!0})}},{key:"handleChange",value:function(e){this.setText(e.target.value),this.props.onChange()}},{key:"render",value:function(){var e,t=this.props,n=t.placeholder,a=t.maxLength,r=t.onBlur,o=t.textEntity,s=t.requireDisplayName,i=t.displayName,c=t.displayNamePlaceHolder,l=t.isUploadImageButtonVisible,u=this.state.isFocused,d={rows:1,className:E()(ur.a.simpleEditor,vn.c&&ur.a.isIE,u&&ur.a.focused),ref:this.input,onFocus:this.handleFocus.bind(this),onBlur:r,placeholder:n};return a>0&&(d.maxLength=a),g.a.createElement("div",{ref:this.simpleRef,className:ur.a.richEditor},g.a.createElement("div",{className:ur.a.container},s&&g.a.createElement("div",{className:ur.a.displayNameWrapper},g.a.createElement("div",{className:ur.a.displayNameInput},i?g.a.createElement("div",{ref:this.input,onFocus:this.handleFocus.bind(this),contentEditable:!0,dangerouslySetInnerHTML:{__html:i}}):g.a.createElement("div",ke()({},d,{className:ur.a.placeholder,onClick:this.handleFocus.bind(this),contentEditable:!0,dangerouslySetInnerHTML:{__html:c}})))),g.a.createElement("div",ke()({ref:this.input},d,{contentEditable:!0,"data-placeholder":n,className:ur.a.simpleEditor,id:"spotim-say-config",dangerouslySetInnerHTML:{__html:null===(e=Object(Y.getTextEntity)(o))||void 0===e?void 0:e.text}})),g.a.createElement("div",{className:ur.a.panel},pr&&!Ie.a&&g.a.createElement(w.Button,{className:ur.a.icon},g.a.createElement(I.a,{selector:"emoji"})),l&&g.a.createElement(w.Button,{className:ur.a.icon},g.a.createElement(I.a,{selector:"cameraIcon"})),g.a.createElement(w.Button,{className:ur.a.icon},g.a.createElement(I.a,{selector:"gifIcon"})))))}}]),n}(h.Component);mr.propTypes={placeholder:y.a.string,textEntity:y.a.object,maxLength:y.a.number,onFocus:y.a.func,onBlur:y.a.func,editorEventHandlers:y.a.object,requireDisplayName:y.a.bool,displayName:y.a.string,displayNamePlaceHolder:y.a.string,isUploadImageButtonVisible:y.a.bool},mr.defaultProps={placeholder:"Compose an epic...",textEntity:Object(Y.createTextEntityObject)(),maxLength:0,onFocus:function(){},onBlur:function(){},editorEventHandlers:{}};var fr=n(91);var hr=function(e){var t,n=document.querySelector(e);return n&&(t=n.getAttribute("src")),t},gr=n(764);function vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vr(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function br(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Er=g.a.lazy((function(){return Promise.resolve().then(n.t.bind(null,764,7))})),Mr=Ka()((function(){return n.e(81).then(n.t.bind(null,894,7))})),Rr=function(e){c()(a,e);var t,n=br(a);function a(e){var t;return r()(this,a),(t=n.call(this,e)).isLoginOccurred=!1,t.simpleEditorTextEntity=void 0,t.debouncedRTMessage=void 0,t.ref=void 0,t.lazyRenderModule=function(e,t){var n;switch(e){case gr.ModulesNames.emojiPicker:n=g.a.createElement(Mr,t)}return g.a.createElement(h.Suspense,{fallback:null},n)},t.addStarsRating=function(e){t.setState(yr(yr({},t.state),{},{hasStarsRating:e>0}))},t.onStarsRatingClick=function(e){t.props.onStarsRatingClick(e),t.addStarsRating(e)},t.moderateRT=function(){Object(ca.d)()&&t.props.onRealtimeModeration({entities:t.state.entities,starsRating:t.state.starsRating})},t.onChange=function(e){var n=e.entities,a=e.displayName,r=e.starsRating,o=e.isEmpty,s=e.length,i=e.postId,c=e.lastChar,l=t.state.shouldSendTypingEvent;t.setState({entities:null!=n?n:t.state.entities,displayName:null!=a?a:t.state.displayName,starsRating:null!=r?r:t.state.starsRating,hasText:!o&&"boolean"==typeof o||"boolean"!=typeof o&&t.state.hasText,length:null!=s?s:t.state.length}),l&&t.setState({shouldSendTypingEvent:!1},(function(){var e={type:"typing",post_id:i||""};Object(fr.analyticsTrack)(e)})),t.props.onChange({isEmpty:o}),t.props.onTyping(c),null!=a&&t.onDisplayNameChange(a),o||t.debouncedRTMessage()},t.handleBlur=J()(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.createMessagePayload(),t.props.onBlur({draftMessage:n});case 2:case"end":return e.stop()}}),e)}))),t.getInsertedKeyCode=function(e){var t;return(null===(t=(e.ops||[]).find((function(e){return e.insert})))||void 0===t?void 0:t.insert.charCodeAt(0))||-1},t.loadEditor=function(){t.setState({showEditor:!0})},t.setFocus=function(){t.state.ready||t.setState({ready:!0}),t.handleFocus()},t.handleFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{focusOnDisplayName:void 0},n=e.focusOnDisplayName;t.setState({focusOnDisplayName:n}),t.callOnFocus(),t.setState({showToolTip:!1})},t.hasMediaEntity=function(){return!!t.state.mediaEntity},t.handleLogin=J()(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.createMessagePayload(),t.isLoginOccurred=!0,t.props.login(n);case 3:case"end":return e.stop()}}),e)}))),t.createMessage=J()(G.a.mark((function e(){var n,a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.props.createMessage,a=t.state.mediaEntity,r=t.createMessagePayload(),t.setState({shouldSendTypingEvent:!0}),n(r).then((function(e){var n=e.payload.isMessageBlockedVerdict;!e.error&&n?t.setState({hasText:!0,mediaEntity:a}):(t.setState(t.getResetState()),t.ref.current.reset()),t.handleBlur()})),t.props.onChange&&t.props.onChange({isEmpty:!0}),t.props.onPost&&t.props.onPost();case 7:case"end":return e.stop()}}),e)}))),t.editMessage=J()(G.a.mark((function e(){var n,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.props.editMessage,e.next=3,t.createMessagePayload();case 3:a=e.sent,t.setState(t.getResetState()),n(a);case 6:case"end":return e.stop()}}),e)}))),t.createMessagePayload=function(){var e=t.props,n=e.starsRating,a=e.enableStarsRating,r=e.isLoggedIn,o=e.currentUser,s=e.requireDisplayName,i=t.state.entities,c=o.displayName,l={entities:i};return s&&!r&&(l.displayName=c),a&&(l.starsRating=n),l},t.onDisplayNameChange=function(e){var n=t.props.onUsernameChange;null==n||n(e)},t.closeRichEditor=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t.props,a=n.closeEditRichEditor,r=n.messageToEdit,o=n.isEditRichEditor;o?a({messageId:null==r?void 0:r.id}):e&&t.ref.current.reset()},t.isExpanded=function(){var e,n;return t.props.isExpanded||t.state.showStickyRTE||t.isSubmitting()||0===(null===(e=t.props.messageToEdit)||void 0===e||null===(n=e.id)||void 0===n?void 0:n.indexOf("sp_"))},t.isSubmitting=function(){var e=t.props,n=e.isRootMessage,a=e.isSubmittingComment,r=e.isSubmittingReply,o=e.isSubmittingEdit;return n&&a||!n&&r||!n&&o},t.handleSubmit=function(){var e=t.props.isEdit;t.props.requireDisplayName&&!t.props.currentUser.displayName||(e?t.editMessage():t.createMessage())},t.state=yr(yr({},t.getResetState()),{},{showTooltip:!1,ready:!1,shouldSendTypingEvent:!0,showStickyRTE:!1}),t.simpleEditorTextEntity=t.getDraftMessage()||e.messageToEdit,t.debouncedRTMessage=Ha()(t.moderateRT,ca.a),t.ref=g.a.createRef(),t}return s()(a,[{key:"preloadExternalModules",value:function(){Mr.preload()}},{key:"getResetState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.props,n=t.isExpanded,a=t.messageToEdit,r=t.currentUser;return{mediaEntity:void 0,hasText:!e&&Object(Y.hasText)(a),isLoading:!1,isExpanded:n,length:0,displayName:Object(Bt.getDisplayName)(r),entities:[],starsRating:0,hasStarsRating:this.props.starsRating>0}}},{key:"getDraftMessage",value:function(){var e=this.props.draftKey;return Object(sa.getDraftMessage)(e)}},{key:"UNSAFE_componentWillMount",value:function(){var e=Object(Y.getMediaEntity)(this.props.messageToEdit);e&&this.setState({mediaEntity:e})}},{key:"componentDidMount",value:(t=J()(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,this.props.requestSetFocus)(this.setFocus),"object"==typeof window&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&this.loadEditor();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(e){this.isLoginOccurred&&!1===e.isLoggedIn&&!0===this.props.isLoggedIn&&(this.createMessage(),this.isLoginOccurred=!1);var t=this.props.currentUser;e.currentUser.id!==t.id&&(t.isRegistered||this.setState(this.getResetState(!0))),e.starsRating!==this.props.starsRating&&this.addStarsRating(this.props.starsRating)}},{key:"callOnFocus",value:function(){var e=this.props,t=e.isReply,n=e.autoFocus,a=this.state,r=a.showEditor,o=a.ready,s=this.shouldRenderRichEditor(r,n,o);(!s||s&&!this.isExpanded()||t&&!this.isExpanded())&&"function"==typeof this.props.onFocus&&this.props.onFocus({element:Object(R.findDOMNode)(this)})}},{key:"shouldRenderRichEditor",value:function(e,t,n){return e||t||n&&this.isExpanded()}},{key:"renderEditor",value:function(){var e=this,t=this.props,n=t.placeholderTextKey,a=t.placeholderReplyToName,r=t.autoFocus,o=t.isReply,s=t.t,i=t.preventScrollOnAutoFocus,c=t.requireDisplayName,l=t.animationRating,u=t.isUploadImageButtonVisible,d=t.currentUser,p=t.showErrorBorder,m=t.isUserSuspended,f=t.starsRating,v=t.enableStarsRating,y=t.draftKey,b=s(n,{displayName:a}),E=g.a.createElement(mr,{isUploadImageButtonVisible:u,onViewed:this.loadEditor,displayNamePlaceHolder:s("richEditor.placeholder.displayName"),displayName:Object(Bt.getDisplayName)(d),requireDisplayName:c,maxLength:1500,placeholder:b,textEntity:this.simpleEditorTextEntity,onFocus:function(){e.setState({ready:!0}),e.handleFocus()},onBlur:this.handleBlur,editorEventHandlers:{"text-change":this.onChange}});return g.a.createElement(h.Suspense,{fallback:E},g.a.createElement(Er,{renderModule:this.lazyRenderModule,isMobileDevice:Object(Ie.b)(),messageToEdit:this.props.messageToEdit,ref:this.ref,direction:this.props.direction,onChange:this.onChange,onBlur:this.handleBlur,onSubmit:this.handleSubmit,preventScrollOnOpen:i,requireDisplayName:c,currentUser:d,hasError:p,disabled:m,tabIndexType:"editor",isReply:o,isExpanded:this.isExpanded(),animationRating:l,isUploadImageButtonVisible:u,placeholderTextKey:b,displayNamePlaceHolder:s("richEditor.placeholder.displayName"),autoFocus:r,enableStarsRating:v,onFocus:function(){e.setState({ready:!0}),e.handleFocus()},starsRating:f,onStarsRatingClick:this.onStarsRatingClick,draftKey:y,maxLength:pe.y,isLoadingMediaEntity:function(t){e.setState({isLoading:t})}}))}},{key:"render",value:function(){var e=this.props,t=e.isLoggedIn,n=e.disableSendButtonWithEmptyText,a=e.isMustRegisterToComment,r=e.sendButtonText,o=e.signupButtonText,s=e.currentUser,i=e.showCancelButton,c=e.showErrorBorder,l=e.moderationAlert,u=e.starsRatingAlert,d=e.isPostAnyway,p=e.isEdit,m=e.requireDisplayName,f=this.state,h=f.isLoading,v=f.mediaEntity,y=f.hasStarsRating,b=s.displayName;return g.a.createElement("div",{onMouseEnter:this.preloadExternalModules},this.renderEditor(),this.isExpanded()&&g.a.createElement(or,{displayName:b,isMustRegisterToComment:a,isLoggedIn:t,onEdit:this.editMessage,onCancel:this.closeRichEditor,onCreate:this.createMessage,onLogin:this.handleLogin,isEdit:p,hasText:this.state.hasText,isLoading:h||this.isSubmitting(),sendButtonText:r,signupButtonText:o,disableSendButtonWithEmptyText:n,showCancelButton:i,hasMediaEntity:!!v,isPostAnyway:d,showErrorBorder:c,moderationAlert:l,starsRatingAlert:u,isDisplayNameRequired:m,hasStarsRating:y}))}}]),a}(h.Component);Rr.defaultProps={placeholderTextKey:"richEditor.placeholder.hasMessages",messageToEdit:Object(Y.createMessageObject)(),replyToMessage:Object(Y.createMessageObject)(),isExpanded:!1,hidePanel:!1,cancel:function(){},editMessage:function(){},createMessage:function(){},closeEditRichEditor:function(){},direction:"ltr",onBlur:function(){},onFocus:function(){},onTyping:function(){},blurOnFocusForGuestUser:!1,openUserProfileModal:function(){},requestSetFocus:function(){},moderationAlert:null,starsRatingAlert:null,showErrorBorder:!1,onRealtimeModeration:function(){},isPostAnyway:!1,isEdit:!1};var Sr=f()(Object(M.connect)((function(e,t){var n,a,r=e.messageSayControls,o=e.moduleOptions,s=e.currentUser,i=e.moduleOptions,c=i.spotId,l=i.hashImageSelector,u=i.textsOverrides,d=i.postId,p=i.elementId,m=i.forceRegister,f=e.conversation,h=f.isSubmittingComment,g=f.isSubmittingReply,v=f.isSubmittingEdit,y=e.userSuspension.isUserSuspended,b=t.messageToEdit,E=t.replyToMessage,M=t.isEditRichEditor,R=Object(vn.b)({isRegistered:s.isRegistered,isForceRegister:m,userId:s.id}),S=r[M?b&&b.id:E&&E.id];return{isRendered:S&&S.isRendered,connectTypes:o.connectTypes,spotId:c,sendButtonText:u.conversationSayControlSendButton,signupButtonText:u.conversationSayControlSignupButton,isSubmittingComment:h,isSubmittingReply:g,isSubmittingEdit:v,isUserSuspended:y,requireDisplayName:R,uploadImage:(a=J()(G.a.mark((function e(t){var n,a,r,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sr.a.upload(t);case 2:return n=e.sent,a=n.public_id,r=n.height,o=n.width,e.abrupt("return",{publicId:a,height:r,width:o});case 7:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)}),findHashImageUrl:(n=J()(G.a.mark((function e(t){var n,a,r,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.replace(/{HASH_ID}/g,t),e.next=3,hr(n);case 3:return a=e.sent,r=Fe()(a,1),o=r[0],e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),postId:d,elementId:p}}),(function(e,t){return{openUserProfileModal:function(n){return e(t.openUserProfileModal({user:n}))},msnSocialLoginDispatcher:function(){return e(t.msnSocialLogin())},onUsernameChange:function(t){e(function(e){return function(t,n){var a=n().currentUser;ir(t,a,e)}}(t))}}}),null,{forwardRef:!0}),Object(vt.a)(void 0,{withRef:!0}))(Rr);function Cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function wr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Or=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(18),n.e(26)]).then(n.bind(null,907))})),Ir=function(e){c()(n,e);var t=kr(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).wrapperRef=void 0,e.getDraftKey=function(){var t=e.props,n=t.stackId,a=t.depth;return"conversation_".concat(n,"-depth-").concat(a)},e.handleFocus=function(t){var n=t.element,a=e.props,r=a.conversationId,o=a.stackId;e.props.onFocus({element:n,stackId:o}),e.props.tracking.trackEvent({type:"editor-reply-focus",ugc_post_id:r})},e.handleBlur=function(){var t=e.props.stackId;e.props.onBlur({stackId:t})},e.handleCloseEditSayControl=function(t){var n=t.messageId;e.props.closeEditSayControl({messageId:n})},e.handleUploadProfileImage=function(t){e.props.onProfileImageUpload({rawImage:t})},e.editMessage=function(t){var n=t.entities,a=t.displayName,r=t.starsRating,o=void 0===r?0:r,s=e.props,i=s.messageToEdit,c=s.editMessage,l=i.depth,u=i.status,d=i.starsRating;c({entities:n,oldEntities:i.entities,starsRating:o,oldStarsRating:d,depth:l,messageId:i.id,displayName:a,status:u})},e.createMessage=function(t){var n=t.entities,a=t.displayName,r=t.starsRating,o=void 0===r?0:r,s=e.props,i=s.replyToMessage,c=s.rootMessageId,l=s.replyToStackId,u=(s.conversationId,{entities:n,starsRating:o,rootMessageId:c});return a&&(u.displayName=a),l&&(u.replyToStackId=l),i&&(u.parentMessageId=i.id,u.replyToUserId=i.user.id,u.replyToUsername=i.user.username,u.replyToDisplayName=i.userDisplayName||i.user.displayName,u.depth=i.depth+1),Object(sa.clearDraftMessage)(e.getDraftKey()),e.props.createMessage(u)},e.handleStarsRatingClick=function(t){var n=e.props.messageToEdit.id;e.props.onStarsRatingClick(t,n)},e.handleRichEditorContract=function(){e.props.onContract({messageId:e.props.replyToMessage.id})},e.onTyping=function(t){var n=e.props,a=n.isMessageBlocked,r=n.onTyping,o=n.closeModerationAlert,s=n.isModerationAlertVisible,i=n.isUserSuspended,c=n.currentUser,l=n.isAfterClickFeedback;!i&&a&&s&&ca.g(t)&&(o(),l&&e.props.tracking.trackEvent({item_type:"realtime-moderation",user_id:c.id,is_registered:c.isRegistered,type:"post-edited",target_type:"after-post"})),r()},e.onRealtimeModeration=function(t){var n=e.props,a=n.isMessageBlocked,r=n.onRealtimeModeration;a||r(t)},e.setWrapperRef=function(t){e.wrapperRef=t},e.handleClickOutside=function(t){var n=e.props.isModerationAlertVisible,a=null==t?void 0:t.composedPath();try{var r,o,s=a.some((function(e){var t;return null===(t=e.dataset)||void 0===t?void 0:t.spotimOverlay}));(null===(r=e.wrapperRef)||void 0===r?void 0:r.contains(a[1]))||s||(null===(o=e.state)||void 0===o?void 0:o.hasText)||n||e.handleRichEditorContract()}catch(e){}},e.onChange=function(t){var n=t.isEmpty;e.setState({hasText:!n})},e.handleUserProfileClick=function(){var t=e.props.currentUser;(t.isRegistered||t.displayName)&&e.props.onOpenUserProfileModal({user:t,mode:"main"})},e.shouldDisplayUsername=function(){var t=e.props,n=t.forceRegister,a=t.currentUser;return!n||a.isRegistered},e}return s()(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.isRendered,a=t.isEditRichEditor,r=t.replyToMessage,o=t.messageToEdit,s=t.onRendered,i=a?o.id:r.id;n||s(i),requestAnimationFrame((function(){return document.addEventListener("click",e.handleClickOutside)}))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside)}},{key:"handleLogin",value:function(){var e=this.props,t=e.tracking,n=e.onLogin,a=e.postId;n();var r={item_type:"login",target_type:"commnet-sign-up",type:"login-clicked",post_id:a};t.trackEvent(r)}},{key:"render",value:function(){var e,t=this.props,n=(t.conversationId,t.currentUser),a=t.spotId,r=t.isUploadImageButtonVisible,o=t.className,s=t.animationRating,i=t.blurOnFocusForGuestUser,c=t.isStarsRatingEnabled,l=t.disableSendButtonWithEmptyText,u=t.forceRegister,d=t.placeholderTextKey,p=t.direction,m=t.messageToEdit,f=t.userImageSize,h=(t.onTyping,t.showButton),v=t.starsRating,y=t.enableRichToolbar,b=t.depth,E=t.isMobileDevice,M=t.useExpandButton,R=t.isEditRichEditor,S=t.placeholderReplyToName,C=t.replyToMessage,w=t.autoFocus,k=t.moderationAlert,O=t.isModerationAlertVisible,I=t.isModerationAlertRendered,x=t.isMessageBlocked,T=t.isUserSuspended,N=t.preventScrollOnAutoFocus,D=t.isDisableRichFormatting,L=t.onLogin;return g.a.createElement("div",{ref:this.setWrapperRef,className:o},this.shouldDisplayUsername()&&g.a.createElement(Fa,{currentUser:n,handleUploadProfileImage:this.handleUploadProfileImage,handleUserProfileClick:this.handleUserProfileClick}),g.a.createElement(Sr,{isExpanded:this.props.isExpanded,isDisableRichFormatting:D,onChange:this.onChange,tabIndexType:"message-details",showButton:h,starsRating:v,spotId:a,useExpandButton:M,login:this.handleLogin.bind(this),onStarsRatingClick:this.handleStarsRatingClick,isLoggedIn:Object(ia.d)(n),isUploadImageButtonVisible:r,enableStarsRating:c&&0===b,isMustRegisterToComment:u,createMessage:this.createMessage,editMessage:this.editMessage,onTyping:this.onTyping,onFocus:this.handleFocus,onBlur:this.handleBlur,closeEditRichEditor:this.handleCloseEditSayControl,uploadProfileImage:this.handleUploadProfileImage,userImageSize:f,placeholderTextKey:d,placeholderReplyToName:S,direction:p,messageToEdit:m,currentUser:n,enableRichToolbar:y,isMobileDevice:E,animationRating:s,disableSendButtonWithEmptyText:l,blurOnFocusForGuestUser:i,isEditRichEditor:R,msnSocialLogin:L,replyToMessage:C,autoFocus:w,onContract:this.handleRichEditorContract,isReply:!0,moderationAlert:k,showErrorBorder:O&&I,isPostAnyway:x&&!T,onRealtimeModeration:this.onRealtimeModeration,isEdit:(null==m||null===(e=m.entities)||void 0===e?void 0:e.length)>0,preventScrollOnAutoFocus:N,draftKey:this.getDraftKey()}))}}]),n}(h.Component);Ir.defaultProps={isStarsRatingEnabled:!1,forceRegister:!1,isExpanded:!1,autoFocus:!1,onTyping:function(){},onFocus:function(){},onBlur:function(){},onLogin:function(){},onStarsRatingClick:function(){},createMessage:function(){},onRendered:function(){},editMessage:function(){},closeEditSayControl:function(){},placeholderTextKey:"richEditor.placeholder.hasMessages",userImageSize:"medium",showButton:!0,focusOnUpdate:!0,moderationAlert:null,isModerationAlertVisible:!1,isModerationAlertRendered:!1,isMessageBlocked:!1,preventScrollOnAutoFocus:!1};var xr=f()(Object(M.connect)((function(e,t){var n,a=e.currentUser,r=e.moduleOptions,o=e.messageSayControls,s=e.userSuspension,i=r.spotId,c=r.enableSSO,l=r.animationRating,u=r.isConnectEnabled,d=r.isStarsRatingEnabled,p=r.forceRegister,m=r.direction,f=r.conversationRichToolbarEnabled,v=r.isMobile,y=r.disableSendButtonWithEmptyText,b=r.blurOnFocusForGuestUser,E=r.liveBlogRichToolbarEnabled,M=r.isConversationLiveBlog,R=r.postId,S=r.conversationId,C=t.messageToEdit,w=t.replyToMessage,k=t.isEditRichEditor,O=t.parentMessageId,I=o[k?C&&C.id:w&&w.id],x=null==I?void 0:I.isExpanded,T=null==I?void 0:I.isRendered,N=o.settings.isModerationAlertRendered,D=s.isUserSuspended,L=Re.a.get("isConversationPageTriggered",!1),j=P.m(e,a.id),U=E&&M&&j,B=M?!pe.i:!pe.h,A=I||{},_=A.isModerationAlertVisible,F=A.verdict,V=A.moderationTags,K=A.isMessageBlocked,q=A.tempMessageId,H=_&&g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(Or,{verdict:F,moderationTags:V,isRealtimeFeedback:!K,sayControlSessionId:q})),W=Re.a.get("tenant_config.conversation.forceSimpleEditor",!1),z=O&&(null===(n=o[O])||void 0===n?void 0:n.isMessageBlocked);return{conversationId:S,currentUser:a,spotId:i,isUploadImageButtonVisible:B,isStarsRatingEnabled:d,forceRegister:p,direction:m,disableSendButtonWithEmptyText:y,blurOnFocusForGuestUser:b,isMobileDevice:Ie.a||v,animationRating:l,showButton:u&&!c,enableRichToolbar:!Ie.a&&!v&&(f||U),enableSSO:c,isRendered:T,moderationAlert:H,isModerationAlertVisible:_,isModerationAlertRendered:N,isMessageBlocked:K,isUserSuspended:D,isExpanded:x,preventScrollOnAutoFocus:L,postId:R,isDisableRichFormatting:W,isAfterClickFeedback:z}}),(function(e,t){var n,a=t.isEditRichEditor,r=t.parentMessageId;return{onTyping:function(){a||e(Ma(r))},onFocus:function(t){var n=t.element,o=t.stackId;a||e(Ma(r)),e(ma({element:n,stackId:o,depth:1}))},onRendered:function(t){e(function(e){var t=e.messageId;return{type:ct.ib,payload:{messageId:t}}}({messageId:t}))},onBlur:function(t){var n=t.stackId;e(ha({stackId:n}))},onLogin:function(){e(Object(At.a)())},onStarsRatingClick:(n=J()(G.a.mark((function t(n,a){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(xa(n,a));case 1:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)}),closeEditSayControl:function(t){var n=t.messageId;e(function(e){var t=e.messageId;return{type:ct.n,payload:{messageId:t}}}({messageId:n}))},createMessage:function(t){return e(Object(Xe.a)(t))},editMessage:function(t){var n,a,r,o,s,i,c,l,u,d;e((a=(n=t).messageId,r=n.displayName,o=n.status,s=n.entities,i=n.oldEntities,c=n.starsRating,l=void 0===c?0:c,u=n.oldStarsRating,d=void 0===u?0:u,function(){var e=J()(G.a.mark((function e(t,n){var c,u,p,m,f,h,g,v,y,b,E,M;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt.a.apm.start("edit_message"),c=n(),u=c.conversation,p=c.moduleOptions,m=p.enableBlindfold,f=p.postId,h=c.currentUser,g=s.filter((function(e){return"text"!==e.type||"text"===e.type&&""!==e.text})),v=u.starsRatingCount,y=u.averageStarsRating,l>0?(y=(y*v-d+l)/v,0===d&&(v+=1)):d>0&&0===l&&(y=(y*(v-=1)-d)/v),t({type:ct.v,payload:{message:{id:a,userDisplayName:r,isEdited:!0,entities:g,starsRating:l,oldStarsRating:d},conversation:{starsRatingCount:v,averageStarsRating:y}}}),e.prev=6,m&&(o===Sa.d||o===Sa.b)){e.next=17;break}return b={starsRating:l},h.isRegistered||(b=Oa(Oa({},b),{},{displayName:r})),e.next=13,Ra.g({messageId:a,entities:g,displayName:Object(Bt.getDisplayName)(h),postId:f,starsRating:l});case 13:E=e.sent,M=Ia(E.body),Object.assign(M.message,{id:a,status:o}),t({type:ct.u,payload:Oa({},M)});case 17:kt.a.apm.end("edit_message"),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(6),t({type:ct.u,payload:{error:e.t0,message:{id:a,isEdited:!1,entities:i,starsRating:d}},error:!0}),kt.a.error("editMessage",e.t0);case 24:case"end":return e.stop()}}),e,null,[[6,20]])})));return function(t,n){return e.apply(this,arguments)}}()))},onProfileImageUpload:function(t){var n=t.rawImage;e(Object(ia.e)({rawImage:n}))},onContract:function(t){var n=t.messageId;e(function(e){var t=e.messageId;return{type:ct.p,payload:{messageId:t}}}({messageId:n}))},onOpenUserProfileModal:function(t){var n=t.user,a=t.overrideDisplayName,r=t.overrideImageId,o=t.mode;e(Object(Ft.a)({user:n,overrideDisplayName:a,overrideImageId:r,mode:o}))},closeModerationAlert:function(){return e(Ta(r))},onRealtimeModeration:function(t){e(La(wr(wr({},t),{},{parentMessageId:r})))}}})),C()({}))(Ir);function Tr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Lr=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(23),n.e(53)]).then(n.bind(null,902))})),jr=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(23),n.e(25),n.e(87)]).then(n.bind(null,892))})),Ur=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(22)]).then(n.bind(null,888))})),Pr=function(e){c()(n,e);var t=Dr(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).messageRef=g.a.createRef(),e.messageDetailsRef=g.a.createRef(),e.messageEntitiesRef=g.a.createRef(),e.deletedMessageRef=g.a.createRef(),e.messageMarkerRef=g.a.createRef(),e.state={collapsed:!1,showFeaturedCommentModal:!1,showMuteUserModal:!1,showDeletedMessageModal:!1,showReportMessageModal:!1},e.handleEdit=function(){e.props.onEdit(e.props.message.id)},e.onDelete=J()(G.a.mark((function t(){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.deleteAction();case 1:case"end":return t.stop()}}),t)}))),e.deleteAction=function(){e.props.onDelete()},e.hasContextMenu=function(e){return!0===e.isAdmin||!0===e.isModerator||!0===e.isJournalist||!0===e.isSuperAdmin||!0===e.isCommunityModerator},e.isMyMessage=function(e,t){return t.user.id===e.id},e.handleMessageReplyGotFocus=function(){},e.openFeaturedCommentModal=function(){e.setState({showFeaturedCommentModal:!0})},e.openMuteUserModal=function(){e.setState({showMuteUserModal:!0})},e.closeMuteUserModal=function(t){e.setState({showMuteUserModal:!1});var n={type:"user-prompt-message-clicked",item_type:"mute-user-prompt-message",target_type:t?"mute":"cancel",post_id:e.props.postId};e.props.tracking.trackEvent(n)},e.muteUserHovered=function(){var t={type:"user-prompt-message-viewed",item_type:"mute-user-prompt-message",target_type:"mute",post_id:e.props.postId};e.props.tracking.trackEvent(t)},e.closeFeaturedCommentModal=function(t){var n=e.props,a=n.pinFeaturedComment,r=n.message;"top-featured"===t&&a(r),e.setState({showFeaturedCommentModal:!1})},e.closeDeletedMessageModal=function(t){t&&e.onDelete(),e.setState({showDeletedMessageModal:!1})},e.handleCloseReportMessageModal=function(){var t=J()(G.a.mark((function t(n){var a,r,o,s,i,c;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.props,r=a.message,o=a.tracking,"ok"!==n){t.next=4;break}return t.next=4,e.onReport();case 4:s=r.featuredComment?"featured-comment":"main",i=function(){if(r.featuredComment)return"top"===e.props.featuredComment?"top-featured-comment":"in-conversation-featured"}(),c={type:"report-message-clicked",target_type:s,segment:i,message_id:r.id,post_id:e.props.postId},o.trackEvent(c),e.setState({showReportMessageModal:!1});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleReport=function(){e.setState({showReportMessageModal:!0})},e.onDeletedMessageModalOpen=function(){e.setState({showDeletedMessageModal:!0})},e.sendFailedMessage=function(){var t=e.props,n=t.failedMessageTemp,a=t.dispatch;n.message&&a(Object(Xe.a)(Nr(Nr({},n.message),{},{isRetry:!0})))},e}return s()(n,[{key:"getDetailsHeight",value:function(){return(this.props.message.isDeleted?this.deletedMessageRef:this.messageDetailsRef).current.offsetHeight}},{key:"getEntitiesOriginalHeight",value:function(){var e,t;return this.props.message.isDeleted?0:null===(e=this.messageEntitiesRef)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.offsetHeight}},{key:"setMessageEntitiesHeight",value:function(e){var t=this.props.message.isDeleted,n=this.messageEntitiesRef.current;!t&&n&&(n.style.height=e)}},{key:"onReport",value:function(){var e=this.props,t=e.onReport,n=e.message;return Object(k.dispatchSpotimEvent)(Dt.a,n),t({message:n},!0)}},{key:"isPendingOrBlocked",value:function(e){return e.status===(Y.statuses.PENDING&&!e.isPublished)||e.status===Y.statuses.BLOCKED}},{key:"isHidden",value:function(e){return this.isPendingOrBlocked(e)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.message,a=e.currentUser,r=e.userImageSize,o=e.messageIndex,s=e.enterAnimationDisabled,i=e.noAnchors,c=e.depth,l=e.enableVotesMessageAction,u=e.onImageUpload,d=e.showFullText,p=e.adminBadgeText,m=e.journalistBadgeText,f=e.communityModeratorBadgeText,v=e.featuredComment,y=e.userToken,b=e.muteUser,M=e.isStaffMember,R=e.isFailedMessage,S=e.disableProfileHover,C=e.spotName,w=e.isLastMessageInThread,k=e.stack,O=e.showReplySayControl,I=e.replyToName,x=e.starsRating,T=this.state.showMuteUserModal,N=pe.u&&n.user.isMuted,D=this.isMyMessage(a,n),L=this.state,j=L.showFeaturedCommentModal,U=L.showDeletedMessageModal,P=L.showReportMessageModal,B=(R||n.status===Y.statuses.BLOCKED||n.status===Y.statuses.PENDING)&&(D||M)&&!n.isDeleted&&!N&&!n.isPublished||n.messageModeratingStage,A=a&&a.id===n.user.id?Nr(Nr({},a),{},{points:n.user.points}):n.user;t=E()(Fn.a.messageView,{[Fn.a.messageWithStatus]:B,[Fn.a.temporary]:n.isTempId},t);var _,F,V=null;if(n.starsRating&&(V=g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(Ur,{starsRating:n.starsRating,disabled:!0,descriptionKey:null,editing:!1,inSayControl:!0}))),!R&&this.props.hasMenu){var K=this.isHidden(n);_=g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(Lr,{onShow:this.props.onContextMenuShow,message:n,onEdit:this.handleEdit,onReport:this.handleReport,isHidden:K,featuredComment:v,openFeaturedCommentModal:this.openFeaturedCommentModal,openMuteUserModal:this.openMuteUserModal,onDeletedMessageModalOpen:this.onDeletedMessageModalOpen}))}var q=!B&&n.status===Y.statuses.BLOCKED||n.isDeleted||N;if(q)F=g.a.createElement(it,{isMuted:N,innerRef:this.deletedMessageRef,adminBadgeText:p,journalistBadgeText:m,message:n,messageIndex:o});else{var H=B;F=g.a.createElement(g.a.Fragment,null,g.a.createElement(Oe.Row,{alignItems:"center",className:Fn.a.messageDataWrapper},g.a.createElement(Dn,{innerRef:this.messageDetailsRef,adminBadgeText:p,journalistBadgeText:m,communityModeratorBadgeText:f,message:n,isDisabled:H,user:A,userImageSize:r,messageIndex:o,onImageUpload:u,profileHoverUser:A,messageContextMenu:_,featuredComment:v,messageStatus:n.status,enableProfileHover:!S})),V,g.a.createElement(Un,{innerRef:this.messageEntitiesRef,message:n,noAnchors:i,shortenText:this.props.shortenText,maxChars:this.props.maxChars,depth:c,isDisabled:H,maxLines:this.props.maxLines,showFullText:d}),g.a.createElement(pn,{depth:c,currentUser:a,isDisabled:H,message:n,spotName:C,enableVotes:l,messageReplyGotFocus:this.handleMessageReplyGotFocus}))}var W=null;0===c&&(W=g.a.createElement("div",{"data-ad-placeholder":"ad-placeholder-".concat(n.id)}));var z=null,G=E()(t,{[Fn.a.isMessageStatus]:!!z});B&&(z=g.a.createElement(h.Suspense,{fallback:null},g.a.createElement("div",{className:E()(Fn.a.messageStatusClickable,G)},g.a.createElement(jr,{message:n,isFailedMessage:R,onRetry:this.sendFailedMessage,isModerated:M,showMessageStatus:B,messageModeratingStage:n.messageModeratingStage}))));var Q=E()({[Fn.a.isDeleted]:q,[Fn.a.collapsed]:this.state.collapsed}),J=q&&!B?Object(Ze.a)():A;return g.a.createElement(nt,{animate:"top"===n.featuredComment},g.a.createElement(Ue,{mobileEnabled:!1,enterAnimationDisabled:s,className:Q,depth:c,user:A},z,W,g.a.createElement("div",{className:Fn.a.messageContentWrapper},g.a.createElement("div",{className:Fn.a.userAvatarWrapper},g.a.createElement(de.b,{user:J,className:Fn.a.messageUserImage,size:c?de.a.SMALL:de.a.NORMAL,disableTooltip:S,onImageUpload:u,isDisabled:q||B})),g.a.createElement("div",{ref:this.messageRef,className:t,"data-message-id":n.id,"data-message-depth":c,"data-spot-im-class":"message-view"},g.a.createElement("div",{className:E()(Fn.a.messageContainer,{[Fn.a.isDeleted]:q})},F),O&&g.a.createElement(xr,{starsRating:x,autoFocus:!0,focusOnUpdate:!1,stackId:k.id,className:E()(Fn.a.replyWrapper),rootMessageId:n.rootMessageId||n.id,replyToStackId:k.id,replyToMessage:n,parentMessageId:n.id,userImageSize:"medium",depth:n.depth+1,isEditRichEditor:!1,placeholderTextKey:"richEditor.placeholder.replyTo",placeholderReplyToName:I}),g.a.createElement(oa,{messageStack:k}),g.a.createElement(ea,{messageStack:k}),g.a.createElement(zn,{depth:c,isLastMessageInThread:w,messageStack:k})))),g.a.createElement(We,{message:n,showFeaturedCommentModal:j,onClose:this.closeFeaturedCommentModal,ConfigProvider:Re.a,userToken:y}),g.a.createElement(An,{muteUserHovered:this.muteUserHovered,showMuteUserModal:T,onClose:this.closeMuteUserModal,muteUser:b,message:n}),g.a.createElement(Ae,{onClose:this.closeDeletedMessageModal,showModal:U,message:n,currentUser:a}),g.a.createElement(Ye,{showModal:P,onClose:this.handleCloseReportMessageModal}))}}]),n}(h.Component);Pr.defaultProps={className:"",hasMenu:!0,maxChars:null,userImageSize:"medium",maxLines:null,enterAnimationDisabled:!1,shortenText:!1,messageIndex:-1,featuredComment:null,isStaffMember:!1,tracking:function(){},dispatch:function(){},onMessageUnmark:function(){},onDelete:function(){},onImageUpload:function(){},onEdit:function(){},onReport:function(){},onContextMenuShow:function(){},pinFeaturedComment:function(){}};var Br=C()({})(Pr),Ar=n(428),_r=n(429),Fr=n(150);function Vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Kr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qr(e){var t={[e.id]:!0},n=window.localStorage.getItem("SPOTIM_REPORTED_COMMENTS");n=Kr(Kr({},n&&JSON.parse(n)),t),window.localStorage.setItem("SPOTIM_REPORTED_COMMENTS",JSON.stringify(n))}var Hr=n(259);function Wr(e){return zr.apply(this,arguments)}function zr(){return(zr=J()(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(t,{opacity:.5},{duration:133,easing:"linear"});case 2:return e.next=4,Ne(t,{opacity:1},{duration:133,easing:"linear",delay:133});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gr(e,t){var n=Object(Hr.b)(t),a=function(e){return'[data-message-id="'.concat(e,'"]')}(e);return n.shadowRoot?n.shadowRoot.querySelector(a):n.querySelector(a)}function Qr(e,t){return Jr.apply(this,arguments)}function Jr(){return(Jr=J()(G.a.mark((function e(t,n){var a,r,o=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.length>2&&void 0!==o[2]&&o[2],r=Gr(t,n)){e.next=4;break}return e.abrupt("return");case 4:a||r.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout((function(){Wr(r)}),3e3);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yr(e){var t=e.id;return{type:ct.xb,payload:{message:{id:t,isMarked:!0}}}}function Xr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n,a){var r=a().moduleOptions.elementId;Qr(e,r,t),n(Yr({id:e}))}}var Zr=n(112);function $r(e){return function(t,n){var a=n().conversation.postId;!function(e){var t=e.userId,n=e.postId;Object(Ot.a)("v1.0.0/user/mute-user",{method:"POST",postId:n,data:{user_id:t}})}({userId:e,postId:a}),t({type:ct.K,payload:{userId:e}})}}var eo=n(792),to=n.n(eo);var no=n(267),ao=n(430),ro=!1;function oo(e){"undefined"!=typeof window?window.addEventListener("load",e):e()}oo((function(){ro=!0}));var so=function(e){e&&"function"==typeof e&&(ro||"complete"===document.readyState?e():oo(e))};function io(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?io(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):io(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function lo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var uo=function(e){c()(n,e);var t=lo(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"componentDidMount",value:function(){var e=this.props.conversationId;this.props.disableMessageSayCtrlFocusOnMount||this.props.message.id!==this.props.highlightedReplyId&&this.props.message.id!==this.props.highlightedCommentId||(this.props.onReply(),this.props.tracking.trackEvent({type:"editor-reply-focus",ugc_post_id:e}))}},{key:"enableShowText",value:function(){var e=this.props,t=e.isLiveBlog,n=e.enableSeeMoreButton,a=e.isRootMessage;return t&&a?!!Object(Ie.d)()||(!Object(Ie.b)()||!n):!n}},{key:"render",value:function(){var e=this.props,t=e.message,n=e.conversationLongerComments,a=e.currentUser,r=e.isConnectEnabled,o=e.isMobileDevice,s=e.isLiveBlog,i=e.repliesMaxDepth,c=e.isTheFirstMessage,l=e.shouldLimitFirstMessageLength,u=e.maxCharsCountDesktop,d=e.maxCharsCountMobile,p=e.maxLinesCount,m=e.shouldLimitMessageLength,f=e.enableNewMessageSticky,h=e.enableRealtimeCommentsSticky,v=e.dispatch,y=e.enableSSO,b=n?750:void 0,M=8;c&&l&&(b=o?d:u,M=p),m&&(b=o?d:u,M=p);var R={maxChars:b,maxLines:M,shortenText:!0,showUserImageButton:r&&!y,showLoadFrameEntityButton:!1,depth:Math.min(t.depth,i),message:t,currentUser:a,showFullText:this.enableShowText(),isTheFirstMessage:c,placeholderTextKey:"richEditor.placeholder.replyTo",enableNewMessageSticky:f,enableRealtimeCommentsSticky:h,dispatch:v},S=E()(to.a.conversationMessage,{[to.a.padded]:s});return g.a.createElement(Br,ke()({className:S},this.props,R))}}]),n}(h.Component),po=f()(Object(M.connect)((function(e,t){var n,a=e.moduleOptions,r=e.currentUser,o=e.profileHover,s=e.comments,i=a.direction,c=a.isConnectEnabled,l=a.allowFrameEntityLoad,u=a.repliesMaxDepth,d=a.conversationLongerComments,p=a.enableSSO,m=a.conversationImageAnchorsDisabled,f=a.spotId,h=a.postId,g=a.conversationId,v=a.enableNewMessageSticky,y=a.enableSeeMoreButton,b=a.textsOverrides,E=b.communityModeratorBadgeText,M=b.moderatorBadgeText,R=b.reporterBadgeText,S=b.adminBadgeText,C=b.journalistBadgeText,w=a.isMobile,k=a.enableHighlightMessageSticky,O=a.shouldLimitFirstMessageLength,I=a.maxCharsCountDesktop,x=a.maxCharsCountMobile,T=a.maxLinesCount,N=a.shouldLimitMessageLength,D=a.highlightedReplyId,L=a.highlightedCommentId,j=a.enableRealtimeCommentsSticky,U=a.enableSegmentedCategory,B=a.disableProfileHover,A=a.spotName,_=t.message,F=_.id===_.rootMessageId,V=P.j(e),K=!V,q=r.isAdmin||r.isCommunityModerator||r.isModerator||r.isSuperAdmin,H=(null==s||null===(n=s.failedMessageTemp)||void 0===n?void 0:n.message.id)===(null==_?void 0:_.id),W=null==s?void 0:s.failedMessageTemp;return{direction:i,isConnectEnabled:c,allowFrameEntityLoad:l,repliesMaxDepth:u,currentUser:r,conversationLongerComments:d,enableSSO:p,spotId:f,postId:h,conversationId:g,noImageAnchors:m,communityModeratorBadgeText:E,moderatorBadgeText:M,reporterBadgeText:R,adminBadgeText:S,journalistBadgeText:C,enableCategoryModeration:U,profileHoverUser:o.user,enableNewMessageSticky:v,isMobileDevice:P.l(e)||w,enableSeeMoreButton:y,enableHighlightMessageSticky:k,isLiveBlog:V,enableReplies:K,shouldLimitFirstMessageLength:O,maxCharsCountDesktop:I,maxCharsCountMobile:x,maxLinesCount:T,shouldLimitMessageLength:N,highlightedReplyId:D,highlightedCommentId:L,isRootMessage:F,userToken:e.authentication.token,href:a.href,referTraffic:a.referTraffic,enableRealtimeCommentsSticky:j,isStaffMember:q,isFailedMessage:H,failedMessageTemp:W,disableProfileHover:B,disableMessageSayCtrlFocusOnMount:a.isSayControlExpanded,spotName:A}}),(function(e,t){var n=t.message;return{onLoadFrameButtonClick(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];k.dispatchSpotimEvent.apply(void 0,["spot-im-frame-entity-load"].concat(t))},onReply:function(){e(lt({messageId:n.id}))},onMessageUnmark(){e(function(e){var t=e.id;return{type:ct.xb,payload:{message:{id:t,isMarked:!1}}}}({id:n.id}))},onDelete(){e(Object(Ar.a)({message:n}))},onEdit(t){var a=n.id,r=n.starsRating;"string"==typeof t&&(a=t),e(Object(_r.a)({messageId:a,starsRating:r}))},onReport(t){return e(function(e){var t=e.message;return function(){var e=J()(G.a.mark((function e(n,a){var r,o,s,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=0===t.depth?"comment":"reply",o="show_report_".concat(r,"_modal"),kt.a.apm.start(o),s=a(),i=s.conversation.postId,n({type:ct.wb,payload:!0}),e.next=8,Ra.l(t.id,i);case 8:qr(t),n({type:ct.cb,payload:{message:t}}),n(Object(Fr.b)({[t.id]:!0})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),n({type:ct.cb,payload:{error:e.t0},error:!0}),kt.a.error("reportMessage",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}()}({message:n}))},onUserWhiteList(t){e(Object(ao.a)(t,n))},loadVotedUsers(t){var n=t.messageDepth,a=t.messageId,r=t.offset,o=void 0===r?0:r,s=t.count;e(en({messageDepth:n,messageId:a,offset:o,count:void 0===s?10:s}))},onOpenUserProfileModal(t){e(Object(Ft.a)(t))},onVotesSummaryTooltipHide(){e({type:ct.fb})},onLogin(){e(Object(At.a)())},highlightMessage(){so((function(){e(Xr(n.id))}))},pinFeaturedComment(t){e(Object(Zr.b)(t))},muteUser(t){e($r(t))},dispatch:e}}),(function(e,t,n){var a=t.dispatch,r=e.currentUser,o=e.enableCategoryModeration;return co(co(co(co({},e),t),n),{},{onContextMenuShow:function(e){var t=r.isAdmin,n=r.isModerator,s=e.user.id===r.id;(t||n)&&e.user.isRegistered&&!s&&a(Object(no.a)(e)),o&&a(Object(ia.c)())},onImageUpload:function(e){a(Object(ia.e)({rawImage:e}))}})})),Object(vt.a)(),Object(S.track)({}))(uo);function mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var fo=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(25),n.e(57)]).then(n.bind(null,905))})),ho=function(e){c()(n,e);var t=mo(n);function n(e){return r()(this,n),t.call(this,e)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.isLegacyEnabled,n=e.repliesMaxDepth,a=e.message,r=e.isConnectEnabled,o=e.enableSSO,s=e.disableSignupWizard,i=r&&!o&&!s,c=t&&Re.a.get("tenant_config.conversation.signup_cta_enabled",!0),l=null;return i&&c&&(l=g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(fo,{depth:Math.min(a.depth,n),isExpanded:!1,username:a.userDisplayName,message:a}))),l}}]),n}(h.Component);ho.displayName="PostMessageAction",ho.propTypes={message:y.a.object.isRequired,isLegacyEnabled:y.a.bool,repliesMaxDepth:y.a.number,spotId:y.a.string,enableSSO:y.a.bool,isConnectEnabled:y.a.bool,disableSignupWizard:y.a.bool.isRequired},ho.defaultProps={isEnabled:!0,repliesMaxDepth:Number.MAX_VALUE};var go=Object(M.connect)((function(e){var t=e.moduleOptions;return{spotId:t.spotId,isConnectEnabled:t.isConnectEnabled,enableSSO:t.enableSSO,disableSignupWizard:t.disableSignupWizard}}))(ho);var vo=n(793),yo=n.n(vo),bo=n(94),Eo=n.n(bo);function Mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ro=Re.a.get("isConversationPageTriggered",!1),So=function(e){c()(n,e);var t=Mo(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).showPostCommentAction=!1,e}return s()(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.stack,n=e.highlightMessage,a=e.shouldHighlightImmediate;e.t;a&&n(t.message.id)}},{key:"render",value:function(){var e,t=this.props,n=t.stack,a=t.className,r=t.starsRating,o=t.enterAnimationDisabled,s=t.messageIndex,i=t.repliesMaxDepth,c=t.isEdit,l=t.showReplySayControl,u=t.isTheFirstMessage,d=t.isLastMessageInThread,p=t.isPostCommentActionEnabled;if(l&&(e=Eo()(n,"message.userDisplayName")||Eo()(n,"message.user.displayName")||Eo()(n,"message.user.username")),n.isAggregated)return null;var m=E()(yo.a.messageStack,a),f=n.message;if(f.isCollapsed)return null;var h=Math.min(f.depth,i),v=f.isDeleted||pe.u&&f.user.isMuted||f.status===Y.statuses.BLOCKED;return g.a.createElement("div",{className:E()(yo.a.messageStackWrapper,yo.a["depth-".concat(h)],{[yo.a.isDeleted]:v})},g.a.createElement("div",{className:m},!c&&g.a.createElement(po,{message:f,enterAnimationDisabled:o,messageIndex:s,isTheFirstMessage:u,isLastMessageInThread:d,stack:n,showReplySayControl:l,starsRating:r,replyToName:e}),c&&g.a.createElement(xr,{autoFocus:!0,stackId:n.id,className:E()(yo.a.replyWrapper),rootMessageId:f.rootMessageId||f.id,messageToEdit:f,parentMessageId:f.parentMessageId,userImageSize:"medium",isCollapsed:!0,depth:f.depth,starsRating:r,isEditRichEditor:!0}),g.a.createElement(go,{message:f,repliesMaxDepth:i,isLegacyEnabled:p&&f.isMine})))}}]),n}(h.Component);So.defaultProps={isEdit:!1,starsRating:-1,messageIndex:-1,shouldHighlightImmediate:!1,isMobileDevice:!1,showReplySayControl:!0,highlightMessage:function(){},isTheFirstMessage:!1,onDoneLoadingReplies:function(){},shouldCollapseReplies:!1};var Co=f()(Object(M.connect)((function(e,t){var n=e.moduleOptions,a=e.messageSayControls,r=e.comments,o=e.conversation,s=o.isSubmittingReply,i=o.submittedReplyParentMessageId,c=o.isSubmittingEdit,l=o.editedMessageId,u=e.isReadOnly,d=t.stack,p=n.direction,m=n.repliesMaxDepth,f=n.highlightedCommentId,h=n.highlightedReplyId,g=n.highlightImmediate,v=n.isMobile,y=n.shouldCollapseReplies,b=d.message.id,E=r.isPostCommentActionEnabled,M=(b===f||b===h)&&g,R=a[b],S=P.l(e)||v,C=P.o(e,d.id),w=P.j(e),k=0===d.message.depth,O=!!(null==R?void 0:R.isEdit)||c&&l===b;return{showReplySayControl:!(u||!(s&&i===b||R&&R.isCreate&&(!w||!k))),starsRating:R&&R.starsRating,isEdit:O,direction:p,repliesMaxDepth:m,isPostCommentActionEnabled:E,messageSayControl:R,enterAnimationDisabled:C,isMobileDevice:S,shouldHighlightImmediate:M,shouldCollapseReplies:y}}),(function(e){return{expandChildren:function(t){e(function(e){return{type:ct.w,payload:e}}(t))},highlightMessage(t){so((function(){e(Xr(t,Ro))}))}}})),Object(vt.a)())(So),wo=n(794),ko=n.n(wo);function Oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Io=function(e){c()(n,e);var t=Oo(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"createDateAriaLableText",value:function(e,t){var n=new Date(1e3*t),a=["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()],r=n.getDate();return"".concat(e," commented ").concat(a," ").concat(r)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.root,a=e.children,r=e.messageIndex,o=e.isTheFirstMessage,s=e.isLastMessage,i=e.lastMessageId,c=e.shouldCollapseReplies,l=e.isEdit,u=e.isLiveBlog,d=n.message.user,p=E()(ko.a.rootMessage,t,{[ko.a.isLastMessage]:s,[ko.a.isEdit]:l,[ko.a.isLiveBlog]:u}),m=E()(p,{[ko.a.isLiveBlogNoUserImage]:pe.n&&u,[ko.a.isLastMessageNoUserImage]:pe.n&&this.props.isLastMessage}),f=E()(ko.a.childrenList,{[ko.a.empty]:0===a.length}),h=(Ee.d(n),this.createDateAriaLableText(d.username,n.message.postedAt));return g.a.createElement("article",{className:m},g.a.createElement(Co,{isTheFirstMessage:o,stack:n,messageIndex:r,"aria-labelledby":"comment-description-".concat(r),"aria-describedby":"comment-content-".concat(r),isLastMessageInThread:n.message.id===this.props.lastMessageId}),g.a.createElement("a",{className:ko.a.accessibilityLabel,id:"comment-description-".concat(r),"aria-label":h}),g.a.createElement("ul",{className:f},a.map((function(e){return e.message.isNew&&c&&(e.isLastMessage=!1),g.a.createElement("li",{key:"message-stack-".concat(e.id),"aria-label":"Comment reply",role:"article"},g.a.createElement(Co,{stack:e,messageIndex:r,isLastMessageInThread:e.message.id===i}))}))))}}]),n}(h.Component);Io.defaultProps={children:[],useExpandButton:!1,repliesMaxDepth:2,shouldCollapseReplies:!1};var xo=Object(M.connect)((function(e,t){var n=e.messageSayControls,a=e.moduleOptions,r=e.comments,o=e.conversation,s=o.isSubmittingEdit,i=o.editedMessageId,c=t.root,l=a.repliesMaxDepth,u=a.pageSize,d=a.spotId,p=a.testOption,m=a.shouldCollapseReplies,f=c.message.id,h=n[f],g=!!(null==h?void 0:h.isEdit)||s&&i===f,v=!(h&&h.isCreate),y=P.j(e),b=O.f(r.list,c);return{spotId:d,useExpandButton:v,repliesMaxDepth:l,pageSize:u,testOption:p,shouldCollapseReplies:m,lastMessageId:b?b.message.id:f,stackList:r.list,isEdit:g,isLiveBlog:y,comments:r}}))(Io),To=n(407);function No(e,t){return new Promise(function(){var n=J()(G.a.mark((function n(a){var r,o;return G.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Ot.a)("v1.0.0/conversation/featured-message/".concat(e),{postId:Object(ya.a)(e),method:"POST",data:{sortBy:t}});case 2:if((r=n.sent)&&r.messages){n.next=6;break}return a(null),n.abrupt("return");case 6:o=r.messages[0].user_id,r.messages[0].users[o]=r.users[o],r.messages[0].featuredComment="top",a(r.messages[0]);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}var Do,Lo=n(445),jo=n(178);!function(e){e.CONSTANT="CONSTANT",e.NONE="NONE"}(Do||(Do={}));var Uo=Re.a.get("tenant_config.conversation.ads_enabled",!1),Po=Re.a.get("tenant_config.conversation.adsPositionRate",7),Bo=Re.a.get("tenant_config.conversation.ads_start_position",7),Ao=n(102),_o=n(797),Fo=n.n(_o);function Vo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ko=function(e){c()(a,e);var t,n=Vo(a);function a(){var e;r()(this,a);for(var t=arguments.length,o=new Array(t),s=0;s<t;s++)o[s]=arguments[s];return(e=n.call.apply(n,[this].concat(o))).state={shouldFetchFeaturedComment:!1,hasFeaturedComment:!1,adsHidden:e.props.isLiveBlog||!1},e.onHideAd=function(){e.setState({adsHidden:!0})},e}return s()(a,[{key:"componentDidMount",value:function(){kt.a.apm.end("critical_flow"),this.prepareFeaturedComment()}},{key:"prepareFeaturedComment",value:(t=J()(G.a.mark((function e(){var t,n,a,r,o,s,i,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,n=t.conversationID,a=t.addMessage,r=t.updateMessageToBeFeatured,o=t.messages,s=t.updateShouldFetchFeaturedComment,i=t.sortBy,s(),e.next=4,No(n,i);case 4:(c=e.sent)&&(o[c.id]?r(c):a(c),this.setState({hasFeaturedComment:!0}));case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentDidUpdate",value:function(){this.props.shouldFetchFeaturedComment&&this.prepareFeaturedComment()}},{key:"generateV2AdsSeparator",value:function(e){return e?g.a.createElement("div",{className:Fo.a.separator}):g.a.createElement("div",{className:Fo.a.adsSeparator},g.a.createElement(w.Typography,{className:Fo.a.adsSeparatorText,type:"infoMd"},g.a.createElement($.a,{i18nKey:"ads.separator"},"The conversation continues below the ad")))}},{key:"render",value:function(){var e,t=this,n=this.props,a=n.className,r=n.stackList,o=n.commentsCount,s=n.showTopActivityBar,i=n.onShowMore,c=n.hasNextComments,l=n.isLiveBlog,u=n.messageSayControls,d=n.isSubmittingEdit,p=n.editedMessageId,m=(n.currentUser,this.state.adsHidden),f=[];if(s&&(e=g.a.createElement(be,{key:"1"})),O.a(r)>0){var h=-1;o>-1&&(h=o);var v=O.e(r),y=O.g(r);if(s){if(v){var b=v,M=b.length,R=b.filter((function(e){return 0===e.message.depth})).length;e=g.a.createElement(be,{key:"2",messagesCount:M}),h-=R}}else{var S=v,C=S.length,w=S.filter((function(e){return 0===e.message.depth})).length;f.push(g.a.createElement(ne,{key:S[0].id,messagesCount:C,onClick:i})),h-=w}if(y){var k=function(e){var t=e.stackLength;if((Uo?Do.CONSTANT:Do.NONE)===Do.NONE)return[];var n=Object(jo.b)(),a=n<=Bo?n:Bo<=Po?Bo:Po,r=Math.floor((t-a)/Po),o=r>0?r:0,s=Qt()(Array(o)).map((function(e,t){return a+(t+1)*(Po+1)}));return[a].concat(Qt()(s))}({stackLength:y.length}),I=y.filter((function(e){var n=t.props.comments,a=Object(Kn.b)(n,e);return e.message.status!==Y.statuses.REPORTED&&!e.isAggregated&&!e.message.isCollapsed&&(!e.message.user.isMuted||a>0)})).filter((function(e){return!Object(Ao.a)(e.message)}));I.forEach((function(e,n){var a;n>0&&(a=y[n-1]);var o=E()({[Fo.a.topMessage]:0===n}),s=n===I.length-1,i=e.message.id,v=u[i],b=!!(null==v?void 0:v.isEdit)||d&&p===i,M=g.a.createElement(xo,{root:e,children:O.h(r,e),messageIndex:h,className:o,previousRoot:a,isTheFirstMessage:0===n,isLastMessage:s}),R=!m&&(null==k?void 0:k.some((function(e,t){return e-t-1===f.length}))),S=!m&&!c&&f.length<=k[k.length-1]&&s,C=S||R&&Lo.b,w=E()(Fo.a.listItem,{[Fo.a.isLastMessage]:s&&!R,[Fo.a.isEdit]:b,[Fo.a.isLiveBlog]:l,[Fo.a.hideSeparator]:C||l});f.push(g.a.createElement("li",{key:"message-stack-".concat(e.id),className:w,"aria-label":"Comment"},g.a.createElement("div",{className:Fo.a.safariPadder}),M,C&&t.generateV2AdsSeparator(S)))})),m||l||k.forEach((function(e){f.splice(e,0,g.a.createElement(Lo.a,{key:e,index:e,onHideAd:t.onHideAd}))}))}}return g.a.createElement("ul",{className:E()([Fo.a.messagesList,a,{[Fo.a.theEarliestMessages]:!c,[Fo.a.isLiveBlog]:l}]),"data-spot-im-class":"messages-list",role:"feed","aria-label":"List of Comments"},e,f)}}]),a}(h.Component);Ko.defaultProps={commentsCount:-1,showTopActivityBar:!0,onShowMore:function(){}};var qo=f()(Object(M.connect)((function(e){return{postId:e.conversation.postId,conversationID:e.conversation.id,messages:e.comments.list.messages,shouldFetchFeaturedComment:e.conversation.shouldFetchFeaturedComment,sortBy:e.comments.pagination.sortBy,isMobile:e.isMobile.isMobile,isLiveBlog:P.j(e),messageSayControls:e.messageSayControls,isSubmittingEdit:e.conversation.isSubmittingEdit,editedMessageId:e.conversation.editedMessageId,comments:e.comments}}),(function(e){return{onShowMore:ae.b,addMessage:function(t){return e(Object(To.a)(t))},updateMessageToBeFeatured:function(t){return e((n=t,function(e){e({type:ct.Bb,payload:n})}));var n},updateShouldFetchFeaturedComment:function(){return e(Object(Zr.d)(!1))}}}),null,{forwardRef:!0}),C()({},{forwardRef:!0}))(Ko),Ho=n(266),Wo=n(431),zo=n.n(Wo);function Go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Qo=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(18),n.e(26)]).then(n.bind(null,907))})),Jo=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(89)]).then(n.bind(null,895))})),Yo=Re.a.get("isConversationPageTriggered",!1),Xo=Re.a.get("tenant_config.conversation.forceSimpleEditor",!1),Zo=function(e){c()(n,e);var t=Go(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).mainSayControl=g.a.createRef(),e.wrapperRef=void 0,e.getContentsMethod=function(){},e.setContentsMethod=function(e){},e.setFocusMethod=function(){},e.hanldeSetFocus=function(t){var n=e.props,a=n.postId,r=n.instanceId;if(t.data&&"object"==typeof t.data&&t.data.__SPOTIM_MESSAGE&&"set-main-say-control-focus"===t.data.type){var o=t.data.instanceId===r,s=t.data.postId===a;(!t.data.postId||!!t.data.instanceId&&o||s)&&e.setFocus()}},e.setFocus=function(){var t,n;null===(t=e.mainSayControl)||void 0===t||null===(n=t.current)||void 0===n||n.setFocus()},e.handleUploadProfileImage=function(t){var n=e.props.currentUser;e.props.onProfileImageUpload({userId:n.id,rawImage:t})},e.createMessage=function(t){var n=t.entities,a=t.displayName,r=t.starsRating,o={entities:n,starsRating:void 0===r?0:r};return a&&(o.displayName=a),Object(sa.clearDraftMessage)(e.getDraftKey()),e.props.createMessage(o)},e.handleLogin=function(){var t=e.props,n=t.tracking,a=t.postId;(0,t.onLogin)();var r={item_type:"login",target_type:"commnet-sign-up",type:"login-clicked",post_id:a};n.trackEvent(r)},e.requestGetContents=function(t){e.getContentsMethod=t},e.requestSetContents=function(t){e.setContentsMethod=t},e.requestSetFocus=function(t){e.setFocusMethod=t},e.onTyping=function(t){var n=e.props,a=n.isMessageBlocked,r=n.isModerationAlertVisible,o=n.closeModerationAlert,s=n.isUserSuspended,i=n.currentUser;a&&!s&&r&&ca.g(t)&&(o(),e.props.tracking.trackEvent({item_type:"realtime-moderation",user_id:i.id,is_registered:i.isRegistered,type:"post-edited",target_type:"after-post"})),e.props.onTyping()},e.onRealtimeModeration=function(t){var n=e.props,a=n.isMessageBlocked,r=n.onRealtimeModeration;a||r(t)},e.setWrapperRef=function(t){e.wrapperRef=t},e.handleClickOutside=function(t){var n=e.props,a=n.isModerationAlertVisible,r=n.isExpanded,o=null==t?void 0:t.composedPath();try{var s,i,c=o.some((function(e){var t;return null===(t=e.dataset)||void 0===t?void 0:t.spotimOverlay})),l=o.some((function(e){var t;return null===(t=e.className)||void 0===t?void 0:t.toString().endsWith("stars-rating")}));(null===(s=e.wrapperRef)||void 0===s?void 0:s.contains(o[1]))||(null===(i=e.state)||void 0===i?void 0:i.hasText)||c||a||r&&l||e.props.onUnfocus()}catch(e){}},e.onChange=function(t){var n=t.isEmpty;e.setState({hasText:!n})},e.handleBlur=function(){e.props.onBlur()},e.handleFocus=function(t){var n=e.props.conversationId;e.props.onFocus(t),e.props.tracking.trackEvent({type:"editor-comment-focus",ugc_post_id:n})},e.getDraftKey=function(){var t=e.props.conversationId;return"conversation_".concat(t,"_main-say-ctrl")},e}return s()(n,[{key:"componentDidMount",value:function(){var e=this.props.autoFocus;Ho.a.on("focusSayControl",this.setFocus),this.subscribeToSetFocusMessage(),e&&!Object(Ie.b)()&&this.setFocus(),document.addEventListener("click",this.handleClickOutside)}},{key:"subscribeToSetFocusMessage",value:function(){window.addEventListener("message",this.hanldeSetFocus)}},{key:"componentWillUnmount",value:function(){Ho.a.off("focusSayControl",this.setFocus),window.removeEventListener("message",this.hanldeSetFocus),document.removeEventListener("click",this.handleClickOutside)}},{key:"render",value:function(){var e=this.props,t=e.currentUser,n=e.isStarsRatingEnabled,a=e.forceRegister,r=e.moderationAlert,o=e.isModerationAlertVisible,s=e.isModerationAlertRendered,i=e.isMessageBlocked,c=e.isUserSuspended,l=e.shouldAutoFocus,u=e.preventScrollOnAutoFocus,d=e.isDisableRichFormatting,p=e.isStarsRatingFailed,m=e.starsRatingAlert,f=e.isUploadImageButtonVisible;return g.a.createElement("div",{ref:this.setWrapperRef},g.a.createElement(Sr,ke()({},this.props,{isUploadImageButtonVisible:f,ref:this.mainSayControl,onChange:this.onChange,onBlur:this.handleBlur.bind(this),onFocus:this.handleFocus,isDisableRichFormatting:d,tabIndexType:"editor",login:this.handleLogin,isLoggedIn:Object(ia.d)(t),createMessage:this.createMessage,uploadProfileImage:this.handleUploadProfileImage,isRichBarVisibleOnMount:!0,enableStarsRating:n,isMustRegisterToComment:a,openUserProfileModal:Ft.a,requestGetContents:this.requestGetContents,requestSetContents:this.requestSetContents,requestSetFocus:this.requestSetFocus,socialReviewsStyles:zo.a,isRootMessage:!0,moderationAlert:r,starsRatingAlert:m,onTyping:this.onTyping,onRealtimeModeration:this.onRealtimeModeration,showErrorBorder:o&&s||p,isPostAnyway:i&&!c,isEdit:!1,autoFocus:l,preventScrollOnAutoFocus:u,draftKey:this.getDraftKey()})))}}]),n}(h.Component);Zo.defaultProps={isUploadImageButtonVisible:!1,isStarsRatingEnabled:!1,forceRegister:!1,isExpanded:!1,autoFocus:!1,onTyping:function(){},onFocus:function(){},onBlur:function(){},onLogin:function(){},onStarsRatingClick:function(){},createMessage:function(){},closeModerationAlert:function(){},onRealtimeModeration:function(){},placeholderTextKey:"richEditor.placeholder.hasMessages",userImageSize:"medium",moderationAlert:null,isModerationAlertVisible:!1,isModerationAlertRendered:!1,isMessageBlocked:!1,isUserSuspended:!1,shouldAutoFocus:!1,preventScrollOnAutoFocus:!1,isStarsRatingFailed:!1,starsRatingAlert:null};var $o=f()(Object(M.connect)((function(e){var t=e.currentUser,n=e.moduleOptions,a=e.mainSayControl,r=e.conversation,o=e.userSuspension,s=e.communityView,i=n.enableSSO,c=n.editableSSO,l=n.isConnectEnabled,u=n.isStarsRatingEnabled,d=n.forceRegister,p=n.direction,m=n.conversationRichToolbarEnabled,f=n.isMobile,v=n.disableSendButtonWithEmptyText,y=n.animationRating,b=n.blurOnFocusForGuestUser,E=n.transliterationLanguage,M=n.liveBlogRichToolbarEnabled,R=n.isConversationLiveBlog,S=n.postId,C=n.conversationId,w=(n.highlightedCommentId,n.instanceId),k=n.focusMainSayCtrlOnMount,O=a.starsRating,I=a.isStarsRatingFailed,x=a.expanded,T=a.isMessageBlocked,N=a.isModerationAlertVisible,D=a.isModerationAlertRendered,L=a.moderationTags,j=a.verdict,U=a.tempMessageId,B=s.focusSayControlOnSwitchTab,A=o.isUserSuspended,_=r.hasCommented,F=P.m(e,t.id),V=M&&R&&F,K=R?!pe.i:!pe.h,q=N&&g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(Qo,{moderationTags:L,verdict:j,isRealtimeFeedback:!T,sayControlSessionId:U})),H=I&&g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(Jo,null,g.a.createElement($.a,{i18nKey:"general.failedConversation.title"},"Oops, something went wrong :("))),W=k||B;return{conversationId:C,currentUser:t,isUploadImageButtonVisible:K,starsRating:O,isStarsRatingEnabled:u,forceRegister:d,direction:p,isExpanded:x,disableSendButtonWithEmptyText:v,isMobileDevice:Object(Ie.b)()||f,blurOnFocusForGuestUser:b,showButton:l&&(!i||!!c),animationRating:y,enableRichToolbar:!Object(Ie.b)()&&!f&&(m||V),transliterationLanguage:E,enableSSO:i,editableSSO:c,hasCommented:_,moderationAlert:q,isModerationAlertVisible:N,isModerationAlertRendered:D,isMessageBlocked:T,isUserSuspended:A,shouldAutoFocus:W,preventScrollOnAutoFocus:Yo,postId:S,instanceId:w,isDisableRichFormatting:Xo,isStarsRatingFailed:I,starsRatingAlert:H}}),(function(e){return{onTyping:function(){return e(Ma())},onFocus:function(t){var n=t.element;e(Ma()),e(ma({element:n,depth:0}))},onBlur:function(){e(ha())},onLogin:function(){e(Object(At.a)({mode:"signup"}))},onStarsRatingClick:(t=J()(G.a.mark((function t(n){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(xa(n));case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)}),createMessage:function(t){var n=t.entities,a=t.displayName,r=t.starsRating;return e(Object(Xe.a)({entities:n,displayName:a,starsRating:r}))},onProfileImageUpload:function(t){var n=t.rawImage;e(Object(ia.e)({rawImage:n}))},closeModerationAlert:function(){e(Ta())},onRealtimeModeration:function(t){e(La(t))},onUnfocus:function(){e({type:ct.yb})}};var t})),C()({}))(Zo),es=n(200),ts=n(93),ns=n(448),as=n(358);function rs(e,t,n,a){return os.apply(this,arguments)}function os(){return(os=J()(G.a.mark((function e(t,n,a,r){var o,s,i,c,l,u,d,p,m,f,h,g,v,y,b,E,M,R,S,C;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.href,s=r.canonicalHref,i=r.offset,c=void 0===i?0:i,l=r.commentsRead,u=void 0===l?0:l,d=r.pageSize,p=void 0===d?ba.d:d,m=r.sortBy,f=void 0===m?ts.a.BEST:m,h=r.highlight,g=r.depth,o=decodeURIComponent(o),o=Object(as.a)(o),s=decodeURIComponent(s),s=Object(as.a)(s),e.next=7,es.b(t,n,a,o,s,c,u,p,f,g);case 7:return v=e.sent,y=Object(ns.a)(v.conversation),b=y.conversation,E=y.followersIds,M=y.pagination,R=y.comments,S=y.followers,C=Object(Ze.b)(v.user),e.abrupt("return",{currentUser:C,conversation:b,followersIds:E,pagination:M,comments:R,followers:S,highlight:h});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ss=n(269);function is(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function cs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?is(Object(n),!0).forEach((function(t){Ce()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):is(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ls(e){var t=e.spotId,n=e.postId,a=e.conversationId,r=e.href,o=e.canonicalHref,s=e.offset,i=e.commentsRead,c=e.pageSize,l=e.sortBy,u=e.highlight,d=e.depth,p=e.isFromShowMore;return function(){var e=J()(G.a.mark((function e(m,f){var h,g,v;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kt.a.apm.start("fetch_conversation"),h=f(),g=h.conversation,Object(ss.b)(l),m({type:ct.y,payload:{isFromShowMore:p}}),e.next=6,rs(t,n,a,{href:r,canonicalHref:o,offset:s,commentsRead:i,pageSize:c,sortBy:l,highlight:u,depth:d}).catch((function(e){m({type:ct.x,payload:{error:e},error:!0}),kt.a.error("fetchConversation",e)}));case 6:v=e.sent,kt.a.apm.end("fetch_conversation"),m({type:ct.x,payload:cs({currentConversation:g},v)}),m(Object(Zr.d)(!0));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}var us=n(798),ds=n.n(us);function ps(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ms={[ts.a.BEST]:"inpage.conversation.sortMenu.best",[ts.a.NEWEST]:"inpage.conversation.sortMenu.newest",[ts.a.OLDEST]:"inpage.conversation.sortMenu.oldest",[ts.a.SOCIAL]:"inpage.conversation.sortMenu.social"},fs=function(e){c()(n,e);var t=ps(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).onSortChanged=function(t){if(e.props.sortBy!==t){var n=e.props,a=n.tracking,r=n.pageSize,o=n.conversation,s=n.href,i=n.canonicalHref,c=o.spotId,l=o.postId,u=o.id;kt.a.send("sort_by_clicked");var d={type:"sorting-menu-clicked",target_type:t,item_type:"sort-menu",post_id:l};a.trackEvent(d),e.props.onSortChange({spotId:c,postId:l,conversationId:u,href:s,canonicalHref:i,pageSize:r,sortBy:t}),Object(k.dispatchSpotimEvent)(Dt.u,{sortedBy:t})}},e.handleSortByClick=function(t,n){13===t.keyCode&&e.onSortChanged(n)},e.toggleMenu=function(e){e&&Object(k.dispatchSpotimEvent)(Dt.t)},e.isChecked=function(t){return e.props.sortBy===t?"checked":""},e.handleSortMenuTitleGotFocus=function(){var e=document.querySelector('[class*="faces-list"]');if(e){var t=e.querySelectorAll('[class*="user-image"]');t[t.length-1].focus()}},e.getSortItem=function(t){var n=t.action,a=t.handler,r=t.label,o=t.sortKey,s=e.isChecked(o);return g.a.createElement(w.MenuItem,{"data-spmark":r,"data-testid":r,key:o,onClick:function(){return n(o,e.refs)},onKeyUp:a,className:E()(ds.a.menuItem,{[ds.a.selected]:s}),id:"spotim-sort-by-list"},g.a.createElement($.a,{i18nKey:"".concat(ms[o])}),s&&g.a.createElement("span",{className:ds.a.iconWrapper},g.a.createElement(w.Icon,{name:"check",type:"fa-solid",className:ds.a.checkedIcon})))},e}return s()(n,[{key:"getSortItems",value:function(){var e=this,t=[this.getSortItem({action:this.onSortChanged,handler:function(t){return e.handleSortByClick(t,ts.a.BEST)},label:ts.a.BEST,sortKey:ts.a.BEST}),this.getSortItem({action:this.onSortChanged,handler:function(t){return e.handleSortByClick(t,ts.a.NEWEST)},label:ts.a.NEWEST,sortKey:ts.a.NEWEST}),this.getSortItem({action:this.onSortChanged,handler:function(t){return e.handleSortByClick(t,ts.a.OLDEST)},label:ts.a.OLDEST,sortKey:ts.a.OLDEST})];return Re.a.get("tenant_config.conversation.social_enable",!1)&&t.push(this.getSortItem({action:this.onSortChanged,handler:function(t){return e.handleSortByClick(t,ts.a.SOCIAL)},label:ts.a.SOCIAL,sortKey:ts.a.SOCIAL})),t}},{key:"render",value:function(){var e=this.props,t=e.isLiveBlog,n=e.sortBy,a=e.isLoading,r=e.direction,o=e.expanded;if(t)return null;var s=this.getSortItems(),i=Re.a.get("init_data.config.ltr")?"bottom-start":"bottom-end",c=E()(ds.a.sortContainer,{[ds.a.isExpended]:o});return g.a.createElement("div",{className:c},g.a.createElement(w.Typography,{type:"infoMd",className:ds.a.sortText,onFocus:this.handleSortMenuTitleGotFocus},g.a.createElement($.a,{i18nKey:"inpage.conversation.sortMenu.sortBy"}),"Â "),g.a.createElement(w.Menu,{isLtr:"ltr"===r,isMobile:Ie.a,placement:i,trigger:"click",onShowChange:this.toggleMenu,mobileCancelButtonContent:g.a.createElement($.a,{i18nKey:"Cancel"},"Cancel"),menuButton:g.a.createElement(w.Button,{className:E()(ds.a.sortBy),id:"spotim-sort-by"},g.a.createElement(pt.a,{weight:"bold",disableHover:!0,className:ds.a.sortByText},g.a.createElement($.a,{i18nKey:"".concat(ms[n])})),a?g.a.createElement("div",{className:ds.a.spinnerWrapper},g.a.createElement(j.a,null)):g.a.createElement(I.a,{selector:"chevronDownIcon",className:ds.a.chevronIcon}))},s))}}]),n}(h.Component);fs.defaultProps={sortBy:ts.a.BEST,pageSize:ba.d,isLiveBlog:!1};var hs=f()(Object(M.connect)((function(e){var t=e.moduleOptions,n=e.mainSayControl,a=t.href,r=t.canonicalHref,o=t.spotId,s=t.direction,i=P.j(e),c=n.expanded;return{href:a,canonicalHref:r,isLiveBlog:i,spotId:o,isLoading:e.comments.loading,direction:s,expanded:c}}),{onSortChange:ls}),C()({}))(fs),gs=n(799),vs=n.n(gs),ys=n(412),bs=n(161),Es=n(170);function Ms(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Rs=function(e){c()(n,e);var t=Ms(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={showMenu:!1},e.handleTooltipClick=function(t){13===t.keyCode&&e.onTooltipToggle()},e.onTooltipToggle=function(){var t=e.props,n=t.tracking,a=t.currentUser,r=t.postId;Object(k.dispatchSpotimEvent)(Dt.p,a);var o={type:"profile-main-clicked",post_id:r};!e.state.showMenu&&n.trackEvent(o),e.setState({showMenu:!e.state.showMenu})},e.hide=function(){e.setState({showMenu:!1})},e.handleCloseTooltip=function(){e.setState({showMenu:!1})},e.onProfileClick=function(){var t=e.props,n=t.tracking,a=t.currentUser,r=t.onOpenUserProfileModal,o=t.postId,s=t.userId;r(a);var i={type:"my-profile-clicked",post_id:o},c={type:"user-profile-clicked",target_type:"my-profile-dropdown",item_type:"user_profile",target_id:s,post_id:o};n.trackEvent(i),n.trackEvent(c),e.hide()},e.onSettingsClick=function(){var t=e.props,n=t.tracking,a=t.onOpenUserSettingsModal,r=t.currentUser,o=t.postId;a(r);var s={type:"edit-settings-clicked",post_id:o};n.trackEvent(s),Object(k.dispatchSpotimEvent)(Dt.g,r),e.hide()},e.onLogoutClick=function(){e.props.onLogout(),e.hide()},e.onPrivacyClick=function(){var t=e.props.currentUser;e.props.onOpenPrivacyModal(t),Object(k.dispatchSpotimEvent)(Dt.f,t)},e.setModerationToDefault=function(){e.props.setModerationDefaultPolicy("spot_policy"),e.hide()},e.setModerationToStrict=function(){e.props.setModerationDefaultPolicy("require_approval"),e.hide()},e.onCommunityQuestionClick=function(){(0,e.props.onCommunityQuestionModalStateChange)(),e.hide()},e.getDropListItems=function(e){var t=e.profileItem,n=e.settingsItem,a=e.showPrivacy,r=e.onPrivacyClick,o=[];return e.disableUserProfileModal||(o=[t,n]),a&&o.push(g.a.createElement(w.MenuItem,{key:"privacy","data-spot-im-class":"privacy-item",onClick:r},g.a.createElement(N.a,{textKey:"general.privacy.short"},"Privacy"))),o},e.setIsReadOnly=J()(G.a.mark((function t(){var n,a,r,o;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,a=n.isReadOnly,r=n.setIsReadOnly,o=n.t,t.prev=1,t.next=4,r(!a);case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),e.context.addToast({onAction:function(){e.setIsReadOnly()},toastText:"".concat(o("readOnly.errorMessage","Couldn't save changes"),", "),mode:"error",closeButton:!0,actionText:o("general.tryAgain","try again")});case 9:case"end":return t.stop()}}),t,null,[[1,6]])}))),e.getMenuItems=function(){var t=e.props,n=t.showLogout,a=t.conversationAuthorId,r=t.userId,o=t.isModerator,s=t.isAdmin,i=t.isSuperAdmin,c=t.isJournalist,l=t.enableCommunityQuestion,u=t.defaultPolicy,d=t.showPrivacy,p=t.isReadOnly,m=t.disableUserProfileModal,f=g.a.createElement(N.a,{textKey:"userProfile.contextMenu.profile"}),h=!pe.o&&g.a.createElement(w.MenuItem,{key:"profile","data-spot-im-class":"profile-item",onClick:e.onProfileClick},f),v=!pe.m&&g.a.createElement(w.MenuItem,{key:"settings","data-spot-im-class":"settings-item",onClick:e.onSettingsClick},g.a.createElement(N.a,{textKey:"userProfile.contextMenu.settings"})),y=e.getDropListItems({profileItem:h,settingsItem:v,showPrivacy:d,onPrivacyClick:e.onPrivacyClick,disableUserProfileModal:m});return l&&(a===r||s||i||c)&&y.unshift(g.a.createElement(w.MenuItem,{key:"communityQuestion","data-spot-im-class":"community-question-item",onClick:e.onCommunityQuestionClick},g.a.createElement(N.a,{textKey:"user.setCommunityQuestion"}))),n&&y.push(g.a.createElement(w.MenuItem,{key:"logout","data-spot-im-class":"logout-item",onClick:e.onLogoutClick},g.a.createElement(N.a,{textKey:"user.logout"}))),(o||s||i||c)&&(u?y.push(g.a.createElement(w.MenuItem,{key:"setModerationTo","data-spot-im-class":"set-moderation-item",onClick:"spot_policy"==u?e.setModerationToStrict:e.setModerationToDefault},g.a.createElement(N.a,{textKey:"spot_policy"==u?"user.setModerationStrict":"user.setModerationDefault"}))):y.push(g.a.createElement(w.MenuItem,{key:"setModerationLoading","data-spot-im-class":"set-moderation-item",disabled:!0},g.a.createElement($.a,{i18nKey:"message.contextMenu.whiteList.item.loading"},"Fetching Info...")))),pe.q&&(o||s||i)&&y.push(g.a.createElement(w.MenuItem,{key:"setReadOnly",onClick:e.setIsReadOnly},g.a.createElement(N.a,{textKey:p?"readOnly.turnOnCommenting":"readOnly.turnOffCommenting"}))),y},e}return s()(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.isModerator,n=e.isAdmin,a=e.isSuperAdmin,r=e.isJournalist;(t||n||a||r)&&this.props.getModerationDefaultPolicy()}},{key:"render",value:function(){var e,t=this.props,n=t.isLoggedIn,a=t.size,r=t.className;r=E()(vs.a.currentUserMenu,vs.a.textTrigger,vs.a.conversation,r,{[vs.a.small]:"small"===a,[vs.a.medium]:"medium"===a,[vs.a.regular]:"regular"===a});var o=Re.a.get("init_data.config.ltr")?"bottom-end":"bottom-start";return n&&(e=this.getMenuItems().filter((function(e){return e}))),!!e.length&&g.a.createElement(w.Menu,{isMobile:Ie.a,isLtr:pe.w,placement:o,onShowChange:this.onTooltipToggle,mobileCancelButtonContent:g.a.createElement($.a,{i18nKey:"menu.closeButton"},"Done"),menuButton:g.a.createElement("span",{className:vs.a.currentUserMenuWrapper,"data-spot-im-class":"handler"},this.props.children)},e)}}]),n}(h.Component);Rs.displayName="CurrentUserMenu",Rs.contextType=ys.ToastContext,Rs.defaultProps={className:"",showPrivacy:!0,onOpenPrivacyModal:function(){},onCommunityQuestionModalStateChange:function(){}};var Ss=f()(Object(M.connect)((function(e){var t=(e.conversation||{}).defaultPolicy,n=e.isReadOnly,a=e.currentUser,r=e.moduleOptions;return{currentUser:a,spotId:r.spotId,postId:r.postId,isReadOnly:n,disableUserProfileModal:r.disableUserProfileModal,defaultPolicy:t}}),{getModerationDefaultPolicy:function(){return function(){var e=J()(G.a.mark((function e(t,n){var a,r,o,s,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=n(),r=a.moduleOptions.spotId,o=a.conversation.id,t({type:"GET_MODERATION_DEFAULT_POLICY",payload:{defaultPolicy:""}}),e.next=5,Object(Es.a)({spotId:r,conversationId:o});case 5:s=e.sent,i=s.defaultPolicy,t({type:"GET_MODERATION_DEFAULT_POLICY",payload:{defaultPolicy:i}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),kt.a.error("getModerationDefaultPolicy",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()},setModerationDefaultPolicy:function(e){return function(){var t=J()(G.a.mark((function t(n,a){var r,o,s;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=a(),o=r.moduleOptions.spotId,s=r.conversation.id,t.next=4,Object(Es.c)({spotId:o,conversationId:s,newPolicy:e});case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),kt.a.error("setConversationDefaultPolicy",t.t0);case 9:n({type:"SET_MODERATION_DEFAULT_POLICY",payload:{}});case 10:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,n){return t.apply(this,arguments)}}()},setIsReadOnly:function(e){return function(){var t=J()(G.a.mark((function t(n,a){var r,o,s,i;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a(),o=r.moduleOptions,s=o.conversationId,i=o.postId,t.prev=1,t.next=4,Object(Ot.a)("v1.0.0/conversation/metadata/read_only",{method:"POST",postId:i,data:{read_only:e,conversation_id:s}});case 4:if(t.sent){t.next=7;break}throw new Error("failed set read only");case 7:n(Object(bs.b)({isReadOnly:e})),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(1),kt.a.error("setIsReadOnly",t.t0),t.t0;case 14:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e,n){return t.apply(this,arguments)}}()}}),Object(vt.a)(),C()({}))(Rs),Cs=n(800),ws=n.n(Cs);function ks(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Os=function(e){c()(n,e);var t=ks(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).handleLoginButtonKeyUp=function(t){13===t.keyCode&&e.handleClick(t)},e}return s()(n,[{key:"handleClick",value:function(e){var t=this.props,n=t.tracking,a=t.onClick,r=t.postId;a(e);var o={item_type:"login",target_type:"main-login",type:"login-clicked",post_id:r};n.trackEvent(o),Object(k.dispatchSpotimEvent)(Dt.d)}},{key:"render",value:function(){var e=this.props.className;return e=E()(ws.a.loginButton,e),g.a.createElement(pt.a,{className:e,onClick:this.handleClick.bind(this),onKeyUp:this.handleLoginButtonKeyUp},g.a.createElement(N.a,{textKey:"general.login"}))}}]),n}(h.Component);Os.displayName="LoginButton",Os.defaultProps={tracking:function(){throw new Error("Tracking is not defined")}};var Is=C()({})(Os),xs=n(405),Ts=n(801),Ns=n.n(Ts),Ds=n(802),Ls=n.n(Ds);var js=Object(M.connect)((function(e){return{communityQuestion:e.moduleOptions.communityQuestion,isSettingCommunityQuestion:e.conversation.isSettingCommunityQuestion}}),(function(e){return{setCommunityQuestion:function(t){return e(function(e){return function(){var t=J()(G.a.mark((function t(n,a){var r,o,s,i;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=a(),o=r.moduleOptions.spotId,s=r.conversation,n({type:ct.pb,payload:{isSettingCommunityQuestion:!0}}),t.next=4,Object(Es.e)({spotId:o,conversationId:s.id,communityQuestion:e});case 4:i=t.sent,i.isSuccess&&n({type:ct.kb,payload:{moduleOptions:{communityQuestion:e}}}),n({type:ct.pb,payload:{isSettingCommunityQuestion:!1}});case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=Object(h.useState)(""),n=Fe()(t,2),a=n[0],r=n[1],o=Object(h.useState)(!0),s=Fe()(o,2),i=s[0],c=s[1],l=Object(h.useState)(!1),u=Fe()(l,2),d=u[0],p=u[1];Object(h.useEffect)((function(){a!==e.communityQuestion&&r(e.communityQuestion)}),[]);var m=Object(h.useMemo)((function(){var t=e.communityQuestion;return"string"==typeof t&&t.length>0}),[e.communityQuestion]);function f(){return(f=J()(G.a.mark((function t(){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p(!1),t.prev=1,t.next=4,e.setCommunityQuestion(a.trim());case 4:return t.prev=4,e.onClose(),t.finish(4);case 7:case"end":return t.stop()}}),t,null,[[1,,4,7]])})))).apply(this,arguments)}function v(){return(v=J()(G.a.mark((function t(){return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return p(!0),t.prev=1,t.next=4,e.setCommunityQuestion("");case 4:return t.prev=4,e.onClose(),t.finish(4);case 7:case"end":return t.stop()}}),t,null,[[1,,4,7]])})))).apply(this,arguments)}return g.a.createElement(w.Modal,{disableCustomBodyScroll:pe.j,shadowRootCssModules:Be.c?["conversation"]:void 0,isLtr:pe.w,className:Ls.a.communityQuestionModal,closeButton:!0,showModal:e.showModal,onClose:function(){return e.onClose()},size:"md",modalTitle:Pe.default.t("communityQuestion.title"),bottomActions:g.a.createElement(w.Gutter,null,g.a.createElement(w.Button,{mode:"secondary",onClick:function(){return v.apply(this,arguments)},disabled:!m},g.a.createElement(Je,{label:Pe.default.t("delete","Delete"),showSpinner:d&&e.isSettingCommunityQuestion})),g.a.createElement(w.Button,{mode:"primary",onClick:function(){return f.apply(this,arguments)},disabled:i||e.isSettingCommunityQuestion},g.a.createElement(Je,{label:Pe.default.t("Post"),showSpinner:!d&&e.isSettingCommunityQuestion})))},g.a.createElement("div",{className:Ls.a.description},Pe.default.t("communityQuestion.description")),g.a.createElement("textarea",{className:Ls.a.textarea,placeholder:Pe.default.t("communityQuestion.ask"),value:a,onChange:function(e){r(e.currentTarget.value),c(!e.currentTarget.value)}}))}));function Us(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ps=/[&?]spot_im_open_profile_followers=true/,Bs=function(e){c()(n,e);var t=Us(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={showCommunityQuestionModal:!1},e.handleOpenUserProfile=function(){var t=e.props;(0,t.onOpenUserProfileModal)(t.currentUser)},e.onCommunityQuestionModalStateChange=function(){e.setState({showCommunityQuestionModal:!0})},e.handleCommunityQuestionModalClose=function(){e.setState({showCommunityQuestionModal:!1})},e.handleLogout=function(){e.setState({isLoggingOut:!0}),e.props.onLogout()},e}return s()(n,[{key:"componentDidUpdate",value:function(e){e.currentUser!==this.props.currentUser&&this.state.isLoggingOut&&this.setState({isLoggingOut:!1})}},{key:"componentDidMount",value:function(){window&&!window.__SPOTIM__.isViewUserProfileFollowersConsumed&&Ps.test(Object(k.getLocation)().search)&&(this.props.onOpenUserProfileFollowers(this.props.userId),window.__SPOTIM__.isViewUserProfileFollowersConsumed=!0)}},{key:"render",value:function(){var e=this.props,t=e.userId,n=e.isAdmin,a=e.isSuperAdmin,r=e.isModerator,o=e.isJournalist,s=e.isLoggedIn,i=e.allowLogin,c=e.onOpenPrivacyModal,l=e.onLoginSelector,u=e.conversationAuthorId,d=e.onOpenUserProfileModal,p=e.onOpenUserSettingsModal,m=e.direction,f=e.toggleHideConversation,h=e.postId,v=e.isLiveBlog,y=this.state,b=y.showCommunityQuestionModal,E=y.isLoggingOut,M=null;return s?M=g.a.createElement(g.a.Fragment,null,g.a.createElement(Ss,{size:"medium",showLogout:i||pe.s,conversationAuthorId:u,enableCommunityQuestion:!0,showHideConversation:!0,userId:t,isAdmin:n,isSuperAdmin:a,isModerator:r,isJournalist:o,isLoggedIn:s,onLogout:this.handleLogout,onOpenPrivacyModal:c,onOpenUserProfileModal:d,onOpenUserSettingsModal:p,direction:m,toggleHideConversation:f,onCommunityQuestionModalStateChange:this.onCommunityQuestionModalStateChange,showPrivacy:!pe.k},E?g.a.createElement("div",{className:Ns.a.loginSpinnerWrapper},g.a.createElement(j.a,null)):g.a.createElement(pt.a,{disableHover:!0,isIcon:!0,className:Ns.a.cogMenuIcon},g.a.createElement(w.Icon,{name:"cog",type:"fa-regular"}))),g.a.createElement(js,{showModal:b,onClose:this.handleCommunityQuestionModalClose})):i&&!v&&(M=g.a.createElement(Is,{postId:h,onClick:function(){return l()}})),M}}]),n}(h.Component),As=Object(M.connect)((function(e){var t=e.currentUser,n=e.moduleOptions,a=n.isConnectEnabled,r=n.enableSSO,o=(n.editableSSO,n.direction),s=n.conversationAuthorId,i=n.connectTypes,c=n.spotId,l=n.postId,u=n.isConversationLiveBlog,d=n.isConversationPage;return{enableSSO:r,isConnectEnabled:a,currentUser:t,direction:o,userId:t.id,isAdmin:t.isAdmin,isSuperAdmin:t.isSuperAdmin,isJournalist:t.isJournalist,isModerator:t.isModerator,isLoggedIn:Object(ia.d)(t),userDisplayName:Object(ia.b)(t),allowLogin:a&&!r||pe.r,conversationAuthorId:s,connectTypes:i,spotId:c,postId:l,isLiveBlog:u,isConversationPage:d}}),(function(e){return{onLogout:$a.b,onOpenPrivacyModal:function(t){return e(Object(Ft.a)({user:t,mode:"privacy"}))},onOpenUserProfileFollowers:function(t){e(Object(Ft.a)({user:{id:t},mode:"main-followers"}))},onOpenUserProfileModal:function(t){e(Object(Ft.a)({user:t,mode:"main"}))},onOpenUserSettingsModal:function(t){return e(Object(Ft.a)({user:t,mode:"settings"}))},onLoginSelector:function(){var t=function(){return e(Object(At.a)())};if(!document.requestStorageAccess)return e(Object(At.a)());var n=function(){document.requestStorageAccess().then((function(){return t()}),(function(){return t()}))};document.hasStorageAccess().then((function(e){!0===e?t():n()}),(function(){return n()}))},toggleHideConversation:function(){return e(Object(xs.a)())}}}))(Bs),_s=n(265),Fs=function(e){var t=Re.a.get("tenant_config.conversation.message_fetch_count",ba.c);return e?ba.e:t};var Vs,Ks,qs,Hs,Ws=0,zs=[5,10,15,20,30,40,50,60,70,80,90,120,240],Gs={};function Qs(){if(0!==Ws){var e={type:"reading",item_type:"main",count:Ws,is_active_view:!0};qs?qs.trackEvent(e):kt.a.error("trackEvent","trying to log reading event before reading-service initialization")}}function Js(){Ws++,-1!==zs.indexOf(Ws)&&(Qs(),Gs={hasMouseMoved:!1,hasMouseScrolled:!1,hasKeyboardClicked:!1})}function Ys(){!0,Vs=setInterval((function(){Js()}),Ks)}function Xs(){!1,clearInterval(Vs)}function Zs(e){"hidden"==document.visibilityState?Xs():$s(e)&&Ys()}function $s(e){var t=e.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0}window.addEventListener("message",(function(e){if("object"==typeof e.data&&e.data.__SPOTIM_MESSAGE)switch(e.data.type){case"scroll":Gs.hasMouseScrolled=!0;break;case"keydown":Gs.hasKeyboardClicked=!0;break;case"mousemove":Gs.hasMouseMoved=!0}}));var ei=n(80);function ti(e){var t={offset:e.offset,count:e.count};return Object(qe.a)("notifications/my-notifications",{data:t})}function ni(e){var t=e.notificationId;return Object(qe.a)("notifications/mark_as_read",{method:"POST",data:{notifications_ids:[t]}})}var ai=n(116);function ri(e){var t=$t.a.map(e,{total_unread:"unreadCount",total_unseen:"unseenCount",total:"totalCount",notifications:{"~":"notifications",id:"id",type:"type",read:"read",updated_at:"updatedAt",conversation_id:"conversationId",conversation_url:"conversationUrl",conversation_title:"conversationTitle",total_count:"totalCount",replier_id:"userId",liker_id:"userId",mentioner_id:"userId",reply:Object(wa.a)("message"),message:Object(wa.a)("message"),users:Object(Zt.a)("users")}});return t.notifications=t.notifications||[],t.notifications=t.notifications.map((function(e){return e.messageId=e.message.id,e.message.depth="comment"===e.message.type?0:1,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(n||(n=e.userId),e.user=t.find((function(e){return e.id===n})),e.entities&&e.entities.forEach((function(e){"user-mention"===e.type.toLowerCase()&&(e.user=t.find((function(t){return t.id===e.userId})))})),e.replyToUserId&&!e.replyToDisplayName){var a=t.find((function(t){return e.replyToUserId===t.id}));a&&(e.replyToDisplayName=a.displayName||a.username)}}(e.message,e.users),e})),t}var oi=!1;function si(){return function(){var e=J()(G.a.mark((function e(t){var n,a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(oi){e.next=22;break}return oi=!0,t({type:ei.b}),e.prev=3,kt.a.apm.start("fetch_get_and_reset_notifications"),e.next=7,Object(qe.a)("notifications/my-notifications-and-reset-unseen",{});case 7:if(n=e.sent,a=n.body,kt.a.apm.end("fetch_get_and_reset_notifications"),a.notifications.forEach((function(e){e&&e.message&&e.message.content&&(e.message.content=e.message.content.filter((function(e){return"user-mention"!==e.type})))})),r=ri(a)){e.next=14;break}return e.abrupt("return");case 14:t({type:ei.a,payload:{notifications:r.notifications,unreadCount:r.unreadCount,totalCount:r.totalCount}}),oi=!1,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),oi=!1,kt.a.error("getAndResetNotifications",e.t0);case 22:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(t){return e.apply(this,arguments)}}()}var ii=n(803),ci=n.n(ii);function li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ui=function(e){c()(n,e);var t=li(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.count,n=e.active,a=e.onClick,r=e.onIndicatorHover,o=e.showCircleIcon,s=null;t>0&&(s=g.a.createElement("span",{className:ci.a.counter}));var i=E()(ci.a.indicator,{[ci.a.active]:t||n});return g.a.createElement("div",{onMouseEnter:r,className:i,onClick:a},o?g.a.createElement(I.a,{className:ci.a.icon,selector:"bellIcon"}):g.a.createElement(pt.a,{isIcon:!0,disableHover:!0,className:ci.a.icon},g.a.createElement(I.a,{selector:"regularBellIcon"})),s)}}]),n}(h.Component);ui.defaultProps={count:0,active:!1,onClick:function(){}};var di=n(804),pi=n.n(di);function mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var fi=function(e){c()(n,e);var t=mi(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).handleMarkAsReadKeyUp=function(t){var n=e.props.onMarkAllAsRead;13===t.keyCode&&(t.stopPropagation(),n())},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.unreadCount,n=e.onMarkAllAsRead,a=null;return t>0&&(a=g.a.createElement(N.a,{textKey:"notifications.markAsRead",className:pi.a.markAsRead,onClick:n,onKeyUp:this.handleMarkAsReadKeyUp})),g.a.createElement("header",{className:pi.a.notificationsTooltipHeader},g.a.createElement(N.a,{textKey:"notifications.title",className:pi.a.title}),t>0&&g.a.createElement("div",{className:pi.a.counter},t),a)}}]),n}(h.Component);fi.displayName="NotificationsHeader",fi.propTypes={unreadCount:y.a.number,onMarkAllAsRead:function(){}},fi.defaultProps={unreadCount:0,onMarkAllAsRead:function(){}};var hi=n(805),gi=n.n(hi);function vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var yi=function(e){c()(n,e);var t=vi(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).getMentionEndingKey=function(e){var t="more";switch(e){case 0:t="zero";break;case 1:t="one"}return t},a.getMessageComponent=function(){var e=a.props,t=e.message,n=e.hideNotification,r=null;if(t)try{var o=Object(Y.getCleanText)(t);o=o.replace(/\n/gm," ").replace(/\&nbsp;/gm," "),r=g.a.createElement("em",{className:gi.a.message},o)}catch(e){n()}return r},a.getTitleComponent=function(){var e=a.props,t=e.item,n=e.user,r=e.message,o=t.totalCount,s="notifications.types.";t.type!==ai.a.LIKED_MESSAGE&&(s+=t.type),t.type===ai.a.MENTION&&(s+=".".concat(a.getMentionEndingKey(o)));var i=null,c="";switch(t.type){case ai.a.MENTION:case ai.a.REPLIED_YOUR_MESSAGE:n&&(c=r&&r.userDisplayName||Object(Bt.getDisplayName)(n)),i=g.a.createElement(N.a,{className:gi.a.description,textKey:s,params:{totalCount:o,username:c},pluralValue:o});break;case ai.a.LIKED_MESSAGE:switch(n&&(c=Object(Bt.getDisplayName)(n)),yt){case ht.Recommend:s+="recommended-message";break;case ht.UpDown:s+="up-voted-message";break;default:s+=t.type}i=g.a.createElement(N.a,{className:gi.a.description,textKey:s,params:{totalCount:o,username:c},pluralValue:o});break;default:i=g.a.createElement(N.a,{className:gi.a.description,textKey:s,params:{totalCount:o},pluralValue:o})}return i},a.state={messageComponent:null,titleComponent:null},a}return s()(n,[{key:"componentDidMount",value:function(){var e=this.getMessageComponent(),t=this.getTitleComponent();this.setState({messageComponent:e,titleComponent:t})}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.message,a=this.state,r=a.messageComponent,o=a.titleComponent,s=t.conversationTitle,i=E()(gi.a.title,{[gi.a.noMessage]:!n});return g.a.createElement("div",{className:gi.a.content},o,g.a.createElement("span",{className:i},s),r)}}]),n}(h.Component),bi=n(806),Ei=n.n(bi);function Mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ri=function(e){c()(n,e);var t=Mi(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).getIcon=function(){var t=null;switch(e.props.item.type){case ai.a.REPLIED_YOUR_MESSAGE:case ai.a.ALSO_REPLIED:t="commentIcon";break;case ai.a.LIKED_MESSAGE:switch(yt){case ht.UpDown:t="upVote";break;case ht.Recommend:t="recommend";break;default:t="voteUpIcon"}break;case ai.a.MENTION:t="mentionIcon"}return t},e}return s()(n,[{key:"render",value:function(){var e=this.props.item,t=this.getIcon();return g.a.createElement("div",{className:E()(Ei.a.details,Ei.a[t])},g.a.createElement(I.a,{className:E()(Ei.a.icon,{[Ei.a.voteIcon]:e.type===ai.a.LIKED_MESSAGE}),selector:t}),g.a.createElement("div",{className:Ei.a.updatedAt},g.a.createElement(xn,{date:e.updatedAt,longDate:!0})))}}]),n}(h.Component),Si=n(807),Ci=n.n(Si),wi=n(149);function ki(e,t,n){return Oi.apply(this,arguments)}function Oi(){return(Oi=J()(G.a.mark((function e(t,n,a){var r,o,s,i,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ot.a)("v1.0.0/conversation/read",{method:"POST",data:{count:20,offset:0,sort_by:"newest",depth:n,message_id:t},postId:a});case 2:return r=e.sent,o=r.conversation.comments[0],s=o.replies,(i=wn()(o,["replies"])).replies=[],s.unshift(i),c={comments:Object(wi.a)(s),users:r.conversation.users},e.abrupt("return",Object(Ao.b)(r.conversation.conversation_id,c));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ii(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var xi=function(e){c()(n,e);var t=Ii(n);function n(e){var a;return r()(this,n),(a=t.call(this,e)).url=a.createUrl(),a.onClick=function(e){Object(k.dispatchSpotimEvent)(Dt.y);var t=a.props,n=t.tracking,r=t.onMarkAsRead,o=t.item,s=t.postId,i=t.onClick,c=o.id,l=o.message,u=o.conversationId,d=o.type;i(),r({id:c}),a.onNotificationClick();var p={type:"notification-click",item_type:"notifications",target_type:d,item_id:l&&l.id,conversation_id:u,post_id:s};n.trackEvent(p)},a.handleNotificationKeyUp=function(e){13===e.keyCode&&(e.stopPropagation(),a.onClick(e))},a.hideNotification=function(){a.setState({show:!1})},a.onNotificationClick=function(){var e=a.props,t=e.item,n=e.highlightConversationMessage,r=e.conversation,o=t.message,s=t.conversationId;r.id===s?n(o.id,o.depth):Object(k.navigate)(a.url||"")},a.state={show:!0},a}return s()(n,[{key:"createUrl",value:function(){var e=this.props,t=e.item,n=e.conversation,a=t.conversationUrl,r=t.message,o=t.conversationId,s=n.id===o,i=-1!==a.indexOf("?")?"&":"?",c="".concat(a).concat(i,"utm_source=spotim&utm_medium=spotim_conversation&spot_im_redirect_source=notifications&spot_im_comment_id=").concat(r.id,"&spot_im_highlight_immediate=true");return s?void 0:c}},{key:"render",value:function(){var e=this.props.item,t=e.users[e.userId]||Object(Ze.a)();return this.state.show?g.a.createElement("li",{className:E()(Ci.a.item,{[Ci.a.read]:e.read}),onKeyUp:this.handleNotificationKeyUp,onClick:this.onClick},g.a.createElement(de.b,{size:de.a.NORMAL,disableUserImageUpload:!0,disableOnlineIndicator:!0,user:t}),g.a.createElement("div",{className:Ci.a.contentWrap},g.a.createElement(yi,{item:e,message:e.message,user:t,hideNotification:this.hideNotification}),g.a.createElement(Ri,{item:e}))):null}}]),n}(h.Component);xi.defaultProps={onClick:function(){},onMarkAsRead:function(){}};var Ti=f()(Object(M.connect)((function(e){return{spotId:e.moduleOptions.spotId,postId:e.moduleOptions.postId,conversation:e.conversation}}),{highlightConversationMessage:function(e,t){return function(){var n=J()(G.a.mark((function n(a,r){var o,s,i,c,l,u,d;return G.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=r(),s=o.moduleOptions,i=s.elementId,c=s.postId,Gr(e,i)){n.next=9;break}return n.next=5,ki(e,t,c);case 5:l=n.sent,u=l.comments,d=l.usersList,a({type:ct.b,payload:{comments:u,usersList:d}});case 9:Qr(e,i),a(Yr({id:e}));case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}}),C()({}))(xi),Ni=n(808),Di=n.n(Ni);function Li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var ji=function(e){c()(n,e);var t=Li(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).scrollWrapperRef=g.a.createRef(),e.onScroll=function(){var t=e.scrollWrapperRef.current;if(t){var n=t.scrollTop;if(t.scrollHeight-t.clientHeight-n<30){var a=e.props,r=a.hasNext,o=a.onLoadNext,s=a.isLoading;r&&!s&&o()}}},e}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.items,n=e.isEmpty,a=e.onMarkAsRead,r=e.onNotificationClick,o=e.isModal;return n?null:g.a.createElement("ul",{className:Di.a.list,ref:this.scrollWrapperRef,onScroll:this.onScroll},t.map((function(e){return g.a.createElement(Ti,{key:e.id,onClick:r,onMarkAsRead:a,item:e,isModal:o})})))}}]),n}(h.Component);ji.defaultProps={isEmpty:!1,hasNext:!1,isLoading:!1,onMarkAsRead:function(){},onNotificationClick:function(){},onLoadNext:function(){}};var Ui=n(809),Pi=n.n(Ui),Bi=function(){return g.a.createElement("div",{className:Pi.a.notificationsEmptyState},g.a.createElement("div",{className:Pi.a.placeholder},g.a.createElement("div",{className:Pi.a.circle}),g.a.createElement("div",{className:Pi.a.line1}),g.a.createElement("div",{className:Pi.a.line2})),g.a.createElement("div",{className:Pi.a.title},g.a.createElement($.a,{i18nKey:"notification.emptyStateTitle"},"No Notifications Yet :(")),g.a.createElement("div",{className:Pi.a.subtitle},g.a.createElement($.a,{i18nKey:"notification.emptyStateBody"},"Start interacting with others and your inbox will be full in no time!")))},Ai=function(){return g.a.createElement(Vt.a,{rtl:!Re.a.get("init_data.config.ltr"),width:310,height:280,speed:2,backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loader-primary-color"),foregroundColor:getComputedStyle(document.documentElement).getPropertyValue("--spotim-content-loaders-secondary-color")},g.a.createElement("circle",{cx:"47",cy:"47",r:"17"}),g.a.createElement("rect",{x:"73",y:"30",rx:"8",ry:"8",width:"174",height:"13"}),g.a.createElement("rect",{x:"73",y:"50",rx:"8",ry:"8",width:"139",height:"13"}),g.a.createElement("circle",{cx:"47",cy:"138",r:"17"}),g.a.createElement("rect",{x:"73",y:"121",rx:"8",ry:"8",width:"174",height:"13"}),g.a.createElement("rect",{x:"73",y:"141",rx:"8",ry:"8",width:"139",height:"13"}),g.a.createElement("circle",{cx:"47",cy:"229",r:"17"}),g.a.createElement("rect",{x:"73",y:"212",rx:"8",ry:"8",width:"174",height:"13"}),g.a.createElement("rect",{x:"73",y:"232",rx:"8",ry:"8",width:"139",height:"13"}))},_i=n(810),Fi=n.n(_i);function Vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ki=function(e){c()(n,e);var t=Vi(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){var e=this.props,t=e.notifications,n=e.className,a=e.isLoading,r=e.onMarkAsRead,o=e.onLoadNext,s=e.onNotificationClick,i=e.onMarkAllAsRead,c=e.isModal,l=t.items,u=t.order,d=Object(ai.d)(t),p=Object(ai.e)(t),m=E()(Fi.a.notificationsTooltip,{[Fi.a.noNotifications]:p},n),f=u.map((function(e){return l[e]}));return g.a.createElement("div",{className:m},!Object(Ie.b)()&&g.a.createElement(fi,{unreadCount:f.length,onMarkAllAsRead:i}),!p&&g.a.createElement(ji,{items:f,isEmpty:p,hasNext:d,isLoading:a,onMarkAsRead:r,onNotificationClick:s,onLoadNext:o,isModal:c}),a&&p&&g.a.createElement(Ai,null),!a&&p&&g.a.createElement(Bi,null))}}]),n}(h.Component);Ki.defaultProps={isLoading:!1,onNotificationClick:function(){},onLoadNext:function(){},onMarkAsRead:function(){},onMarkAllAsRead:function(){},onHide:function(){},onShow:function(){},toggleObservable:void 0,showObservable:void 0,hideObservable:void 0,className:""};var qi=n(811),Hi=n.n(qi);function Wi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var zi=function(e){c()(n,e);var t=Wi(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={showMenu:!1,unseenCount:e.props.notifications.unseenCount,isPostPage:e.props.contentType===_a.b.Post},e.onTooltipToggle=function(){e.props.onLoadAndReset(),e.setState({showMenu:!e.state.showMenu})},e.handleTooltipClick=function(t){13===t.keyCode&&(e.props.onLoadAndReset(),e.onTooltipToggle())},e.onIndicatorHover=function(){var t={type:"hovered",item_type:"header",target_type:"notifications-bell",post_id:e.props.postId};e.props.tracking.trackEvent(t)},e.onTooltipShow=J()(G.a.mark((function t(){var n,a,r,o,s,i,c;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.props,a=n.tracking,r=n.postId,o=n.isLoaded,s=n.convId,i=n.setNotificationLoaded,o||(e.props.getAndResetNotifications(),i()),e.setState({showMenu:!0,unseenCount:0}),c={type:"notifications-bell-clicked",item_type:"notifications",target_type:"on",post_id:r,ugc_post_id:s},a.trackEvent(c),Object(k.dispatchSpotimEvent)(Dt.e);case 6:case"end":return t.stop()}}),t)}))),e.onTooltipHide=function(){var t=e.props,n=t.tracking,a=t.postId,r=t.convId;e.setState({showMenu:!1});var o={type:"notifications-bell-clicked",item_type:"notifications",target_type:"off",post_id:a,ugc_post_id:r};n.trackEvent(o)},e.handleCloseTooltip=function(){e.setState({showMenu:!1})},e}return s()(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.notifications.unseenCount;this.props.notifications.unseenCount!==t&&this.setState({unseenCount:t})}},{key:"render",value:function(){var e=this,t=this.props,n=t.notifications,a=t.isLoading,r=t.connectEnabled,o=t.onLoadNext,s=t.onMarkAsRead,i=t.onMarkAllAsRead,c=t.className,l=t.showCircleIcon,u=t.isModal,d=t.isLiveBlog,p=t.currentUser,m=t.notificationsAlreadyLoaded,f=this.state,h=f.unseenCount,v=f.showMenu;c=E()(Hi.a.notifications,{[Hi.a.loginDisabled]:!r},c);var y=Re.a.get("init_data.config.ltr")?"bottom-end":"bottom-start";return d&&!Object(ia.d)(p)?null:g.a.createElement("div",{className:c,id:"spotim-bell-notification"},g.a.createElement(w.Menu,{isLtr:pe.w,isMobile:Ie.a,placement:y,onShowChange:function(t){t?e.onTooltipShow():e.onTooltipHide()},mobileCancelButtonContent:g.a.createElement($.a,{i18nKey:"menu.closeButton"},"Done"),menuButton:g.a.createElement(ui,{active:v,count:h,onIndicatorHover:this.onIndicatorHover,showCircleIcon:l})},g.a.createElement(Ki,{notifications:n,isLoading:a||!m,onNotificationClick:this.onTooltipToggle,onLoadNext:o,onMarkAsRead:s,onMarkAllAsRead:i,onShow:this.onTooltipShow,onHide:this.onTooltipHide,isModal:u})))}}]),n}(h.Component);zi.defaultProps={connectEnabled:!0};var Gi=f()(Object(M.connect)((function(e){var t=e.moduleOptions.postId,n=P.j(e),a=e.conversation,r=a.contentType,o=a.id;return{isLiveBlog:n,currentUser:P.c(e),postId:t,convId:o,notificationsAlreadyLoaded:e.notifications.isLoaded,contentType:r}}),(function(e){return{getAndResetNotifications:function(){e(si())},setNotificationLoaded:function(){e({type:ei.e,payload:{isLoaded:!0}})}}})),C()({}))(zi);function Qi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var Ji=function(e){c()(n,e);var t=Qi(n);function n(){return r()(this,n),t.apply(this,arguments)}return s()(n,[{key:"render",value:function(){return g.a.createElement(Gi,this.props)}}]),n}(h.Component);Ji.propTypes={notifications:y.a.object.isRequired,isLoading:y.a.bool,onMarkAllAsRead:y.a.func,onMarkAsRead:y.a.func,onLoadNext:y.a.func,direction:y.a.oneOf(["rtl","ltr"]).isRequired,showCircleIcon:y.a.bool.isRequired};var Yi=Object(M.connect)((function(e){var t=e.notifications,n=e.moduleOptions,a={isLoading:t.isLoading,notifications:t};if(n){var r=n.direction;a.direction=r}return a}),{onMarkAllAsRead:function(){return function(){var e=J()(G.a.mark((function e(t,n){var a,r,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n(),r=a.notifications,o=r.items.filter((function(e){return!e.read})).map((function(e){return e.id})),e.next=4,s=void 0,s=o.notificationIds,Object(qe.a)("notifications/mark_as_read",{method:"POST",data:{notifications_ids:s}});case 4:t({type:ei.c});case 5:case"end":return e.stop()}var s}),e)})));return function(t,n){return e.apply(this,arguments)}}()},onMarkAsRead:function(e){var t=e.id;return function(){var e=J()(G.a.mark((function e(n){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ni(t);case 2:n({type:ei.d,payload:{id:t}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},onLoadNext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.reset,n=void 0!==t&&t;return function(){var e=J()(G.a.mark((function e(t,a){var r,o,s,i,c,l,u,d,p,m,f;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a(),o=Object(ai.c)(r.notifications),s=o.offset,i=o.count,n&&(s=0,i=0),t({type:ei.b}),e.prev=4,e.next=7,ti({offset:s,count:i});case 7:c=e.sent,l=c.body,u=ri(l),d=u.unreadCount,p=u.unseenCount,m=u.totalCount,f=u.notifications,t({type:ei.a,payload:{notifications:f,unreadCount:d,unseenCount:p,totalCount:m,offset:s,reset:n}}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),kt.a.error("getNotifications",e.t0);case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t,n){return e.apply(this,arguments)}}()},onLoadAndReset:si})(Ji),Xi=n(432),Zi=function(e){var t=e.commentsRootCount,n=e.postId,a=Object(h.useRef)(null),r=function(e,t){var n,a;e&&(null===(n=window)||void 0===n||null===(a=n.__SPOTIM__)||void 0===a||a.renderSurvey({element:e,postId:t}))},o=Object(h.useMemo)((function(){var e=Re.a.get("tenant_config.conversation-survey.enabled",!1),n=Re.a.get("tenant_config.conversation-survey.minimum_num_of_comments",10);return e&&n<=t}),[t]);return Object(h.useEffect)((function(){return function(){if(null==a?void 0:a.current){var e=new IntersectionObserver((function(e,t){Fe()(e,1)[0].isIntersecting&&(t.disconnect(),r(a.current,n))}),{threshold:[.99],rootMargin:"0px 0px ".concat("-160px"," 0px")});return e.observe(a.current),function(){(null==a?void 0:a.current)&&e.unobserve(a.current)}}}()}),[o]),o&&g.a.createElement("div",{ref:a})},$i=n(433),ec=n.n($i);function tc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=p()(e);if(t){var r=p()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return u()(this,n)}}var nc=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(22),n.e(58)]).then(n.bind(null,906))})),ac=Object(h.lazy)((function(){return Promise.all([n.e(0),n.e(24)]).then(n.bind(null,889))})),rc=function(e){c()(n,e);var t=tc(n);function n(){var e;r()(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).handleStarRatingModuleVote=function(t){var n=t.detail;e.props.conversation.id===n.conversationId&&e.props.onRatingsClick(n.rank)},e.subscribeToStarRating=function(){document.addEventListener("spot-im-star-rating-module-vote",e.handleStarRatingModuleVote)},e.unSubscribeToStarRating=function(){document.removeEventListener("spot-im-star-rating-module-vote",e.handleStarRatingModuleVote)},e.scrollToComments=function(){var t=Object(R.findDOMNode)(e.messagesStackElement).getBoundingClientRect().top;pa(window,t,200)},e.renderUserMenu=function(t){var n=t.currentUser,a=t.useDisqusLogin,r=t.handleDisqusLogin,o=t.direction,s=t.claimDisqusForumAccount,i=t.postId;return g.a.createElement("div",{"data-spot-im-class":"registration-buttons",className:ec.a.registrationButtons},!Object(ia.d)(n)&&a&&!e.props.isLiveBlog&&s&&g.a.createElement(H,{onClick:e.openDiscusForumAccount}),!Object(ia.d)(n)&&a&&!e.props.isLiveBlog&&g.a.createElement(W.a,{onClick:r,postId:i}),g.a.createElement(Yi,{direction:o,showCircleIcon:!1}),g.a.createElement(As,null))},e.openDiscusForumAccount=function(){Object(k.dispatchSpotimEvent)(U.d)},e.handleLogin=function(){var t=e.props,n=t.tracking,a=t.conversation;(0,t.onLogin)();var r={item_type:"login",target_type:"commnet-sign-up",type:"login-clicked",post_id:a.postId};n.trackEvent(r)},e.handleUploadProfileImage=function(t){var n=e.props.currentUser;e.props.onProfileImageUpload({userId:n.id,rawImage:t})},e.handleUserProfileClick=function(){var t=e.props.currentUser;(t.isRegistered||t.displayName)&&e.props.onOpenUserProfileModal({user:t,mode:"main"})},e.shouldDisplayUsername=function(){var t=e.props,n=t.forceRegister;return t.currentUser.isRegistered||!n},e.getSurveyComponent=function(){var t=e.props,n=t.hasNextComments,a=t.isLiveBlog,r=t.conversation,o=t.commentsList,s=r.postId;return n&&!a&&g.a.createElement(Zi,{commentsRootCount:o.rootOrder.length,postId:s})},e}return s()(n,[{key:"componentDidMount",value:function(){Ho.a.on("scrollToComments",this.scrollToComments);var e=this.props,t=e.conversation.messagesCount,n=e.tracking;t>0&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(t){qs=e,Ks=n,Ws=0,!0,Hs=!1,clearInterval(Vs),Gs={hasMouseMoved:!0,hasMouseScrolled:!0,hasKeyboardClicked:!0};var a=new IntersectionObserver((function(e){var t=Fe()(e,1)[0];Hs?t.isIntersecting?Ys():(Qs(),Xs()):Hs=!0}),{threshold:.01});$s(t)&&Ys(),a?a.observe(t):console.warn("unable to initialize reading service intersection observer"),document.addEventListener("visibilitychange",(function(){return Zs(t)}),!1)}else console.error("initialized reading service without an element to observe")}(n,Object(R.findDOMNode)(this.messagesStackElement)),this.subscribeToStarRating()}},{key:"componentWillUnmount",value:function(){Ho.a.off("scrollToComments",this.scrollToComments),this.unSubscribeToStarRating()}},{key:"render",value:function(){var e=this,t=this.props,n=t.spotId,a=t.comments,r=t.conversation,o=t.isStarsRatingEnabled,s=t.isConnectEnabled,i=t.enableSSO,c=t.editableSSO,l=t.verifyEmailSent,u=t.summaryWidget,d=t.pagination,p=t.pageSize,m=t.useDisqusLogin,f=t.isSafari,v=t.onVerifyEmailSend,y=t.currentUser,b=t.onLoadMore,M=t.handleDisqusLogin,R=t.loadMoreMessagesText,S=t.isLoadingMoreComments,C=t.hasNextComments,k=t.direction,I=t.isLiveBlog,x=t.isReporter,T=t.isLiveBlogOnline,N=t.href,D=(t.commentsList,t.liveBlogEndDate),j=t.liveBlogStartDate,U=t.isReadOnly,P=r.messagesCount,B=r.commentsCount,A=r.postId,_=P>0?o?"richEditor.placeholder.hasMessagesWithStarsRatingEnabled":"richEditor.placeholder.hasMessages":o?"richEditor.placeholder.noMessagesWithStarsRatingEnabled":"richEditor.placeholder.noMessages",F=O.e(a),K=0===P,q=E()(ec.a.conversation,{[ec.a.emptyState]:K,[ec.a.safari]:f}),H=I?"liveBlog.loadMoreReplies":"inpage.conversation.loadMoreReplies";return g.a.createElement("div",{ref:function(t){return e.wrapper=t},"data-spot-im-class":"conversation-body",className:q},o&&g.a.createElement(h.Suspense,{fallback:null},g.a.createElement(nc,{summaryWidget:u,conversation:r})),g.a.createElement(h.Suspense,{fallback:null},I&&g.a.createElement("div",{className:ec.a.topStrip,"data-spot-im-class":"top-strip"},g.a.createElement(g.a.Fragment,null,g.a.createElement(ac,{liveBlogEndDate:D,liveBlogStartDate:j,isEmpty:K,isReporter:x,isLiveBlogOnline:T}),!x&&this.renderUserMenu({currentUser:y,useDisqusLogin:m,handleDisqusLogin:M,direction:k,claimDisqusForumAccount:!1,postId:A})))),(!I||x)&&g.a.createElement("div",{className:E()(ec.a.userAreaContainer,{[ec.a.hasUserUsername]:this.shouldDisplayUsername()})},U?g.a.createElement($.a,{i18nKey:"commentingEnded"},g.a.createElement(w.Typography,{type:"h4"},"Commenting on this article has ended")):this.shouldDisplayUsername()&&g.a.createElement(Fa,{spotId:n,currentUser:y,enableSSO:i,editableSSO:c,handleLogin:this.handleLogin,handleUploadProfileImage:this.handleUploadProfileImage,handleUserProfileClick:this.handleUserProfileClick}),(!i||y.isRegistered||pe.r)&&this.renderUserMenu({currentUser:y,useDisqusLogin:m,handleDisqusLogin:M,direction:k,claimDisqusForumAccount:!1,postId:A})),s&&!i&&g.a.createElement(L,{currentUser:y,email:y.email,isEmailVerified:y.isEmailVerified,onVerifyEmailSend:v,isVerificationEmailSent:l,spotId:n,hostUrl:N}),!U&&(!I||x)&&g.a.createElement($o,{placeholderTextKey:_}),!K&&g.a.createElement(hs,{conversation:r,sortBy:d.sortBy,pageSize:p}),g.a.createElement(qo,{key:"messageStack",ref:function(t){e.messagesStackElement=t},stackList:a,commentsCount:B-F.length,currentUser:y,hasNextComments:C}),!pe.x&&this.getSurveyComponent(),g.a.createElement(V,{hasNext:C,loadMoreMessagesText:R,isLoading:S,onLoadMore:b,textKey:H}),pe.x&&this.getSurveyComponent())}}]),n}(h.Component);rc.propTypes={spotId:y.a.string.isRequired,direction:y.a.oneOf(["rtl","ltr"]).isRequired,currentUser:y.a.object.isRequired,isStarsRatingEnabled:y.a.bool,isConnectEnabled:y.a.bool.isRequired,useDisqusLogin:y.a.bool.isRequired,conversation:y.a.any.isRequired,enableSSO:y.a.bool,verifyEmailSent:y.a.bool.isRequired,pagination:y.a.object.isRequired,comments:y.a.object.isRequired,summaryWidget:y.a.object.isRequired,isSafari:y.a.bool,pageSize:y.a.number,onVerifyEmailSend:y.a.func.isRequired,onLoadMore:y.a.func.isRequired,loadMoreMessagesText:y.a.string,isLoadingMoreComments:y.a.bool.isRequired,hasNextComments:y.a.bool.isRequired,handleDisqusLogin:y.a.func.isRequired,isReporter:y.a.bool,isLiveBlog:y.a.bool,isLiveBlogOnline:y.a.bool,hasCommunity:y.a.bool,href:y.a.string},rc.defaultProps={isSafari:!1,isReporter:!1,isLiveBlog:!1,isLiveBlogOnline:!1};t.default=f()(Object(M.connect)((function(e){var t=e.moduleOptions,n=e.currentUser,a=e.registration,r=e.comments,o=e.conversation,s=e.isReadOnly,i=t.spotId,c=t.isStarsRatingEnabled,l=t.isConnectEnabled,u=t.enableSSO,d=t.useDisqusLogin,p=t.textsOverrides,m=t.direction,f=t.isSafari,h=t.hasCommunity,g=t.href,v=t.conversationId,y=t.editableSSO,b=t.forceRegister,E=a.verifyEmailSent,M=r.loadingFromShowMore,R=r.pagination.hasNext,S=r.list,C=P.m(e,n.id),w=P.j(e),k=P.k(e),O=P.d(e),I=P.e(e);return{spotId:i,isStarsRatingEnabled:c,isConnectEnabled:l,enableSSO:u,useDisqusLogin:d,verifyEmailSent:E,currentUser:n,loadMoreMessagesText:p.conversationLoadMoreMessagesText,isLoadingMoreComments:M,hasNextComments:R,direction:m,isSafari:f,conversation:o,isReporter:C,isLiveBlog:w,isLiveBlogOnline:k,hasCommunity:h,href:g,commentsList:S,liveBlogEndDate:O,liveBlogStartDate:I,conversationId:v,editableSSO:y,forceRegister:b,isReadOnly:s}}),(function(e){return{onVerifyEmailSend:function(t){var n=t.email,a=t.spotId,r=t.url;return e(Object(_s.e)({email:n,spotId:a,url:r}))},onLoadMore:function(){return e(function(){var e=J()(G.a.mark((function e(t,n){var a,r,o,s,i,c,l,u,d,p,m,f,h,g,v,y,b,E,M,R,S;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(kt.a.apm.start("load_more_comments"),a=n(),r=P.j(a),o=P.l(a),s=Fs(o),i=a.moduleOptions,c=i.spotId,l=i.postId,u=i.eventCode,d=i.conversationId,p=i.href,m=i.canonicalHref,f=i.shouldCollapseReplies,h=i.pageSize,g=void 0===h?s:h,v=a.comments,y=v.pagination,b=y.offset,E=y.commentsRead,M=y.sortBy,R=v.isLoading,S=f?1:2,!r&&R){e.next=11;break}return e.next=10,t(ls({spotId:c,postId:r?u:l,conversationId:d,href:p,canonicalHref:m,offset:b,commentsRead:E,pageSize:g,sortBy:M,depth:S,isFromShowMore:!0}));case 10:kt.a.apm.end("load_more_comments");case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},handleDisqusLogin:$a.a,onRatingsClick:function(t){e(Object(Xi.a)(t))},onLogin:function(){e(Object(At.a)({mode:"signup"}))},onProfileImageUpload:function(t){var n=t.rawImage;e(Object(ia.e)({rawImage:n}))},onOpenUserProfileModal:function(t){var n=t.user,a=t.overrideDisplayName,r=t.overrideImageId,o=t.mode;e(Object(Ft.a)({user:n,overrideDisplayName:a,overrideImageId:r,mode:o}))}}}),null,{forwardRef:!0}),C()({},{forwardRef:!0}))(rc)}}]);
//# sourceMappingURL=conversation-component-bundle.js.map